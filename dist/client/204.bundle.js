(self.webpackChunkproject=self.webpackChunkproject||[]).push([[204],{949:(t,e,r)=>{"use strict";r.d(e,{h:()=>a});var i=r(8875),s=r(133),n=r(1132);class a extends i.A{constructor(t){let{data:e,size:r}=t;const{usage:i,label:n,shrinkToFit:a}=t;super(),this.uid=(0,s.L)("buffer"),this._resourceType="buffer",this._resourceId=(0,s.L)("resource"),this._touched=0,this._updateID=1,this._dataInt32=null,this.shrinkToFit=!0,this.destroyed=!1,e instanceof Array&&(e=new Float32Array(e)),this._data=e,r??(r=e?.byteLength);const o=!!e;this.descriptor={size:r,usage:i,mappedAtCreation:o,label:n},this.shrinkToFit=a??!0}get data(){return this._data}set data(t){this.setDataWithSize(t,t.length,!0)}get dataInt32(){return this._dataInt32||(this._dataInt32=new Int32Array(this.data.buffer)),this._dataInt32}get static(){return!!(this.descriptor.usage&n.S.STATIC)}set static(t){t?this.descriptor.usage|=n.S.STATIC:this.descriptor.usage&=~n.S.STATIC}setDataWithSize(t,e,r){if(this._updateID++,this._updateSize=e*t.BYTES_PER_ELEMENT,this._data===t)return void(r&&this.emit("update",this));const i=this._data;this._data=t,this._dataInt32=null,i&&i.length===t.length||!this.shrinkToFit&&i&&t.byteLength<i.byteLength?r&&this.emit("update",this):(this.descriptor.size=t.byteLength,this._resourceId=(0,s.L)("resource"),this.emit("change",this))}update(t){this._updateSize=t??this._updateSize,this._updateID++,this.emit("update",this)}destroy(){this.destroyed=!0,this.emit("destroy",this),this.emit("change",this),this._data=null,this.descriptor=null,this.removeAllListeners()}}},990:(t,e,r)=>{"use strict";r.d(e,{T:()=>d,w:()=>c});var i=r(2577),s=r(7174),n=r(7276),a=r(2806);function o(t){return t instanceof a.m}function h(t){return t instanceof n._}function l(t,e,r){return t.fill=e,t.color=16777215,t.texture=e.texture,t.matrix=e.transform,{...r,...t}}function u(t,e,r){return e.buildGradient(),t.fill=e,t.color=16777215,t.texture=e.texture,t.matrix=e.transform,t.textureSpace=e.textureSpace,{...r,...t}}function c(t,e){if(null==t)return null;const r={},n=t;return function(t){return i.Q.isColorLike(t)}(t)?function(t,e,r){const n=i.Q.shared.setValue(e??0);return t.color=n.toNumber(),t.alpha=1===n.alpha?r.alpha:n.alpha,t.texture=s.g.WHITE,{...r,...t}}(r,t,e):function(t){return t instanceof s.g}(t)?function(t,e,r){return t.texture=e,{...r,...t}}(r,t,e):o(t)?l(r,t,e):h(t)?u(r,t,e):n.fill&&o(n.fill)?l(n,n.fill,e):n.fill&&h(n.fill)?u(n,n.fill,e):function(t,e){const r={...e,...t},s=i.Q.shared.setValue(r.color);return r.alpha*=s.alpha,r.color=s.toNumber(),r}(n,e)}function d(t,e){const{width:r,alignment:i,miterLimit:s,cap:n,join:a,pixelLine:o,...h}=e,l=c(t,h);return l?{width:r,alignment:i,miterLimit:s,cap:n,join:a,pixelLine:o,...l}:null}},1132:(t,e,r)=>{"use strict";r.d(e,{S:()=>i});var i=(t=>(t[t.MAP_READ=1]="MAP_READ",t[t.MAP_WRITE=2]="MAP_WRITE",t[t.COPY_SRC=4]="COPY_SRC",t[t.COPY_DST=8]="COPY_DST",t[t.INDEX=16]="INDEX",t[t.VERTEX=32]="VERTEX",t[t.UNIFORM=64]="UNIFORM",t[t.STORAGE=128]="STORAGE",t[t.INDIRECT=256]="INDIRECT",t[t.QUERY_RESOLVE=512]="QUERY_RESOLVE",t[t.STATIC=1024]="STATIC",t))(i||{})},1242:(t,e,r)=>{"use strict";r.d(e,{Z:()=>s});const i=["serif","sans-serif","monospace","cursive","fantasy","system-ui"];function s(t){const e="number"==typeof t.fontSize?`${t.fontSize}px`:t.fontSize;let r=t.fontFamily;Array.isArray(t.fontFamily)||(r=t.fontFamily.split(","));for(let t=r.length-1;t>=0;t--){let e=r[t].trim();/([\"\'])[^\'\"]+\1/.test(e)||i.includes(e)||(e=`"${e}"`),r[t]=e}return`${t.fontStyle} ${t.fontVariant} ${t.fontWeight} ${e} ${r.join(",")}`}},1460:(t,e,r)=>{"use strict";r.d(e,{u:()=>i});class i{constructor(t){"number"==typeof t?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData),this.size=this.rawBinaryData.byteLength}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}get float64View(){return this._float64Array||(this._float64Array=new Float64Array(this.rawBinaryData)),this._float64Array}get bigUint64View(){return this._bigUint64Array||(this._bigUint64Array=new BigUint64Array(this.rawBinaryData)),this._bigUint64Array}view(t){return this[`${t}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this.uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${t} isn't a valid view type`)}}}},2289:(t,e,r)=>{"use strict";r.d(e,{s:()=>s});var i=r(2048);function s(t,e){const{texture:r,bounds:s}=t;(0,i.y)(s,e._anchor,r);const n=e._style.padding;s.minX-=n,s.minY-=n,s.maxX-=n,s.maxY-=n}},2331:(t,e,r)=>{"use strict";r.d(e,{i:()=>s});const i={normal:"normal-npm",add:"add-npm",screen:"screen-npm"};function s(t,e){return"no-premultiply-alpha"===e.alphaMode&&i[t]||t}},2558:(t,e,r)=>{"use strict";r.d(e,{M:()=>n});var i=r(2437);const s=new(r(9636).c);function n(t,e,r,n){const a=s;a.minX=0,a.minY=0,a.maxX=t.width/n|0,a.maxY=t.height/n|0;const o=i.W.getOptimalTexture(a.width,a.height,n,!1);return o.source.uploadMethodId="image",o.source.resource=t,o.source.alphaMode="premultiply-alpha-on-upload",o.frame.width=e/n,o.frame.height=r/n,o.source.emit("update",o.source),o.updateUvs(),o}},2760:(t,e,r)=>{"use strict";function i(t,e,r){const i=(t>>24&255)/255;e[r++]=(255&t)/255*i,e[r++]=(t>>8&255)/255*i,e[r++]=(t>>16&255)/255*i,e[r++]=i}r.d(e,{V:()=>i})},2806:(t,e,r)=>{"use strict";r.d(e,{m:()=>a});var i=r(9313),s=r(133);const n={repeat:{addressModeU:"repeat",addressModeV:"repeat"},"repeat-x":{addressModeU:"repeat",addressModeV:"clamp-to-edge"},"repeat-y":{addressModeU:"clamp-to-edge",addressModeV:"repeat"},"no-repeat":{addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}};class a{constructor(t,e){this.uid=(0,s.L)("fillPattern"),this.transform=new i.u,this._styleKey=null,this.texture=t,this.transform.scale(1/t.frame.width,1/t.frame.height),e&&(t.source.style.addressModeU=n[e].addressModeU,t.source.style.addressModeV=n[e].addressModeV)}setTransform(t){const e=this.texture;this.transform.copyFrom(t),this.transform.invert(),this.transform.scale(1/e.frame.width,1/e.frame.height),this._styleKey=null}get styleKey(){return this._styleKey||(this._styleKey=`fill-pattern-${this.uid}-${this.texture.uid}-${this.transform.toArray().join("-")}`),this._styleKey}}},3012:(t,e,r)=>{"use strict";r.d(e,{B:()=>l});var i=r(7952),s=r(8306);const n={f32:"float32","vec2<f32>":"float32x2","vec3<f32>":"float32x3","vec4<f32>":"float32x4",vec2f:"float32x2",vec3f:"float32x3",vec4f:"float32x4",i32:"sint32","vec2<i32>":"sint32x2","vec3<i32>":"sint32x3","vec4<i32>":"sint32x4",u32:"uint32","vec2<u32>":"uint32x2","vec3<u32>":"uint32x3","vec4<u32>":"uint32x4",bool:"uint32","vec2<bool>":"uint32x2","vec3<bool>":"uint32x3","vec4<bool>":"uint32x4"};function a(t){const e=/@group\((\d+)\)/,r=/@binding\((\d+)\)/,i=/var(<[^>]+>)? (\w+)/,s=/:\s*(\w+)/,n=/(\w+)\s*:\s*([\w\<\>]+)/g,a=/struct\s+(\w+)/,o=t.match(/(^|[^/])@(group|binding)\(\d+\)[^;]+;/g)?.map((t=>({group:parseInt(t.match(e)[1],10),binding:parseInt(t.match(r)[1],10),name:t.match(i)[2],isUniform:"<uniform>"===t.match(i)[1],type:t.match(s)[1]})));if(!o)return{groups:[],structs:[]};const h=t.match(/struct\s+(\w+)\s*{([^}]+)}/g)?.map((t=>{const e=t.match(a)[1],r=t.match(n).reduce(((t,e)=>{const[r,i]=e.split(":");return t[r.trim()]=i.trim(),t}),{});return r?{name:e,members:r}:null})).filter((({name:t})=>o.some((e=>e.type===t))))??[];return{groups:o,structs:h}}var o=(t=>(t[t.VERTEX=1]="VERTEX",t[t.FRAGMENT=2]="FRAGMENT",t[t.COMPUTE=4]="COMPUTE",t))(o||{});const h=Object.create(null);class l{constructor(t){this._layoutKey=0,this._attributeLocationsKey=0;const{fragment:e,vertex:r,layout:i,gpuLayout:s,name:n}=t;if(this.name=n,this.fragment=e,this.vertex=r,e.source===r.source){const t=a(e.source);this.structsAndGroups=t}else{const t=a(r.source),i=a(e.source);this.structsAndGroups=function(t,e){const r=new Set,i=new Set;return{structs:[...t.structs,...e.structs].filter((t=>!r.has(t.name)&&(r.add(t.name),!0))),groups:[...t.groups,...e.groups].filter((t=>{const e=`${t.name}-${t.binding}`;return!i.has(e)&&(i.add(e),!0)}))}}(t,i)}this.layout=i??function({groups:t}){const e=[];for(let r=0;r<t.length;r++){const i=t[r];e[i.group]||(e[i.group]={}),e[i.group][i.name]=i.binding}return e}(this.structsAndGroups),this.gpuLayout=s??function({groups:t}){const e=[];for(let r=0;r<t.length;r++){const i=t[r];e[i.group]||(e[i.group]=[]),i.isUniform?e[i.group].push({binding:i.binding,visibility:o.VERTEX|o.FRAGMENT,buffer:{type:"uniform"}}):"sampler"===i.type?e[i.group].push({binding:i.binding,visibility:o.FRAGMENT,sampler:{type:"filtering"}}):"texture_2d"===i.type&&e[i.group].push({binding:i.binding,visibility:o.FRAGMENT,texture:{sampleType:"float",viewDimension:"2d",multisampled:!1}})}return e}(this.structsAndGroups),this.autoAssignGlobalUniforms=!(void 0===this.layout[0]?.globalUniforms),this.autoAssignLocalUniforms=!(void 0===this.layout[1]?.localUniforms),this._generateProgramKey()}_generateProgramKey(){const{vertex:t,fragment:e}=this,r=t.source+e.source+t.entryPoint+e.entryPoint;this._layoutKey=(0,i.X)(r,"program")}get attributeData(){return this._attributeData??(this._attributeData=function({source:t,entryPoint:e}){const r={},i=t.indexOf(`fn ${e}`);if(-1!==i){const e=t.indexOf("->",i);if(-1!==e){const a=t.substring(i,e),o=/@location\((\d+)\)\s+([a-zA-Z0-9_]+)\s*:\s*([a-zA-Z0-9_<>]+)(?:,|\s|$)/g;let h;for(;null!==(h=o.exec(a));){const t=n[h[3]]??"float32";r[h[2]]={location:parseInt(h[1],10),format:t,stride:(0,s.m)(t).stride,offset:0,instance:!1,start:0}}}}return r}(this.vertex)),this._attributeData}destroy(){this.gpuLayout=null,this.layout=null,this.structsAndGroups=null,this.fragment=null,this.vertex=null}static from(t){const e=`${t.vertex.source}:${t.fragment.source}:${t.fragment.entryPoint}:${t.vertex.entryPoint}`;return h[e]||(h[e]=new l(t)),h[e]}}},3228:(t,e,r)=>{"use strict";r.d(e,{GH:()=>mt});var i=r(8507),s=r(3513),n=r(7174),a=r(6563);const o={};function h(t,e){let r=2166136261;for(let i=0;i<e;i++)r^=t[i].uid,r=Math.imul(r,16777619),r>>>=0;return o[r]||function(t,e,r){const i={};let h=0;l||(l=(0,a.a)());for(let r=0;r<l;r++){const s=r<e?t[r]:n.g.EMPTY.source;i[h++]=s.source,i[h++]=s.style}const u=new s.T(i);return o[r]=u,u}(t,e,r)}let l=0;var u=r(133),c=r(1460);function d(t,e){const r=t.byteLength/8|0,i=new Float64Array(t,0,r);new Float64Array(e,0,r).set(i);const s=t.byteLength-8*r;if(s>0){const i=new Uint8Array(t,8*r,s);new Uint8Array(e,8*r,s).set(i)}}var f=r(2331);class p{constructor(){this.ids=Object.create(null),this.textures=[],this.count=0}clear(){for(let t=0;t<this.count;t++){const e=this.textures[t];this.textures[t]=null,this.ids[e.uid]=null}this.count=0}}class g{constructor(){this.renderPipeId="batch",this.action="startBatch",this.start=0,this.size=0,this.textures=new p,this.blendMode="normal",this.topology="triangle-strip",this.canBundle=!0}destroy(){this.textures=null,this.gpuBindGroup=null,this.bindGroup=null,this.batcher=null}}const m=[];let x=0;function _(){return x>0?m[--x]:new g}function y(t){m[x++]=t}let b=0;const v=class t{constructor(e={}){this.uid=(0,u.L)("batcher"),this.dirty=!0,this.batchIndex=0,this.batches=[],this._elements=[],t.defaultOptions.maxTextures=t.defaultOptions.maxTextures??(0,a.a)(),e={...t.defaultOptions,...e};const{maxTextures:r,attributesInitialSize:i,indicesInitialSize:s}=e;this.attributeBuffer=new c.u(4*i),this.indexBuffer=new Uint16Array(s),this.maxTextures=r}begin(){this.elementSize=0,this.elementStart=0,this.indexSize=0,this.attributeSize=0;for(let t=0;t<this.batchIndex;t++)y(this.batches[t]);this.batchIndex=0,this._batchIndexStart=0,this._batchIndexSize=0,this.dirty=!0}add(t){this._elements[this.elementSize++]=t,t._indexStart=this.indexSize,t._attributeStart=this.attributeSize,t._batcher=this,this.indexSize+=t.indexSize,this.attributeSize+=t.attributeSize*this.vertexSize}checkAndUpdateTexture(t,e){const r=t._batch.textures.ids[e._source.uid];return!(!r&&0!==r||(t._textureId=r,t.texture=e,0))}updateElement(t){this.dirty=!0;const e=this.attributeBuffer;t.packAsQuad?this.packQuadAttributes(t,e.float32View,e.uint32View,t._attributeStart,t._textureId):this.packAttributes(t,e.float32View,e.uint32View,t._attributeStart,t._textureId)}break(t){const e=this._elements;if(!e[this.elementStart])return;let r=_(),i=r.textures;i.clear();const s=e[this.elementStart];let n=(0,f.i)(s.blendMode,s.texture._source),a=s.topology;4*this.attributeSize>this.attributeBuffer.size&&this._resizeAttributeBuffer(4*this.attributeSize),this.indexSize>this.indexBuffer.length&&this._resizeIndexBuffer(this.indexSize);const o=this.attributeBuffer.float32View,h=this.attributeBuffer.uint32View,l=this.indexBuffer;let u=this._batchIndexSize,c=this._batchIndexStart,d="startBatch";const p=this.maxTextures;for(let s=this.elementStart;s<this.elementSize;++s){const g=e[s];e[s]=null;const m=g.texture._source,x=(0,f.i)(g.blendMode,m),y=n!==x||a!==g.topology;m._batchTick!==b||y?(m._batchTick=b,(i.count>=p||y)&&(this._finishBatch(r,c,u-c,i,n,a,t,d),d="renderBatch",c=u,n=x,a=g.topology,r=_(),i=r.textures,i.clear(),++b),g._textureId=m._textureBindLocation=i.count,i.ids[m.uid]=i.count,i.textures[i.count++]=m,g._batch=r,u+=g.indexSize,g.packAsQuad?(this.packQuadAttributes(g,o,h,g._attributeStart,g._textureId),this.packQuadIndex(l,g._indexStart,g._attributeStart/this.vertexSize)):(this.packAttributes(g,o,h,g._attributeStart,g._textureId),this.packIndex(g,l,g._indexStart,g._attributeStart/this.vertexSize))):(g._textureId=m._textureBindLocation,u+=g.indexSize,g.packAsQuad?(this.packQuadAttributes(g,o,h,g._attributeStart,g._textureId),this.packQuadIndex(l,g._indexStart,g._attributeStart/this.vertexSize)):(this.packAttributes(g,o,h,g._attributeStart,g._textureId),this.packIndex(g,l,g._indexStart,g._attributeStart/this.vertexSize)),g._batch=r)}i.count>0&&(this._finishBatch(r,c,u-c,i,n,a,t,d),c=u,++b),this.elementStart=this.elementSize,this._batchIndexStart=c,this._batchIndexSize=u}_finishBatch(t,e,r,i,s,n,a,o){t.gpuBindGroup=null,t.bindGroup=null,t.action=o,t.batcher=this,t.textures=i,t.blendMode=s,t.topology=n,t.start=e,t.size=r,++b,this.batches[this.batchIndex++]=t,a.add(t)}finish(t){this.break(t)}ensureAttributeBuffer(t){4*t<=this.attributeBuffer.size||this._resizeAttributeBuffer(4*t)}ensureIndexBuffer(t){t<=this.indexBuffer.length||this._resizeIndexBuffer(t)}_resizeAttributeBuffer(t){const e=Math.max(t,2*this.attributeBuffer.size),r=new c.u(e);d(this.attributeBuffer.rawBinaryData,r.rawBinaryData),this.attributeBuffer=r}_resizeIndexBuffer(t){const e=this.indexBuffer;let r=Math.max(t,1.5*e.length);r+=r%2;const i=r>65535?new Uint32Array(r):new Uint16Array(r);if(i.BYTES_PER_ELEMENT!==e.BYTES_PER_ELEMENT)for(let t=0;t<e.length;t++)i[t]=e[t];else d(e.buffer,i.buffer);this.indexBuffer=i}packQuadIndex(t,e,r){t[e]=r+0,t[e+1]=r+1,t[e+2]=r+2,t[e+3]=r+0,t[e+4]=r+2,t[e+5]=r+3}packIndex(t,e,r,i){const s=t.indices,n=t.indexSize,a=t.indexOffset,o=t.attributeOffset;for(let t=0;t<n;t++)e[r++]=i+s[t+a]-o}destroy(){for(let t=0;t<this.batches.length;t++)y(this.batches[t]);this.batches=null;for(let t=0;t<this._elements.length;t++)this._elements[t]._batch=null;this._elements=null,this.indexBuffer=null,this.attributeBuffer.destroy(),this.attributeBuffer=null}};v.defaultOptions={maxTextures:null,attributesInitialSize:4,indicesInitialSize:6};let S=v;var w=r(949),T=r(1132),M=r(6011);const C=new Float32Array(1),P=new Uint32Array(1);class k extends M.V{constructor(){const t=new w.h({data:C,label:"attribute-batch-buffer",usage:T.S.VERTEX|T.S.COPY_DST,shrinkToFit:!1});super({attributes:{aPosition:{buffer:t,format:"float32x2",stride:24,offset:0},aUV:{buffer:t,format:"float32x2",stride:24,offset:8},aColor:{buffer:t,format:"unorm8x4",stride:24,offset:16},aTextureIdAndRound:{buffer:t,format:"uint16x2",stride:24,offset:20}},indexBuffer:new w.h({data:P,label:"index-batch-buffer",usage:T.S.INDEX|T.S.COPY_DST,shrinkToFit:!1})})}}var B=r(5611),R=r(4459),A=r(4e3),z=r(6665),F=r(6040),U=r(8475);class I extends U.M{constructor(t){super({glProgram:(0,B.I)({name:"batch",bits:[R.a,(0,A.P)(t),z.m]}),gpuProgram:(0,B.v)({name:"batch",bits:[R.F,(0,A._)(t),z.b]}),resources:{batchSamplers:(0,F.n)(t)}})}}let E=null;const G=class t extends S{constructor(){super(...arguments),this.geometry=new k,this.shader=E||(E=new I(this.maxTextures)),this.name=t.extension.name,this.vertexSize=6}packAttributes(t,e,r,i,s){const n=s<<16|65535&t.roundPixels,a=t.transform,o=a.a,h=a.b,l=a.c,u=a.d,c=a.tx,d=a.ty,{positions:f,uvs:p}=t,g=t.color,m=t.attributeOffset,x=m+t.attributeSize;for(let t=m;t<x;t++){const s=2*t,a=f[s],m=f[s+1];e[i++]=o*a+l*m+c,e[i++]=u*m+h*a+d,e[i++]=p[s],e[i++]=p[s+1],r[i++]=g,r[i++]=n}}packQuadAttributes(t,e,r,i,s){const n=t.texture,a=t.transform,o=a.a,h=a.b,l=a.c,u=a.d,c=a.tx,d=a.ty,f=t.bounds,p=f.maxX,g=f.minX,m=f.maxY,x=f.minY,_=n.uvs,y=t.color,b=s<<16|65535&t.roundPixels;e[i+0]=o*g+l*x+c,e[i+1]=u*x+h*g+d,e[i+2]=_.x0,e[i+3]=_.y0,r[i+4]=y,r[i+5]=b,e[i+6]=o*p+l*x+c,e[i+7]=u*x+h*p+d,e[i+8]=_.x1,e[i+9]=_.y1,r[i+10]=y,r[i+11]=b,e[i+12]=o*p+l*m+c,e[i+13]=u*m+h*p+d,e[i+14]=_.x2,e[i+15]=_.y2,r[i+16]=y,r[i+17]=b,e[i+18]=o*g+l*m+c,e[i+19]=u*m+h*g+d,e[i+20]=_.x3,e[i+21]=_.y3,r[i+22]=y,r[i+23]=b}};G.extension={type:[i.Ag.Batcher],name:"default"};let W=G;var V=r(848),O=r(4670),D=r(8218),L=r(9313),H=r(9252);function $(t,e,r,i,s){const n=e.a,a=e.b,o=e.c,h=e.d,l=e.tx,u=e.ty;r||(r=0),i||(i=2),s||(s=t.length/i-r);let c=r*i;for(let e=0;e<s;e++){const e=t[c],r=t[c+1];t[c]=n*e+o*r+l,t[c+1]=a*e+h*r+u,c+=i}}var j=r(6954);const X={extension:{type:i.Ag.ShapeBuilder,name:"circle"},build(t,e){let r,i,s,n,a,o;if("circle"===t.type){const e=t;r=e.x,i=e.y,a=o=e.radius,s=n=0}else if("ellipse"===t.type){const e=t;r=e.x,i=e.y,a=e.halfWidth,o=e.halfHeight,s=n=0}else{const e=t,h=e.width/2,l=e.height/2;r=e.x+h,i=e.y+l,a=o=Math.max(0,Math.min(e.radius,Math.min(h,l))),s=h-a,n=l-o}if(!(a>=0&&o>=0&&s>=0&&n>=0))return e;const h=Math.ceil(2.3*Math.sqrt(a+o)),l=8*h+(s?4:0)+(n?4:0);if(0===l)return e;if(0===h)return e[0]=e[6]=r+s,e[1]=e[3]=i+n,e[2]=e[4]=r-s,e[5]=e[7]=i-n,e;let u=0,c=4*h+(s?2:0)+2,d=c,f=l,p=s+a,g=n,m=r+p,x=r-p,_=i+g;if(e[u++]=m,e[u++]=_,e[--c]=_,e[--c]=x,n){const t=i-g;e[d++]=x,e[d++]=t,e[--f]=t,e[--f]=m}for(let t=1;t<h;t++){const l=Math.PI/2*(t/h),p=s+Math.cos(l)*a,g=n+Math.sin(l)*o,m=r+p,x=r-p,_=i+g,y=i-g;e[u++]=m,e[u++]=_,e[--c]=_,e[--c]=x,e[d++]=x,e[d++]=y,e[--f]=y,e[--f]=m}p=s,g=n+o,m=r+p,x=r-p,_=i+g;const y=i-g;return e[u++]=m,e[u++]=_,e[--f]=y,e[--f]=m,s&&(e[u++]=x,e[u++]=_,e[--f]=y,e[--f]=x),e},triangulate(t,e,r,i,s,n){if(0===t.length)return;let a=0,o=0;for(let e=0;e<t.length;e+=2)a+=t[e],o+=t[e+1];a/=t.length/2,o/=t.length/2;let h=i;e[h*r]=a,e[h*r+1]=o;const l=h++;for(let i=0;i<t.length;i+=2)e[h*r]=t[i],e[h*r+1]=t[i+1],i>0&&(s[n++]=h,s[n++]=l,s[n++]=h-1),h++;s[n++]=l+1,s[n++]=l,s[n++]=h-1}},N={...X,extension:{...X.extension,name:"ellipse"}},Y={...X,extension:{...X.extension,name:"roundedRectangle"}};var q=r(5101);const K=1e-4;function Q(t,e,r,i,s,n,a,o){let h,l;a?(h=i,l=-r):(h=-i,l=r);const u=t-r*s+h,c=e-i*s+l,d=t+r*n+h,f=e+i*n+l;return o.push(u,c),o.push(d,f),2}function Z(t,e,r,i,s,n,a,o){const h=r-t,l=i-e;let u=Math.atan2(h,l),c=Math.atan2(s-t,n-e);o&&u<c?u+=2*Math.PI:!o&&u>c&&(c+=2*Math.PI);let d=u;const f=c-u,p=Math.abs(f),g=Math.sqrt(h*h+l*l),m=1+(15*p*Math.sqrt(g)/Math.PI|0),x=f/m;if(d+=x,o){a.push(t,e),a.push(r,i);for(let r=1,i=d;r<m;r++,i+=x)a.push(t,e),a.push(t+Math.sin(i)*g,e+Math.cos(i)*g);a.push(t,e),a.push(s,n)}else{a.push(r,i),a.push(t,e);for(let r=1,i=d;r<m;r++,i+=x)a.push(t+Math.sin(i)*g,e+Math.cos(i)*g),a.push(t,e);a.push(s,n),a.push(t,e)}return 2*m}var J=r(6570);function tt(t,e,r,i,s,n,a){const o=J(t,e,2);if(!o)return;for(let t=0;t<o.length;t+=3)n[a++]=o[t]+s,n[a++]=o[t+1]+s,n[a++]=o[t+2]+s;let h=s*i;for(let e=0;e<t.length;e+=2)r[h]=t[e],r[h+1]=t[e+1],h+=i}const et=[],rt={extension:{type:i.Ag.ShapeBuilder,name:"polygon"},build(t,e){for(let r=0;r<t.points.length;r++)e[r]=t.points[r];return e},triangulate(t,e,r,i,s,n){tt(t,et,e,r,i,s,n)}},it={extension:{type:i.Ag.ShapeBuilder,name:"rectangle"},build(t,e){const r=t,i=r.x,s=r.y,n=r.width,a=r.height;return n>=0&&a>=0?(e[0]=i,e[1]=s,e[2]=i+n,e[3]=s,e[4]=i+n,e[5]=s+a,e[6]=i,e[7]=s+a,e):e},triangulate(t,e,r,i,s,n){let a=0;e[(i*=r)+a]=t[0],e[i+a+1]=t[1],a+=r,e[i+a]=t[2],e[i+a+1]=t[3],a+=r,e[i+a]=t[6],e[i+a+1]=t[7],a+=r,e[i+a]=t[4],e[i+a+1]=t[5],a+=r;const o=i/r;s[n++]=o,s[n++]=o+1,s[n++]=o+2,s[n++]=o+1,s[n++]=o+3,s[n++]=o+2}},st={extension:{type:i.Ag.ShapeBuilder,name:"triangle"},build:(t,e)=>(e[0]=t.x,e[1]=t.y,e[2]=t.x2,e[3]=t.y2,e[4]=t.x3,e[5]=t.y3,e),triangulate(t,e,r,i,s,n){let a=0;e[(i*=r)+a]=t[0],e[i+a+1]=t[1],a+=r,e[i+a]=t[2],e[i+a+1]=t[3],a+=r,e[i+a]=t[4],e[i+a+1]=t[5];const o=i/r;s[n++]=o,s[n++]=o+1,s[n++]=o+2}};var nt=r(7276);const at=new L.u,ot=new H.M,ht={};i.XO.handleByMap(i.Ag.ShapeBuilder,ht),i.XO.add(it,rt,st,X,N,Y);const lt=new H.M,ut=new L.u;function ct(t,e,r){const{vertices:i,uvs:s,indices:n}=r,a=n.length,o=i.length/2,h=[],l=ht.rectangle,u=lt,c=t.image;u.x=t.dx,u.y=t.dy,u.width=t.dw,u.height=t.dh;const d=t.transform;l.build(u,h),d&&$(h,d),l.triangulate(h,i,2,o,n,a);const f=c.uvs;s.push(f.x0,f.y0,f.x1,f.y1,f.x3,f.y3,f.x2,f.y2);const p=D.Z.get(j.G);p.indexOffset=a,p.indexSize=n.length-a,p.attributeOffset=o,p.attributeSize=i.length/2-o,p.baseColor=t.style,p.alpha=t.alpha,p.texture=c,p.geometryData=r,e.push(p)}function dt(t,e,r,i,s){const{vertices:a,uvs:o,indices:h}=s;t.shapePrimitives.forEach((({shape:t,transform:l,holes:u})=>{const c=h.length,d=a.length/2,f=[],p=ht[t.type];let g="triangle-list";if(p.build(t,f),l&&$(f,l),r){const r=t.closePath??!0,i=e;i.pixelLine?(function(t,e,r,i){const s=K;if(0===t.length)return;const n=t[0],a=t[1],o=t[t.length-2],h=t[t.length-1],l=e||Math.abs(n-o)<s&&Math.abs(a-h)<s,u=r,c=t.length/2,d=u.length/2;for(let e=0;e<c;e++)u.push(t[2*e]),u.push(t[2*e+1]);for(let t=0;t<c-1;t++)i.push(d+t,d+t+1);l&&i.push(d+c-1,d)}(f,r,a,h),g="line-list"):function(t,e,r,i,s,n){const a=K;if(0===t.length)return;const o=e;let h=o.alignment;if(.5!==e.alignment){let e=function(t){const e=t.length;if(e<6)return 1;let r=0;for(let i=0,s=t[e-2],n=t[e-1];i<e;i+=2){const e=t[i],a=t[i+1];r+=(e-s)*(a+n),s=e,n=a}return r<0?-1:1}(t);h=(h-.5)*e+.5}const l=new q.b(t[0],t[1]),u=new q.b(t[t.length-2],t[t.length-1]),c=i,d=Math.abs(l.x-u.x)<a&&Math.abs(l.y-u.y)<a;if(c){t=t.slice(),d&&(t.pop(),t.pop(),u.set(t[t.length-2],t[t.length-1]));const e=.5*(l.x+u.x),r=.5*(u.y+l.y);t.unshift(e,r),t.push(e,r)}const f=s,p=t.length/2;let g=t.length;const m=f.length/2,x=o.width/2,_=x*x,y=o.miterLimit*o.miterLimit;let b=t[0],v=t[1],S=t[2],w=t[3],T=0,M=0,C=-(v-w),P=b-S,k=0,B=0,R=Math.sqrt(C*C+P*P);C/=R,P/=R,C*=x,P*=x;const A=2*(1-h),z=2*h;c||("round"===o.cap?g+=Z(b-C*(A-z)*.5,v-P*(A-z)*.5,b-C*A,v-P*A,b+C*z,v+P*z,f,!0)+2:"square"===o.cap&&(g+=Q(b,v,C,P,A,z,!0,f))),f.push(b-C*A,v-P*A),f.push(b+C*z,v+P*z);for(let e=1;e<p-1;++e){b=t[2*(e-1)],v=t[2*(e-1)+1],S=t[2*e],w=t[2*e+1],T=t[2*(e+1)],M=t[2*(e+1)+1],C=-(v-w),P=b-S,R=Math.sqrt(C*C+P*P),C/=R,P/=R,C*=x,P*=x,k=-(w-M),B=S-T,R=Math.sqrt(k*k+B*B),k/=R,B/=R,k*=x,B*=x;const r=S-b,i=v-w,s=S-T,n=M-w,a=r*s+i*n,h=i*s-n*r,l=h<0;if(Math.abs(h)<.001*Math.abs(a)){f.push(S-C*A,w-P*A),f.push(S+C*z,w+P*z),a>=0&&("round"===o.join?g+=Z(S,w,S-C*A,w-P*A,S-k*A,w-B*A,f,!1)+4:g+=2,f.push(S-k*z,w-B*z),f.push(S+k*A,w+B*A));continue}const u=(-C+b)*(-P+w)-(-C+S)*(-P+v),c=(-k+T)*(-B+w)-(-k+S)*(-B+M),d=(r*c-s*u)/h,p=(n*u-i*c)/h,m=(d-S)*(d-S)+(p-w)*(p-w),F=S+(d-S)*A,U=w+(p-w)*A,I=S-(d-S)*z,E=w-(p-w)*z,G=l?A:z;m<=Math.min(r*r+i*i,s*s+n*n)+G*G*_?"bevel"===o.join||m/_>y?(l?(f.push(F,U),f.push(S+C*z,w+P*z),f.push(F,U),f.push(S+k*z,w+B*z)):(f.push(S-C*A,w-P*A),f.push(I,E),f.push(S-k*A,w-B*A),f.push(I,E)),g+=2):"round"===o.join?l?(f.push(F,U),f.push(S+C*z,w+P*z),g+=Z(S,w,S+C*z,w+P*z,S+k*z,w+B*z,f,!0)+4,f.push(F,U),f.push(S+k*z,w+B*z)):(f.push(S-C*A,w-P*A),f.push(I,E),g+=Z(S,w,S-C*A,w-P*A,S-k*A,w-B*A,f,!1)+4,f.push(S-k*A,w-B*A),f.push(I,E)):(f.push(F,U),f.push(I,E)):(f.push(S-C*A,w-P*A),f.push(S+C*z,w+P*z),"round"===o.join?g+=l?Z(S,w,S+C*z,w+P*z,S+k*z,w+B*z,f,!0)+2:Z(S,w,S-C*A,w-P*A,S-k*A,w-B*A,f,!1)+2:"miter"===o.join&&m/_<=y&&(l?(f.push(I,E),f.push(I,E)):(f.push(F,U),f.push(F,U)),g+=2),f.push(S-k*A,w-B*A),f.push(S+k*z,w+B*z),g+=2)}b=t[2*(p-2)],v=t[2*(p-2)+1],S=t[2*(p-1)],w=t[2*(p-1)+1],C=-(v-w),P=b-S,R=Math.sqrt(C*C+P*P),C/=R,P/=R,C*=x,P*=x,f.push(S-C*A,w-P*A),f.push(S+C*z,w+P*z),c||("round"===o.cap?g+=Z(S-C*(A-z)*.5,w-P*(A-z)*.5,S-C*A,w-P*A,S+C*z,w+P*z,f,!1)+2:"square"===o.cap&&(g+=Q(S,w,C,P,A,z,!1,f)));for(let t=m;t<g+m-2;++t)b=f[2*t],v=f[2*t+1],S=f[2*(t+1)],w=f[2*(t+1)+1],T=f[2*(t+2)],M=f[2*(t+2)+1],Math.abs(b*(w-M)+S*(M-v)+T*(v-w))<1e-8||n.push(t,t+1,t+2)}(f,i,0,r,a,h)}else if(u){const t=[],e=f.slice();(function(t){const e=[];for(let r=0;r<t.length;r++){const i=t[r].shape,s=[];ht[i.type].build(i,s),e.push(s)}return e})(u).forEach((r=>{t.push(e.length/2),e.push(...r)})),tt(e,t,a,2,d,h,c)}else p.triangulate(f,a,2,d,h,c);const m=o.length/2,x=e.texture;if(x!==n.g.WHITE){const r=function(t,e,r,i){const s=e.matrix?t.copyFrom(e.matrix).invert():t.identity();if("local"===e.textureSpace){const t=r.getBounds(ot);e.width&&t.pad(e.width);const{x:i,y:n}=t,a=1/t.width,o=1/t.height,h=-i*a,l=-n*o,u=s.a,c=s.b,d=s.c,f=s.d;s.a*=a,s.b*=a,s.c*=o,s.d*=o,s.tx=h*u+l*d+s.tx,s.ty=h*c+l*f+s.ty}else s.translate(e.texture.frame.x,e.texture.frame.y),s.scale(1/e.texture.source.width,1/e.texture.source.height);const n=e.texture.source.style;return e.fill instanceof nt._||"clamp-to-edge"!==n.addressMode||(n.addressMode="repeat",n.update()),i&&s.append(at.copyFrom(i).invert()),s}(ut,e,t,l);!function(t,e,r,i,s,n,a,o=null){let h=0;r*=e,s*=n;const l=o.a,u=o.b,c=o.c,d=o.d,f=o.tx,p=o.ty;for(;h<a;){const a=t[r],o=t[r+1];i[s]=l*a+c*o+f,i[s+1]=u*a+d*o+p,s+=n,r+=e,h++}}(a,2,d,o,m,2,a.length/2-d,r)}else!function(t,e,r,i){let s=0;for(e*=2;s<i;)t[e]=0,t[e+1]=0,e+=2,s++}(o,m,0,a.length/2-d);const _=D.Z.get(j.G);_.indexOffset=c,_.indexSize=h.length-c,_.attributeOffset=d,_.attributeSize=a.length/2-d,_.baseColor=e.color,_.alpha=e.alpha,_.texture=x,_.geometryData=s,_.topology=g,i.push(_)}))}class ft{constructor(){this.batches=[],this.geometryData={vertices:[],uvs:[],indices:[]}}}class pt{constructor(){this.batcher=new W,this.instructions=new V.L}init(){this.instructions.reset()}get geometry(){return(0,O.t6)(O.Ek,"GraphicsContextRenderData#geometry is deprecated, please use batcher.geometry instead."),this.batcher.geometry}}const gt=class t{constructor(t){this._gpuContextHash={},this._graphicsDataContextHash=Object.create(null),t.renderableGC.addManagedHash(this,"_gpuContextHash"),t.renderableGC.addManagedHash(this,"_graphicsDataContextHash")}init(e){t.defaultOptions.bezierSmoothness=e?.bezierSmoothness??t.defaultOptions.bezierSmoothness}getContextRenderData(t){return this._graphicsDataContextHash[t.uid]||this._initContextRenderData(t)}updateGpuContext(t){let e=this._gpuContextHash[t.uid]||this._initContext(t);if(t.dirty){e?this._cleanGraphicsContextData(t):e=this._initContext(t),function(t,e){const{geometryData:r,batches:i}=e;i.length=0,r.indices.length=0,r.vertices.length=0,r.uvs.length=0;for(let e=0;e<t.instructions.length;e++){const s=t.instructions[e];if("texture"===s.action)ct(s.data,i,r);else if("fill"===s.action||"stroke"===s.action){const t="stroke"===s.action,e=s.data.path.shapePath,n=s.data.style,a=s.data.hole;t&&a&&dt(a.shapePath,n,!0,i,r),a&&(e.shapePrimitives[e.shapePrimitives.length-1].holes=a.shapePath.shapePrimitives),dt(e,n,t,i,r)}}}(t,e);const r=t.batchMode;t.customShader||"no-batch"===r?e.isBatchable=!1:"auto"===r&&(e.isBatchable=e.geometryData.vertices.length<400),t.dirty=!1}return e}getGpuContext(t){return this._gpuContextHash[t.uid]||this._initContext(t)}_initContextRenderData(t){const e=D.Z.get(pt),{batches:r,geometryData:i}=this._gpuContextHash[t.uid],s=i.vertices.length,n=i.indices.length;for(let t=0;t<r.length;t++)r[t].applyTransform=!1;const a=e.batcher;a.ensureAttributeBuffer(s),a.ensureIndexBuffer(n),a.begin();for(let t=0;t<r.length;t++){const e=r[t];a.add(e)}a.finish(e.instructions);const o=a.geometry;o.indexBuffer.setDataWithSize(a.indexBuffer,a.indexSize,!0),o.buffers[0].setDataWithSize(a.attributeBuffer.float32View,a.attributeSize,!0);const l=a.batches;for(let t=0;t<l.length;t++){const e=l[t];e.bindGroup=h(e.textures.textures,e.textures.count)}return this._graphicsDataContextHash[t.uid]=e,e}_initContext(t){const e=new ft;return e.context=t,this._gpuContextHash[t.uid]=e,t.on("destroy",this.onGraphicsContextDestroy,this),this._gpuContextHash[t.uid]}onGraphicsContextDestroy(t){this._cleanGraphicsContextData(t),t.off("destroy",this.onGraphicsContextDestroy,this),this._gpuContextHash[t.uid]=null}_cleanGraphicsContextData(t){const e=this._gpuContextHash[t.uid];e.isBatchable||this._graphicsDataContextHash[t.uid]&&(D.Z.return(this.getContextRenderData(t)),this._graphicsDataContextHash[t.uid]=null),e.batches&&e.batches.forEach((t=>{D.Z.return(t)}))}destroy(){for(const t in this._gpuContextHash)this._gpuContextHash[t]&&this.onGraphicsContextDestroy(this._gpuContextHash[t].context)}};gt.extension={type:[i.Ag.WebGLSystem,i.Ag.WebGPUSystem,i.Ag.CanvasSystem],name:"graphicsContext"},gt.defaultOptions={bezierSmoothness:.5};let mt=gt},3513:(t,e,r)=>{"use strict";r.d(e,{T:()=>i});class i{constructor(t){this.resources=Object.create(null),this._dirty=!0;let e=0;for(const r in t){const i=t[r];this.setResource(i,e++)}this._updateKey()}_updateKey(){if(!this._dirty)return;this._dirty=!1;const t=[];let e=0;for(const r in this.resources)t[e++]=this.resources[r]._resourceId;this._key=t.join("|")}setResource(t,e){const r=this.resources[e];t!==r&&(r&&t.off?.("change",this.onResourceChange,this),t.on?.("change",this.onResourceChange,this),this.resources[e]=t,this._dirty=!0)}getResource(t){return this.resources[t]}_touch(t){const e=this.resources;for(const r in e)e[r]._touched=t}destroy(){const t=this.resources;for(const e in t){const r=t[e];r.off?.("change",this.onResourceChange,this)}this.resources=null}onResourceChange(t){if(this._dirty=!0,t.destroyed){const e=this.resources;for(const r in e)e[r]===t&&(e[r]=null)}else this._updateKey()}}},3548:(t,e,r)=>{"use strict";r.d(e,{r:()=>u});var i=r(2577),s=r(9313),n=r(7174),a=r(268),o=r(7276),h=r(2806);const l=1e5;function u(t,e,r,u=0){if(t.texture===n.g.WHITE&&!t.fill)return i.Q.shared.setValue(t.color).setAlpha(t.alpha??1).toHexa();if(!t.fill){const r=e.createPattern(t.texture.source.resource,"repeat"),i=t.matrix.copyTo(s.u.shared);return i.scale(t.texture.frame.width,t.texture.frame.height),r.setTransform(i),r}if(t.fill instanceof h.m){const r=t.fill,i=e.createPattern(r.texture.source.resource,"repeat"),n=r.transform.copyTo(s.u.shared);return n.scale(r.texture.frame.width,r.texture.frame.height),i.setTransform(n),i}if(t.fill instanceof o._){const s=t.fill,n="linear"===s.type,a="local"===s.textureSpace;let o,h=1,c=1;a&&r&&(h=r.width+u,c=r.height+u);let d=!1;if(n){const{start:t,end:r}=s;o=e.createLinearGradient(t.x*h,t.y*c,r.x*h,r.y*c),d=Math.abs(r.x-t.x)<Math.abs(.1*(r.y-t.y))}else{const{center:t,innerRadius:r,outerCenter:i,outerRadius:n}=s;o=e.createRadialGradient(t.x*h,t.y*c,r*h,i.x*h,i.y*c,n*h)}if(d&&a&&r){const t=r.lineHeight/c;for(let e=0;e<r.lines.length;e++){const n=(e*r.lineHeight+u/2)/c;s.colorStops.forEach((e=>{const r=n+e.offset*t;o.addColorStop(Math.floor(r*l)/l,i.Q.shared.setValue(e.color).toHex())}))}}else s.colorStops.forEach((t=>{o.addColorStop(t.offset,i.Q.shared.setValue(t.color).toHex())}));return o}return(0,a.R)("FillStyle not recognised",t),"red"}},3804:(t,e,r)=>{"use strict";r.d(e,{W:()=>n});var i=r(1761);let s;function n(){if(!s||s?.isContextLost()){const t=i.e.get().createCanvas();s=t.getContext("webgl",{})}return s}},3830:(t,e,r)=>{"use strict";var i=r(8507),s=r(2331),n=r(7547),a=r(5099),o=r(2760),h=r(8734),l=r(5060),u=r(9313),c=r(5611);const d={name:"local-uniform-bit",vertex:{header:"\n\n            struct LocalUniforms {\n                uTransformMatrix:mat3x3<f32>,\n                uColor:vec4<f32>,\n                uRound:f32,\n            }\n\n            @group(1) @binding(0) var<uniform> localUniforms : LocalUniforms;\n        ",main:"\n            vColor *= localUniforms.uColor;\n            modelMatrix *= localUniforms.uTransformMatrix;\n        ",end:"\n            if(localUniforms.uRound == 1)\n            {\n                vPosition = vec4(roundPixels(vPosition.xy, globalUniforms.uResolution), vPosition.zw);\n            }\n        "}},f=(d.vertex,d.vertex.header.replace("group(1)","group(2)"),{name:"local-uniform-bit",vertex:{header:"\n\n            uniform mat3 uTransformMatrix;\n            uniform vec4 uColor;\n            uniform float uRound;\n        ",main:"\n            vColor *= uColor;\n            modelMatrix = uTransformMatrix;\n        ",end:"\n            if(uRound == 1.)\n            {\n                gl_Position.xy = roundPixels(gl_Position.xy, uResolution);\n            }\n        "}});var p=r(6665),g=r(8475),m=r(5811),x=r(7174);const _={name:"tiling-bit",vertex:{header:"\n            struct TilingUniforms {\n                uMapCoord:mat3x3<f32>,\n                uClampFrame:vec4<f32>,\n                uClampOffset:vec2<f32>,\n                uTextureTransform:mat3x3<f32>,\n                uSizeAnchor:vec4<f32>\n            };\n\n            @group(2) @binding(0) var<uniform> tilingUniforms: TilingUniforms;\n            @group(2) @binding(1) var uTexture: texture_2d<f32>;\n            @group(2) @binding(2) var uSampler: sampler;\n        ",main:"\n            uv = (tilingUniforms.uTextureTransform * vec3(uv, 1.0)).xy;\n\n            position = (position - tilingUniforms.uSizeAnchor.zw) * tilingUniforms.uSizeAnchor.xy;\n        "},fragment:{header:"\n            struct TilingUniforms {\n                uMapCoord:mat3x3<f32>,\n                uClampFrame:vec4<f32>,\n                uClampOffset:vec2<f32>,\n                uTextureTransform:mat3x3<f32>,\n                uSizeAnchor:vec4<f32>\n            };\n\n            @group(2) @binding(0) var<uniform> tilingUniforms: TilingUniforms;\n            @group(2) @binding(1) var uTexture: texture_2d<f32>;\n            @group(2) @binding(2) var uSampler: sampler;\n        ",main:"\n\n            var coord = vUV + ceil(tilingUniforms.uClampOffset - vUV);\n            coord = (tilingUniforms.uMapCoord * vec3(coord, 1.0)).xy;\n            var unclamped = coord;\n            coord = clamp(coord, tilingUniforms.uClampFrame.xy, tilingUniforms.uClampFrame.zw);\n\n            var bias = 0.;\n\n            if(unclamped.x == coord.x && unclamped.y == coord.y)\n            {\n                bias = -32.;\n            } \n\n            outColor = textureSampleBias(uTexture, uSampler, coord, bias);\n        "}},y={name:"tiling-bit",vertex:{header:"\n            uniform mat3 uTextureTransform;\n            uniform vec4 uSizeAnchor;\n        \n        ",main:"\n            uv = (uTextureTransform * vec3(aUV, 1.0)).xy;\n\n            position = (position - uSizeAnchor.zw) * uSizeAnchor.xy;\n        "},fragment:{header:"\n            uniform sampler2D uTexture;\n            uniform mat3 uMapCoord;\n            uniform vec4 uClampFrame;\n            uniform vec2 uClampOffset;\n        ",main:"\n\n        vec2 coord = vUV + ceil(uClampOffset - vUV);\n        coord = (uMapCoord * vec3(coord, 1.0)).xy;\n        vec2 unclamped = coord;\n        coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n        \n        outColor = texture(uTexture, coord, unclamped == coord ? 0.0 : -32.0);// lod-bias very negative to force lod 0\n    \n        "}};let b,v;class S extends g.M{constructor(){b??(b=(0,c.v)({name:"tiling-sprite-shader",bits:[d,_,p.b]})),v??(v=(0,c.I)({name:"tiling-sprite-shader",bits:[f,y,p.m]}));const t=new m.k({uMapCoord:{value:new u.u,type:"mat3x3<f32>"},uClampFrame:{value:new Float32Array([0,0,1,1]),type:"vec4<f32>"},uClampOffset:{value:new Float32Array([0,0]),type:"vec2<f32>"},uTextureTransform:{value:new u.u,type:"mat3x3<f32>"},uSizeAnchor:{value:new Float32Array([100,100,.5,.5]),type:"vec4<f32>"}});super({glProgram:v,gpuProgram:b,resources:{localUniforms:new m.k({uTransformMatrix:{value:new u.u,type:"mat3x3<f32>"},uColor:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},uRound:{value:0,type:"f32"}}),tilingUniforms:t,uTexture:x.g.EMPTY.source,uSampler:x.g.EMPTY.source.style}})}updateUniforms(t,e,r,i,s,n){const a=this.resources.tilingUniforms,o=n.width,h=n.height,l=n.textureMatrix,u=a.uniforms.uTextureTransform;u.set(r.a*o/t,r.b*o/e,r.c*h/t,r.d*h/e,r.tx/t,r.ty/e),u.invert(),a.uniforms.uMapCoord=l.mapCoord,a.uniforms.uClampFrame=l.uClampFrame,a.uniforms.uClampOffset=l.uClampOffset,a.uniforms.uTextureTransform=u,a.uniforms.uSizeAnchor[0]=t,a.uniforms.uSizeAnchor[1]=e,a.uniforms.uSizeAnchor[2]=i,a.uniforms.uSizeAnchor[3]=s,n&&(this.resources.uTexture=n.source,this.resources.uSampler=n.source.style)}}class w extends l.u{constructor(){super({positions:new Float32Array([0,0,1,0,1,1,0,1]),uvs:new Float32Array([0,0,1,0,1,1,0,1]),indices:new Uint32Array([0,1,2,0,2,3])})}}const T=new w;class M{constructor(t){this._state=n.U.default2d,this._tilingSpriteDataHash=Object.create(null),this._destroyRenderableBound=this.destroyRenderable.bind(this),this._renderer=t,this._renderer.renderableGC.addManagedHash(this,"_tilingSpriteDataHash")}validateRenderable(t){const e=this._getTilingSpriteData(t),r=e.canBatch;this._updateCanBatch(t);const i=e.canBatch;if(i&&i===r){const{batchableMesh:r}=e;return!r._batcher.checkAndUpdateTexture(r,t.texture)}return r!==i}addRenderable(t,e){const r=this._renderer.renderPipes.batch;this._updateCanBatch(t);const i=this._getTilingSpriteData(t),{geometry:s,canBatch:n}=i;if(n){i.batchableMesh||(i.batchableMesh=new h.U);const n=i.batchableMesh;t.didViewUpdate&&(this._updateBatchableMesh(t),n.geometry=s,n.renderable=t,n.transform=t.groupTransform,n.setTexture(t._texture)),n.roundPixels=this._renderer._roundPixels|t._roundPixels,r.addToBatch(n,e)}else r.break(e),i.shader||(i.shader=new S),this.updateRenderable(t),e.add(t)}execute(t){const{shader:e}=this._tilingSpriteDataHash[t.uid];e.groups[0]=this._renderer.globalUniforms.bindGroup;const r=e.resources.localUniforms.uniforms;r.uTransformMatrix=t.groupTransform,r.uRound=this._renderer._roundPixels|t._roundPixels,(0,o.V)(t.groupColorAlpha,r.uColor,0),this._state.blendMode=(0,s.i)(t.groupBlendMode,t.texture._source),this._renderer.encoder.draw({geometry:T,shader:e,state:this._state})}updateRenderable(t){const e=this._getTilingSpriteData(t),{canBatch:r}=e;if(r){const{batchableMesh:r}=e;t.didViewUpdate&&this._updateBatchableMesh(t),r._batcher.updateElement(r)}else if(t.didViewUpdate){const{shader:r}=e;r.updateUniforms(t.width,t.height,t._tileTransform.matrix,t.anchor.x,t.anchor.y,t.texture)}}destroyRenderable(t){const e=this._getTilingSpriteData(t);e.batchableMesh=null,e.shader?.destroy(),this._tilingSpriteDataHash[t.uid]=null,t.off("destroyed",this._destroyRenderableBound)}_getTilingSpriteData(t){return this._tilingSpriteDataHash[t.uid]||this._initTilingSpriteData(t)}_initTilingSpriteData(t){const e=new l.u({indices:T.indices,positions:T.positions.slice(),uvs:T.uvs.slice()});return this._tilingSpriteDataHash[t.uid]={canBatch:!0,renderable:t,geometry:e},t.on("destroyed",this._destroyRenderableBound),this._tilingSpriteDataHash[t.uid]}_updateBatchableMesh(t){const e=this._getTilingSpriteData(t),{geometry:r}=e,i=t.texture.source.style;"repeat"!==i.addressMode&&(i.addressMode="repeat",i.update()),function(t,e){const r=t.texture,i=r.frame.width,s=r.frame.height;let n=0,a=0;t.applyAnchorToTexture&&(n=t.anchor.x,a=t.anchor.y),e[0]=e[6]=-n,e[2]=e[4]=1-n,e[1]=e[3]=-a,e[5]=e[7]=1-a;const o=u.u.shared;o.copyFrom(t._tileTransform.matrix),o.tx/=t.width,o.ty/=t.height,o.invert(),o.scale(t.width/i,t.height/s),function(t,e,r,i){let s=0;const n=t.length/2,a=i.a,o=i.b,h=i.c,l=i.d,u=i.tx,c=i.ty;for(r*=2;s<n;){const e=t[r],i=t[r+1];t[r]=a*e+h*i+u,t[r+1]=o*e+l*i+c,r+=2,s++}}(e,0,0,o)}(t,r.uvs),function(t,e){const r=t.anchor.x,i=t.anchor.y;e[0]=-r*t.width,e[1]=-i*t.height,e[2]=(1-r)*t.width,e[3]=-i*t.height,e[4]=(1-r)*t.width,e[5]=(1-i)*t.height,e[6]=-r*t.width,e[7]=(1-i)*t.height}(t,r.positions)}destroy(){for(const t in this._tilingSpriteDataHash)this.destroyRenderable(this._tilingSpriteDataHash[t].renderable);this._tilingSpriteDataHash=null,this._renderer=null}_updateCanBatch(t){const e=this._getTilingSpriteData(t),r=t.texture;let i=!0;return this._renderer.type===a.W.WEBGL&&(i=this._renderer.context.supports.nonPowOf2wrapping),e.canBatch=r.textureMatrix.isSimple&&(i||r.source.isPowerOfTwo),e.canBatch}}M.extension={type:[i.Ag.WebGLPipes,i.Ag.WebGPUPipes,i.Ag.CanvasPipes],name:"tilingSprite"},i.XO.add(M)},4e3:(t,e,r)=>{"use strict";r.d(e,{P:()=>l,_:()=>a});const i={};function s(t){const e=[];if(1===t)e.push("@group(1) @binding(0) var textureSource1: texture_2d<f32>;"),e.push("@group(1) @binding(1) var textureSampler1: sampler;");else{let r=0;for(let i=0;i<t;i++)e.push(`@group(1) @binding(${r++}) var textureSource${i+1}: texture_2d<f32>;`),e.push(`@group(1) @binding(${r++}) var textureSampler${i+1}: sampler;`)}return e.join("\n")}function n(t){const e=[];if(1===t)e.push("outColor = textureSampleGrad(textureSource1, textureSampler1, vUV, uvDx, uvDy);");else{e.push("switch vTextureId {");for(let r=0;r<t;r++)r===t-1?e.push("  default:{"):e.push(`  case ${r}:{`),e.push(`      outColor = textureSampleGrad(textureSource${r+1}, textureSampler${r+1}, vUV, uvDx, uvDy);`),e.push("      break;}");e.push("}")}return e.join("\n")}function a(t){return i[t]||(i[t]={name:"texture-batch-bit",vertex:{header:"\n                @in aTextureIdAndRound: vec2<u32>;\n                @out @interpolate(flat) vTextureId : u32;\n            ",main:"\n                vTextureId = aTextureIdAndRound.y;\n            ",end:"\n                if(aTextureIdAndRound.x == 1)\n                {\n                    vPosition = vec4<f32>(roundPixels(vPosition.xy, globalUniforms.uResolution), vPosition.zw);\n                }\n            "},fragment:{header:`\n                @in @interpolate(flat) vTextureId: u32;\n\n                ${s(t)}\n            `,main:`\n                var uvDx = dpdx(vUV);\n                var uvDy = dpdy(vUV);\n\n                ${n(t)}\n            `}}),i[t]}const o={};function h(t){const e=[];for(let r=0;r<t;r++)r>0&&e.push("else"),r<t-1&&e.push(`if(vTextureId < ${r}.5)`),e.push("{"),e.push(`\toutColor = texture(uTextures[${r}], vUV);`),e.push("}");return e.join("\n")}function l(t){return o[t]||(o[t]={name:"texture-batch-bit",vertex:{header:"\n                in vec2 aTextureIdAndRound;\n                out float vTextureId;\n\n            ",main:"\n                vTextureId = aTextureIdAndRound.y;\n            ",end:"\n                if(aTextureIdAndRound.x == 1.)\n                {\n                    gl_Position.xy = roundPixels(gl_Position.xy, uResolution);\n                }\n            "},fragment:{header:`\n                in float vTextureId;\n\n                uniform sampler2D uTextures[${t}];\n\n            `,main:`\n\n                ${h(t)}\n            `}}),o[t]}},4016:(t,e,r)=>{"use strict";r.d(e,{P:()=>o});var i=r(1761),s=r(1242);const n={willReadFrequently:!0},a=class t{static get experimentalLetterSpacingSupported(){let e=t._experimentalLetterSpacingSupported;if(void 0!==e){const r=i.e.get().getCanvasRenderingContext2D().prototype;e=t._experimentalLetterSpacingSupported="letterSpacing"in r||"textLetterSpacing"in r}return e}constructor(t,e,r,i,s,n,a,o,h){this.text=t,this.style=e,this.width=r,this.height=i,this.lines=s,this.lineWidths=n,this.lineHeight=a,this.maxLineWidth=o,this.fontProperties=h}static measureText(e=" ",r,i=t._canvas,n=r.wordWrap){const a=`${e}:${r.styleKey}`;if(t._measurementCache[a])return t._measurementCache[a];const o=(0,s.Z)(r),h=t.measureFont(o);0===h.fontSize&&(h.fontSize=r.fontSize,h.ascent=r.fontSize);const l=t.__context;l.font=o;const u=(n?t._wordWrap(e,r,i):e).split(/(?:\r\n|\r|\n)/),c=new Array(u.length);let d=0;for(let e=0;e<u.length;e++){const i=t._measureText(u[e],r.letterSpacing,l);c[e]=i,d=Math.max(d,i)}const f=r._stroke?.width||0;let p=d+f;r.dropShadow&&(p+=r.dropShadow.distance);const g=r.lineHeight||h.fontSize;let m=Math.max(g,h.fontSize+f)+(u.length-1)*(g+r.leading);return r.dropShadow&&(m+=r.dropShadow.distance),new t(e,r,p,m,u,c,g+r.leading,d,h)}static _measureText(e,r,i){let s=!1;t.experimentalLetterSpacingSupported&&(t.experimentalLetterSpacing?(i.letterSpacing=`${r}px`,i.textLetterSpacing=`${r}px`,s=!0):(i.letterSpacing="0px",i.textLetterSpacing="0px"));const n=i.measureText(e);let a=n.width;const o=-n.actualBoundingBoxLeft;let h=n.actualBoundingBoxRight-o;if(a>0)if(s)a-=r,h-=r;else{const i=(t.graphemeSegmenter(e).length-1)*r;a+=i,h+=i}return Math.max(a,h)}static _wordWrap(e,r,i=t._canvas){const s=i.getContext("2d",n);let a=0,o="",h="";const l=Object.create(null),{letterSpacing:u,whiteSpace:c}=r,d=t._collapseSpaces(c),f=t._collapseNewlines(c);let p=!d;const g=r.wordWrapWidth+u,m=t._tokenize(e);for(let e=0;e<m.length;e++){let i=m[e];if(t._isNewline(i)){if(!f){h+=t._addLine(o),p=!d,o="",a=0;continue}i=" "}if(d){const e=t.isBreakingSpace(i),r=t.isBreakingSpace(o[o.length-1]);if(e&&r)continue}const n=t._getFromCache(i,u,l,s);if(n>g)if(""!==o&&(h+=t._addLine(o),o="",a=0),t.canBreakWords(i,r.breakWords)){const e=t.wordWrapSplit(i);for(let n=0;n<e.length;n++){let c=e[n],d=c,f=1;for(;e[n+f];){const s=e[n+f];if(t.canBreakChars(d,s,i,n,r.breakWords))break;c+=s,d=s,f++}n+=f-1;const m=t._getFromCache(c,u,l,s);m+a>g&&(h+=t._addLine(o),p=!1,o="",a=0),o+=c,a+=m}}else{o.length>0&&(h+=t._addLine(o),o="",a=0);const r=e===m.length-1;h+=t._addLine(i,!r),p=!1,o="",a=0}else n+a>g&&(p=!1,h+=t._addLine(o),o="",a=0),(o.length>0||!t.isBreakingSpace(i)||p)&&(o+=i,a+=n)}return h+=t._addLine(o,!1),h}static _addLine(e,r=!0){return e=t._trimRight(e),r?`${e}\n`:e}static _getFromCache(e,r,i,s){let n=i[e];return"number"!=typeof n&&(n=t._measureText(e,r,s)+r,i[e]=n),n}static _collapseSpaces(t){return"normal"===t||"pre-line"===t}static _collapseNewlines(t){return"normal"===t}static _trimRight(e){if("string"!=typeof e)return"";for(let r=e.length-1;r>=0;r--){const i=e[r];if(!t.isBreakingSpace(i))break;e=e.slice(0,-1)}return e}static _isNewline(e){return"string"==typeof e&&t._newlines.includes(e.charCodeAt(0))}static isBreakingSpace(e,r){return"string"==typeof e&&t._breakingSpaces.includes(e.charCodeAt(0))}static _tokenize(e){const r=[];let i="";if("string"!=typeof e)return r;for(let s=0;s<e.length;s++){const n=e[s],a=e[s+1];t.isBreakingSpace(n,a)||t._isNewline(n)?(""!==i&&(r.push(i),i=""),r.push(n)):i+=n}return""!==i&&r.push(i),r}static canBreakWords(t,e){return e}static canBreakChars(t,e,r,i,s){return!0}static wordWrapSplit(e){return t.graphemeSegmenter(e)}static measureFont(e){if(t._fonts[e])return t._fonts[e];const r=t._context;r.font=e;const i=r.measureText(t.METRICS_STRING+t.BASELINE_SYMBOL),s={ascent:i.actualBoundingBoxAscent,descent:i.actualBoundingBoxDescent,fontSize:i.actualBoundingBoxAscent+i.actualBoundingBoxDescent};return t._fonts[e]=s,s}static clearMetrics(e=""){e?delete t._fonts[e]:t._fonts={}}static get _canvas(){if(!t.__canvas){let e;try{const r=new OffscreenCanvas(0,0),s=r.getContext("2d",n);if(s?.measureText)return t.__canvas=r,r;e=i.e.get().createCanvas()}catch(t){e=i.e.get().createCanvas()}e.width=e.height=10,t.__canvas=e}return t.__canvas}static get _context(){return t.__context||(t.__context=t._canvas.getContext("2d",n)),t.__context}};a.METRICS_STRING="|ÉqÅ",a.BASELINE_SYMBOL="M",a.BASELINE_MULTIPLIER=1.4,a.HEIGHT_MULTIPLIER=2,a.graphemeSegmenter=(()=>{if("function"==typeof Intl?.Segmenter){const t=new Intl.Segmenter;return e=>[...t.segment(e)].map((t=>t.segment))}return t=>[...t]})(),a.experimentalLetterSpacing=!1,a._fonts={},a._newlines=[10,13],a._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288],a._measurementCache={};let o=a},4459:(t,e,r)=>{"use strict";r.d(e,{F:()=>i,a:()=>s});const i={name:"color-bit",vertex:{header:"\n            @in aColor: vec4<f32>;\n        ",main:"\n            vColor *= vec4<f32>(aColor.rgb * aColor.a, aColor.a);\n        "}},s={name:"color-bit",vertex:{header:"\n            in vec4 aColor;\n        ",main:"\n            vColor *= vec4(aColor.rgb * aColor.a, aColor.a);\n        "}}},4577:(t,e,r)=>{"use strict";var i=r(8507),s=r(8218),n=r(8422),a=r(2289);class o{constructor(t){this._gpuText=Object.create(null),this._destroyRenderableBound=this.destroyRenderable.bind(this),this._renderer=t,this._renderer.runners.resolutionChange.add(this),this._renderer.renderableGC.addManagedHash(this,"_gpuText")}resolutionChange(){for(const t in this._gpuText){const e=this._gpuText[t];if(!e)continue;const r=e.batchableSprite.renderable;r._autoResolution&&(r._resolution=this._renderer.resolution,r.onViewUpdate())}}validateRenderable(t){const e=this._getGpuText(t),r=t._getKey();return e.currentKey!==r}addRenderable(t,e){const r=this._getGpuText(t).batchableSprite;t._didTextUpdate&&this._updateText(t),this._renderer.renderPipes.batch.addToBatch(r,e)}updateRenderable(t){const e=this._getGpuText(t).batchableSprite;t._didTextUpdate&&this._updateText(t),e._batcher.updateElement(e)}destroyRenderable(t){t.off("destroyed",this._destroyRenderableBound),this._destroyRenderableById(t.uid)}_destroyRenderableById(t){const e=this._gpuText[t];this._renderer.canvasText.decreaseReferenceCount(e.currentKey),s.Z.return(e.batchableSprite),this._gpuText[t]=null}_updateText(t){const e=t._getKey(),r=this._getGpuText(t),i=r.batchableSprite;r.currentKey!==e&&this._updateGpuText(t),t._didTextUpdate=!1,(0,a.s)(i,t)}_updateGpuText(t){const e=this._getGpuText(t),r=e.batchableSprite;e.texture&&this._renderer.canvasText.decreaseReferenceCount(e.currentKey),e.texture=r.texture=this._renderer.canvasText.getManagedTexture(t),e.currentKey=t._getKey(),r.texture=e.texture}_getGpuText(t){return this._gpuText[t.uid]||this.initGpuText(t)}initGpuText(t){const e={texture:null,currentKey:"--",batchableSprite:s.Z.get(n.K)};return e.batchableSprite.renderable=t,e.batchableSprite.transform=t.groupTransform,e.batchableSprite.bounds={minX:0,maxX:1,minY:0,maxY:0},e.batchableSprite.roundPixels=this._renderer._roundPixels|t._roundPixels,this._gpuText[t.uid]=e,t._resolution=t._autoResolution?this._renderer.resolution:t.resolution,this._updateText(t),t.on("destroyed",this._destroyRenderableBound),e}destroy(){for(const t in this._gpuText)this._destroyRenderableById(t);this._gpuText=null,this._renderer=null}}o.extension={type:[i.Ag.WebGLPipes,i.Ag.WebGPUPipes,i.Ag.CanvasPipes],name:"text"};var h=r(2577),l=r(9939),u=r(7608),c=r(2437),d=r(9252);function f(t,e,r){for(let i=0,s=4*r*e;i<e;++i,s+=4)if(0!==t[s+3])return!1;return!0}function p(t,e,r,i,s){const n=4*e;for(let e=i,a=i*n+4*r;e<=s;++e,a+=n)if(0!==t[a+3])return!1;return!0}var g=r(4670),m=r(8291),x=r(2558),_=r(4016),y=r(1242),b=r(3548);class v{constructor(t){this._activeTextures={},this._renderer=t}getTextureSize(t,e,r){const i=_.P.measureText(t||" ",r);let s=Math.ceil(Math.ceil(Math.max(1,i.width)+2*r.padding)*e),n=Math.ceil(Math.ceil(Math.max(1,i.height)+2*r.padding)*e);return s=Math.ceil(s-1e-6),n=Math.ceil(n-1e-6),s=(0,l.U5)(s),n=(0,l.U5)(n),{width:s,height:n}}getTexture(t,e,r,i){"string"==typeof t&&((0,g.t6)("8.0.0","CanvasTextSystem.getTexture: Use object TextOptions instead of separate arguments"),t={text:t,style:r,resolution:e}),t.style instanceof m.x||(t.style=new m.x(t.style));const{texture:s,canvasAndContext:n}=this.createTextureAndCanvas(t);return this._renderer.texture.initSource(s._source),u.N.returnCanvasAndContext(n),s}createTextureAndCanvas(t){const{text:e,style:r}=t,i=t.resolution??this._renderer.resolution,s=_.P.measureText(e||" ",r),n=Math.ceil(Math.ceil(Math.max(1,s.width)+2*r.padding)*i),a=Math.ceil(Math.ceil(Math.max(1,s.height)+2*r.padding)*i),o=u.N.getOptimalCanvasAndContext(n,a),{canvas:h}=o;this.renderTextToCanvas(e,r,i,o);const l=(0,x.M)(h,n,a,i);if(r.trim){const t=function(t,e=1){const{width:r,height:i}=t,s=t.getContext("2d",{willReadFrequently:!0});if(null===s)throw new TypeError("Failed to get canvas 2D context");const n=s.getImageData(0,0,r,i).data;let a=0,o=0,h=r-1,l=i-1;for(;o<i&&f(n,r,o);)++o;if(o===i)return d.M.EMPTY;for(;f(n,r,l);)--l;for(;p(n,r,a,o,l);)++a;for(;p(n,r,h,o,l);)--h;return++h,++l,new d.M(a/e,o/e,(h-a)/e,(l-o)/e)}(h,i);l.frame.copyFrom(t),l.updateUvs()}return{texture:l,canvasAndContext:o}}getManagedTexture(t){t._resolution=t._autoResolution?this._renderer.resolution:t.resolution;const e=t._getKey();if(this._activeTextures[e])return this._increaseReferenceCount(e),this._activeTextures[e].texture;const{texture:r,canvasAndContext:i}=this.createTextureAndCanvas(t);return this._activeTextures[e]={canvasAndContext:i,texture:r,usageCount:1},r}_increaseReferenceCount(t){this._activeTextures[t].usageCount++}returnTexture(t){const e=t.source;e.resource=null,e.uploadMethodId="unknown",e.alphaMode="no-premultiply-alpha",c.W.returnTexture(t)}decreaseReferenceCount(t){const e=this._activeTextures[t];e.usageCount--,0===e.usageCount&&(u.N.returnCanvasAndContext(e.canvasAndContext),this.returnTexture(e.texture),this._activeTextures[t]=null)}getReferenceCount(t){return this._activeTextures[t].usageCount}renderTextToCanvas(t,e,r,i){const{canvas:s,context:n}=i,a=(0,y.Z)(e),o=_.P.measureText(t||" ",e),l=o.lines,u=o.lineHeight,c=o.lineWidths,d=o.maxLineWidth,f=o.fontProperties,p=s.height;if(n.resetTransform(),n.scale(r,r),n.textBaseline=e.textBaseline,e._stroke?.width){const t=e._stroke;n.lineWidth=t.width,n.miterLimit=t.miterLimit,n.lineJoin=t.join,n.lineCap=t.cap}let g,m;n.font=a;const x=e.dropShadow?2:1;for(let t=0;t<x;++t){const s=e.dropShadow&&0===t,a=s?Math.ceil(Math.max(1,p)+2*e.padding):0,x=a*r;if(s){n.fillStyle="black",n.strokeStyle="black";const t=e.dropShadow,i=t.color,s=t.alpha;n.shadowColor=h.Q.shared.setValue(i).setAlpha(s).toRgbaString();const a=t.blur*r,o=t.distance*r;n.shadowBlur=a,n.shadowOffsetX=Math.cos(t.angle)*o,n.shadowOffsetY=Math.sin(t.angle)*o+x}else{if(n.fillStyle=e._fill?(0,b.r)(e._fill,n,o):null,e._stroke?.width){const t=e._stroke.width*e._stroke.alignment;n.strokeStyle=(0,b.r)(e._stroke,n,o,t)}n.shadowColor="black"}let _=(u-f.fontSize)/2;u-f.fontSize<0&&(_=0);const y=e._stroke?.width??0;for(let t=0;t<l.length;t++)g=y/2,m=y/2+t*u+f.ascent+_,"right"===e.align?g+=d-c[t]:"center"===e.align&&(g+=(d-c[t])/2),e._stroke?.width&&this._drawLetterSpacing(l[t],e,i,g+e.padding,m+e.padding-a,!0),void 0!==e._fill&&this._drawLetterSpacing(l[t],e,i,g+e.padding,m+e.padding-a)}}_drawLetterSpacing(t,e,r,i,s,n=!1){const{context:a}=r,o=e.letterSpacing;let h=!1;if(_.P.experimentalLetterSpacingSupported&&(_.P.experimentalLetterSpacing?(a.letterSpacing=`${o}px`,a.textLetterSpacing=`${o}px`,h=!0):(a.letterSpacing="0px",a.textLetterSpacing="0px")),0===o||h)return void(n?a.strokeText(t,i,s):a.fillText(t,i,s));let l=i;const u=_.P.graphemeSegmenter(t);let c=a.measureText(t).width,d=0;for(let t=0;t<u.length;++t){const e=u[t];n?a.strokeText(e,l,s):a.fillText(e,l,s);let r="";for(let e=t+1;e<u.length;++e)r+=u[e];d=a.measureText(r).width,l+=c-d+o,c=d}}destroy(){this._activeTextures=null}}v.extension={type:[i.Ag.WebGLSystem,i.Ag.WebGPUSystem,i.Ag.CanvasSystem],name:"canvasText"},i.XO.add(v),i.XO.add(o)},4732:(t,e,r)=>{"use strict";var i=r(8507);class s{static init(t){Object.defineProperty(this,"resizeTo",{set(t){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=t,t&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this._cancelResize(),this._resizeId=requestAnimationFrame((()=>this.resize())))},this._cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;let t,e;if(this._cancelResize(),this._resizeTo===globalThis.window)t=globalThis.innerWidth,e=globalThis.innerHeight;else{const{clientWidth:r,clientHeight:i}=this._resizeTo;t=r,e=i}this.renderer.resize(t,e),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this._cancelResize(),this._cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}s.extension=i.Ag.Application;var n=r(4458),a=r(7309);class o{static init(t){t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set(t){this._ticker&&this._ticker.remove(this.render,this),this._ticker=t,t&&t.add(this.render,this,n.d.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?a.R.shared:new a.R,t.autoStart&&this.start()}static destroy(){if(this._ticker){const t=this._ticker;this.ticker=null,t.destroy()}}}o.extension=i.Ag.Application,i.XO.add(s),i.XO.add(o)},4980:(t,e,r)=>{"use strict";var i=r(8507);class s{constructor(t){this._renderer=t}push(t,e,r){this._renderer.renderPipes.batch.break(r),r.add({renderPipeId:"filter",canBundle:!1,action:"pushFilter",container:e,filterEffect:t})}pop(t,e,r){this._renderer.renderPipes.batch.break(r),r.add({renderPipeId:"filter",action:"popFilter",canBundle:!1})}execute(t){"pushFilter"===t.action?this._renderer.filter.push(t):"popFilter"===t.action&&this._renderer.filter.pop()}destroy(){this._renderer=null}}s.extension={type:[i.Ag.WebGLPipes,i.Ag.WebGPUPipes,i.Ag.CanvasPipes],name:"filter"};var n=r(9313),a=r(5101),o=r(3513),h=r(6011),l=r(5811),u=r(7174),c=r(2437),d=r(5099),f=r(9636),p=r(268);const g=new h.V({attributes:{aPosition:{buffer:new Float32Array([0,0,1,0,1,1,0,1]),format:"float32x2",stride:8,offset:0}},indexBuffer:new Uint32Array([0,1,2,0,2,3])});class m{constructor(t){this._filterStackIndex=0,this._filterStack=[],this._filterGlobalUniforms=new l.k({uInputSize:{value:new Float32Array(4),type:"vec4<f32>"},uInputPixel:{value:new Float32Array(4),type:"vec4<f32>"},uInputClamp:{value:new Float32Array(4),type:"vec4<f32>"},uOutputFrame:{value:new Float32Array(4),type:"vec4<f32>"},uGlobalFrame:{value:new Float32Array(4),type:"vec4<f32>"},uOutputTexture:{value:new Float32Array(4),type:"vec4<f32>"}}),this._globalFilterBindGroup=new o.T({}),this.renderer=t}get activeBackTexture(){return this._activeFilterData?.backTexture}push(t){const e=this.renderer,r=t.filterEffect.filters;this._filterStack[this._filterStackIndex]||(this._filterStack[this._filterStackIndex]=this._getFilterData());const i=this._filterStack[this._filterStackIndex];if(this._filterStackIndex++,0===r.length)return void(i.skip=!0);const s=i.bounds;if(t.renderables?function(t,e){e.clear();const r=e.matrix;for(let r=0;r<t.length;r++){const i=t[r];i.globalDisplayStatus<7||(e.matrix=i.worldTransform,e.addBounds(i.bounds))}e.matrix=r}(t.renderables,s):t.filterEffect.filterArea?(s.clear(),s.addRect(t.filterEffect.filterArea),s.applyMatrix(t.container.worldTransform)):t.container.getFastGlobalBounds(!0,s),t.container){const e=(t.container.renderGroup||t.container.parentRenderGroup).cacheToLocalTransform;e&&s.applyMatrix(e)}const n=e.renderTarget.renderTarget.colorTexture.source;let a=1/0,o=0,h=!0,l=!1,u=!1,d=!0;for(let t=0;t<r.length;t++){const i=r[t];if(a=Math.min(a,"inherit"===i.resolution?n._resolution:i.resolution),o+=i.padding,"off"===i.antialias?h=!1:"inherit"===i.antialias&&h&&(h=n.antialias),i.clipToViewport||(d=!1),!(i.compatibleRenderers&e.type)){u=!1;break}if(i.blendRequired&&!(e.backBuffer?.useBackBuffer??1)){(0,p.R)("Blend filter requires backBuffer on WebGL renderer to be enabled. Set `useBackBuffer: true` in the renderer options."),u=!1;break}u=i.enabled||u,l||(l=i.blendRequired)}if(u){if(d){const t=e.renderTarget.rootViewPort,r=e.renderTarget.renderTarget.resolution;s.fitBounds(0,t.width/r,0,t.height/r)}s.scale(a).ceil().scale(1/a).pad(0|o),s.isPositive?(i.skip=!1,i.bounds=s,i.blendRequired=l,i.container=t.container,i.filterEffect=t.filterEffect,i.previousRenderSurface=e.renderTarget.renderSurface,i.inputTexture=c.W.getOptimalTexture(s.width,s.height,a,h),e.renderTarget.bind(i.inputTexture,!0),e.globalUniforms.push({offset:s})):i.skip=!0}else i.skip=!0}pop(){const t=this.renderer;this._filterStackIndex--;const e=this._filterStack[this._filterStackIndex];if(e.skip)return;this._activeFilterData=e;const r=e.inputTexture,i=e.bounds;let s=u.g.EMPTY;if(t.renderTarget.finishRenderPass(),e.blendRequired){const r=this._filterStackIndex>0?this._filterStack[this._filterStackIndex-1].bounds:null,n=t.renderTarget.getRenderTarget(e.previousRenderSurface);s=this.getBackTexture(n,i,r)}e.backTexture=s;const n=e.filterEffect.filters;if(this._globalFilterBindGroup.setResource(r.source.style,2),this._globalFilterBindGroup.setResource(s.source,3),t.globalUniforms.pop(),1===n.length)n[0].apply(this,r,e.previousRenderSurface,!1),c.W.returnTexture(r);else{let t=e.inputTexture,r=c.W.getOptimalTexture(i.width,i.height,t.source._resolution,!1),s=0;for(s=0;s<n.length-1;++s){n[s].apply(this,t,r,!0);const e=t;t=r,r=e}n[s].apply(this,t,e.previousRenderSurface,!1),c.W.returnTexture(t),c.W.returnTexture(r)}e.blendRequired&&c.W.returnTexture(s)}getBackTexture(t,e,r){const i=t.colorTexture.source._resolution,s=c.W.getOptimalTexture(e.width,e.height,i,!1);let n=e.minX,a=e.minY;r&&(n-=r.minX,a-=r.minY),n=Math.floor(n*i),a=Math.floor(a*i);const o=Math.ceil(e.width*i),h=Math.ceil(e.height*i);return this.renderer.renderTarget.copyToTexture(t,s,{x:n,y:a},{width:o,height:h},{x:0,y:0}),s}applyFilter(t,e,r,i){const s=this.renderer,n=this._filterStack[this._filterStackIndex],o=n.bounds,h=a.b.shared,l=n.previousRenderSurface===r;let c=this.renderer.renderTarget.rootRenderTarget.colorTexture.source._resolution,f=this._filterStackIndex-1;for(;f>0&&this._filterStack[f].skip;)--f;f>0&&(c=this._filterStack[f].inputTexture.source._resolution);const p=this._filterGlobalUniforms,m=p.uniforms,x=m.uOutputFrame,_=m.uInputSize,y=m.uInputPixel,b=m.uInputClamp,v=m.uGlobalFrame,S=m.uOutputTexture;if(l){let t=this._filterStackIndex;for(;t>0;){t--;const e=this._filterStack[this._filterStackIndex-1];if(!e.skip){h.x=e.bounds.minX,h.y=e.bounds.minY;break}}x[0]=o.minX-h.x,x[1]=o.minY-h.y}else x[0]=0,x[1]=0;x[2]=e.frame.width,x[3]=e.frame.height,_[0]=e.source.width,_[1]=e.source.height,_[2]=1/_[0],_[3]=1/_[1],y[0]=e.source.pixelWidth,y[1]=e.source.pixelHeight,y[2]=1/y[0],y[3]=1/y[1],b[0]=.5*y[2],b[1]=.5*y[3],b[2]=e.frame.width*_[2]-.5*y[2],b[3]=e.frame.height*_[3]-.5*y[3];const w=this.renderer.renderTarget.rootRenderTarget.colorTexture;v[0]=h.x*c,v[1]=h.y*c,v[2]=w.source.width*c,v[3]=w.source.height*c;const T=this.renderer.renderTarget.getRenderTarget(r);if(s.renderTarget.bind(r,!!i),r instanceof u.g?(S[0]=r.frame.width,S[1]=r.frame.height):(S[0]=T.width,S[1]=T.height),S[2]=T.isRoot?-1:1,p.update(),s.renderPipes.uniformBatch){const t=s.renderPipes.uniformBatch.getUboResource(p);this._globalFilterBindGroup.setResource(t,0)}else this._globalFilterBindGroup.setResource(p,0);this._globalFilterBindGroup.setResource(e.source,1),this._globalFilterBindGroup.setResource(e.source.style,2),t.groups[0]=this._globalFilterBindGroup,s.encoder.draw({geometry:g,shader:t,state:t._state,topology:"triangle-list"}),s.type===d.W.WEBGL&&s.renderTarget.finishRenderPass()}_getFilterData(){return{skip:!1,inputTexture:null,bounds:new f.c,container:null,filterEffect:null,blendRequired:!1,previousRenderSurface:null}}calculateSpriteMatrix(t,e){const r=this._activeFilterData,i=t.set(r.inputTexture._source.width,0,0,r.inputTexture._source.height,r.bounds.minX,r.bounds.minY),s=e.worldTransform.copyTo(n.u.shared),a=e.renderGroup||e.parentRenderGroup;return a&&a.cacheToLocalTransform&&s.prepend(a.cacheToLocalTransform),s.invert(),i.prepend(s),i.scale(1/e.texture.frame.width,1/e.texture.frame.height),i.translate(e.anchor.x,e.anchor.y),i}}m.extension={type:[i.Ag.WebGLSystem,i.Ag.WebGPUSystem],name:"filter"},i.XO.add(m),i.XO.add(s)},5060:(t,e,r)=>{"use strict";r.d(e,{u:()=>h});var i=r(949),s=r(1132),n=r(6011),a=r(4670);const o=class t extends n.V{constructor(...e){let r=e[0]??{};r instanceof Float32Array&&((0,a.t6)(a.lj,"use new MeshGeometry({ positions, uvs, indices }) instead"),r={positions:r,uvs:e[1],indices:e[2]}),r={...t.defaultOptions,...r};const n=r.positions||new Float32Array([0,0,1,0,1,1,0,1]);let o=r.uvs;o||(o=r.positions?new Float32Array(n.length):new Float32Array([0,0,1,0,1,1,0,1]));const h=r.indices||new Uint32Array([0,1,2,0,2,3]),l=r.shrinkBuffersToFit;super({attributes:{aPosition:{buffer:new i.h({data:n,label:"attribute-mesh-positions",shrinkToFit:l,usage:s.S.VERTEX|s.S.COPY_DST}),format:"float32x2",stride:8,offset:0},aUV:{buffer:new i.h({data:o,label:"attribute-mesh-uvs",shrinkToFit:l,usage:s.S.VERTEX|s.S.COPY_DST}),format:"float32x2",stride:8,offset:0}},indexBuffer:new i.h({data:h,label:"index-mesh-buffer",shrinkToFit:l,usage:s.S.INDEX|s.S.COPY_DST}),topology:r.topology}),this.batchMode="auto"}get positions(){return this.attributes.aPosition.buffer.data}set positions(t){this.attributes.aPosition.buffer.data=t}get uvs(){return this.attributes.aUV.buffer.data}set uvs(t){this.attributes.aUV.buffer.data=t}get indices(){return this.indexBuffer.data}set indices(t){this.indexBuffer.data=t}};o.defaultOptions={topology:"triangle-list",shrinkBuffersToFit:!1};let h=o},5099:(t,e,r)=>{"use strict";r.d(e,{W:()=>i});var i=(t=>(t[t.WEBGL=1]="WEBGL",t[t.WEBGPU=2]="WEBGPU",t[t.BOTH=3]="BOTH",t))(i||{})},5285:(t,e,r)=>{"use strict";var i=r(8507),s=r(9313),n=r(3513),a=r(5811),o=r(2331),h=r(8218),l=r(2760),u=r(8734);class c{constructor(t,e){this.localUniforms=new a.k({uTransformMatrix:{value:new s.u,type:"mat3x3<f32>"},uColor:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},uRound:{value:0,type:"f32"}}),this.localUniformsBindGroup=new n.T({0:this.localUniforms}),this._meshDataHash=Object.create(null),this._gpuBatchableMeshHash=Object.create(null),this._destroyRenderableBound=this.destroyRenderable.bind(this),this.renderer=t,this._adaptor=e,this._adaptor.init(),t.renderableGC.addManagedHash(this,"_gpuBatchableMeshHash"),t.renderableGC.addManagedHash(this,"_meshDataHash")}validateRenderable(t){const e=this._getMeshData(t),r=e.batched,i=t.batched;if(e.batched=i,r!==i)return!0;if(i){const r=t._geometry;if(r.indices.length!==e.indexSize||r.positions.length!==e.vertexSize)return e.indexSize=r.indices.length,e.vertexSize=r.positions.length,!0;const i=this._getBatchableMesh(t);return i.texture.uid!==t._texture.uid&&(i._textureMatrixUpdateId=-1),!i._batcher.checkAndUpdateTexture(i,t._texture)}return!1}addRenderable(t,e){const r=this.renderer.renderPipes.batch,{batched:i}=this._getMeshData(t);if(i){const i=this._getBatchableMesh(t);i.setTexture(t._texture),i.geometry=t._geometry,r.addToBatch(i,e)}else r.break(e),e.add(t)}updateRenderable(t){if(t.batched){const e=this._gpuBatchableMeshHash[t.uid];e.setTexture(t._texture),e.geometry=t._geometry,e._batcher.updateElement(e)}}destroyRenderable(t){this._meshDataHash[t.uid]=null;const e=this._gpuBatchableMeshHash[t.uid];e&&(h.Z.return(e),this._gpuBatchableMeshHash[t.uid]=null),t.off("destroyed",this._destroyRenderableBound)}execute(t){if(!t.isRenderable)return;t.state.blendMode=(0,o.i)(t.groupBlendMode,t.texture._source);const e=this.localUniforms;e.uniforms.uTransformMatrix=t.groupTransform,e.uniforms.uRound=this.renderer._roundPixels|t._roundPixels,e.update(),(0,l.V)(t.groupColorAlpha,e.uniforms.uColor,0),this._adaptor.execute(this,t)}_getMeshData(t){return this._meshDataHash[t.uid]||this._initMeshData(t)}_initMeshData(t){return this._meshDataHash[t.uid]={batched:t.batched,indexSize:t._geometry.indices?.length,vertexSize:t._geometry.positions?.length},t.on("destroyed",this._destroyRenderableBound),this._meshDataHash[t.uid]}_getBatchableMesh(t){return this._gpuBatchableMeshHash[t.uid]||this._initBatchableMesh(t)}_initBatchableMesh(t){const e=h.Z.get(u.U);return e.renderable=t,e.setTexture(t._texture),e.transform=t.groupTransform,e.roundPixels=this.renderer._roundPixels|t._roundPixels,this._gpuBatchableMeshHash[t.uid]=e,e}destroy(){for(const t in this._gpuBatchableMeshHash)this._gpuBatchableMeshHash[t]&&h.Z.return(this._gpuBatchableMeshHash[t]);this._gpuBatchableMeshHash=null,this._meshDataHash=null,this.localUniforms=null,this.localUniformsBindGroup=null,this._adaptor.destroy(),this._adaptor=null,this.renderer=null}}c.extension={type:[i.Ag.WebGLPipes,i.Ag.WebGPUPipes,i.Ag.CanvasPipes],name:"mesh"},i.XO.add(c)},5611:(t,e,r)=>{"use strict";r.d(e,{I:()=>C,v:()=>M});var i=r(9113),s=r(3012),n=r(268);function a(t,e,r){if(t)for(const i in t){const s=e[i.toLocaleLowerCase()];if(s){let e=t[i];"header"===i&&(e=e.replace(/@in\s+[^;]+;\s*/g,"").replace(/@out\s+[^;]+;\s*/g,"")),r&&s.push(`//----${r}----//`),s.push(e)}else(0,n.R)(`${i} placement hook does not exist in shader`)}}const o=/\{\{(.*?)\}\}/g;function h(t){const e={};return(t.match(o)?.map((t=>t.replace(/[{()}]/g,"")))??[]).forEach((t=>{e[t]=[]})),e}function l(t,e){let r;const i=/@in\s+([^;]+);/g;for(;null!==(r=i.exec(t));)e.push(r[1])}function u(t,e,r=!1){const i=[];l(e,i),t.forEach((t=>{t.header&&l(t.header,i)}));const s=i;r&&s.sort();const n=s.map(((t,e)=>`       @location(${e}) ${t},`)).join("\n");let a=e.replace(/@in\s+[^;]+;\s*/g,"");return a=a.replace("{{in}}",`\n${n}\n`),a}function c(t,e){let r;const i=/@out\s+([^;]+);/g;for(;null!==(r=i.exec(t));)e.push(r[1])}function d(t,e){let r=t;for(const t in e){const i=e[t];r=i.join("\n").length?r.replace(`{{${t}}}`,`//-----${t} START-----//\n${i.join("\n")}\n//----${t} FINISH----//`):r.replace(`{{${t}}}`,"")}return r}const f=Object.create(null),p=new Map;let g=0;function m({template:t,bits:e}){const r=x(t,e);return f[r]||(f[r]=_(t.vertex,t.fragment,e)),f[r]}function x(t,e){return e.map((t=>(p.has(t)||p.set(t,g++),p.get(t)))).sort(((t,e)=>t-e)).join("-")+t.vertex+t.fragment}function _(t,e,r){const i=h(t),s=h(e);return r.forEach((t=>{a(t.vertex,i,t.name),a(t.fragment,s,t.name)})),{vertex:d(t,i),fragment:d(e,s)}}const y="\n    @in aPosition: vec2<f32>;\n    @in aUV: vec2<f32>;\n\n    @out @builtin(position) vPosition: vec4<f32>;\n    @out vUV : vec2<f32>;\n    @out vColor : vec4<f32>;\n\n    {{header}}\n\n    struct VSOutput {\n        {{struct}}\n    };\n\n    @vertex\n    fn main( {{in}} ) -> VSOutput {\n\n        var worldTransformMatrix = globalUniforms.uWorldTransformMatrix;\n        var modelMatrix = mat3x3<f32>(\n            1.0, 0.0, 0.0,\n            0.0, 1.0, 0.0,\n            0.0, 0.0, 1.0\n          );\n        var position = aPosition;\n        var uv = aUV;\n\n        {{start}}\n        \n        vColor = vec4<f32>(1., 1., 1., 1.);\n\n        {{main}}\n\n        vUV = uv;\n\n        var modelViewProjectionMatrix = globalUniforms.uProjectionMatrix * worldTransformMatrix * modelMatrix;\n\n        vPosition =  vec4<f32>((modelViewProjectionMatrix *  vec3<f32>(position, 1.0)).xy, 0.0, 1.0);\n       \n        vColor *= globalUniforms.uWorldColorAlpha;\n\n        {{end}}\n\n        {{return}}\n    };\n",b="\n    @in vUV : vec2<f32>;\n    @in vColor : vec4<f32>;\n   \n    {{header}}\n\n    @fragment\n    fn main(\n        {{in}}\n      ) -> @location(0) vec4<f32> {\n        \n        {{start}}\n\n        var outColor:vec4<f32>;\n      \n        {{main}}\n        \n        var finalColor:vec4<f32> = outColor * vColor;\n\n        {{end}}\n\n        return finalColor;\n      };\n",v="\n    in vec2 aPosition;\n    in vec2 aUV;\n\n    out vec4 vColor;\n    out vec2 vUV;\n\n    {{header}}\n\n    void main(void){\n\n        mat3 worldTransformMatrix = uWorldTransformMatrix;\n        mat3 modelMatrix = mat3(\n            1.0, 0.0, 0.0,\n            0.0, 1.0, 0.0,\n            0.0, 0.0, 1.0\n          );\n        vec2 position = aPosition;\n        vec2 uv = aUV;\n        \n        {{start}}\n        \n        vColor = vec4(1.);\n        \n        {{main}}\n        \n        vUV = uv;\n        \n        mat3 modelViewProjectionMatrix = uProjectionMatrix * worldTransformMatrix * modelMatrix;\n\n        gl_Position = vec4((modelViewProjectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n\n        vColor *= uWorldColorAlpha;\n\n        {{end}}\n    }\n",S="\n   \n    in vec4 vColor;\n    in vec2 vUV;\n\n    out vec4 finalColor;\n\n    {{header}}\n\n    void main(void) {\n        \n        {{start}}\n\n        vec4 outColor;\n      \n        {{main}}\n        \n        finalColor = outColor * vColor;\n        \n        {{end}}\n    }\n",w={name:"global-uniforms-bit",vertex:{header:"\n        struct GlobalUniforms {\n            uProjectionMatrix:mat3x3<f32>,\n            uWorldTransformMatrix:mat3x3<f32>,\n            uWorldColorAlpha: vec4<f32>,\n            uResolution: vec2<f32>,\n        }\n\n        @group(0) @binding(0) var<uniform> globalUniforms : GlobalUniforms;\n        "}},T={name:"global-uniforms-bit",vertex:{header:"\n          uniform mat3 uProjectionMatrix;\n          uniform mat3 uWorldTransformMatrix;\n          uniform vec4 uWorldColorAlpha;\n          uniform vec2 uResolution;\n        "}};function M({bits:t,name:e}){const r=function({template:t,bits:e}){const r=x(t,e);if(f[r])return f[r];const{vertex:i,fragment:s}=function(t,e){const r=e.map((t=>t.vertex)).filter((t=>!!t)),i=e.map((t=>t.fragment)).filter((t=>!!t));let s=u(r,t.vertex,!0);return s=function(t,e){const r=[];c(e,r),t.forEach((t=>{t.header&&c(t.header,r)}));let i=0;const s=r.sort().map((t=>t.indexOf("builtin")>-1?t:`@location(${i++}) ${t}`)).join(",\n"),n=r.sort().map((t=>{return`       var ${e=t,e.replace(/@.*?\s+/g,"")};`;var e})).join("\n"),a=`return VSOutput(\n            ${r.sort().map((t=>` ${function(t){const e=/\b(\w+)\s*:/g.exec(t);return e?e[1]:""}(t)}`)).join(",\n")});`;let o=e.replace(/@out\s+[^;]+;\s*/g,"");return o=o.replace("{{struct}}",`\n${s}\n`),o=o.replace("{{start}}",`\n${n}\n`),o=o.replace("{{return}}",`\n${a}\n`),o}(r,s),{vertex:s,fragment:u(i,t.fragment,!0)}}(t,e);return f[r]=_(i,s,e),f[r]}({template:{fragment:b,vertex:y},bits:[w,...t]});return s.B.from({name:e,vertex:{source:r.vertex,entryPoint:"main"},fragment:{source:r.fragment,entryPoint:"main"}})}function C({bits:t,name:e}){return new i.M({name:e,...m({template:{vertex:v,fragment:S},bits:[T,...t]})})}},5811:(t,e,r)=>{"use strict";r.d(e,{k:()=>l});var i=r(133),s=r(7952);const n=["f32","i32","vec2<f32>","vec3<f32>","vec4<f32>","mat2x2<f32>","mat3x3<f32>","mat4x4<f32>","mat3x2<f32>","mat4x2<f32>","mat2x3<f32>","mat4x3<f32>","mat2x4<f32>","mat3x4<f32>","vec2<i32>","vec3<i32>","vec4<i32>"],a=n.reduce(((t,e)=>(t[e]=!0,t)),{});function o(t,e){switch(t){case"f32":return 0;case"vec2<f32>":return new Float32Array(2*e);case"vec3<f32>":return new Float32Array(3*e);case"vec4<f32>":return new Float32Array(4*e);case"mat2x2<f32>":return new Float32Array([1,0,0,1]);case"mat3x3<f32>":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4x4<f32>":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}const h=class t{constructor(e,r){this._touched=0,this.uid=(0,i.L)("uniform"),this._resourceType="uniformGroup",this._resourceId=(0,i.L)("resource"),this.isUniformGroup=!0,this._dirtyId=0,this.destroyed=!1,r={...t.defaultOptions,...r},this.uniformStructures=e;const h={};for(const t in e){const r=e[t];if(r.name=t,r.size=r.size??1,!a[r.type])throw new Error(`Uniform type ${r.type} is not supported. Supported uniform types are: ${n.join(", ")}`);r.value??(r.value=o(r.type,r.size)),h[t]=r.value}this.uniforms=h,this._dirtyId=1,this.ubo=r.ubo,this.isStatic=r.isStatic,this._signature=(0,s.X)(Object.keys(h).map((t=>`${t}-${e[t].type}`)).join("-"),"uniform-group")}update(){this._dirtyId++}};h.defaultOptions={ubo:!1,isStatic:!1};let l=h},5997:(t,e,r)=>{"use strict";r.d(e,{T:()=>Y});var i=r(8875),s=r(2577),n=r(9313),a=r(5101),o=r(7174),h=r(133),l=r(4670),u=r(9636),c=r(268),d=r(8133),f=r(9252);class p{constructor(t=0,e=0,r=0){this.type="circle",this.x=t,this.y=e,this.radius=r}clone(){return new p(this.x,this.y,this.radius)}contains(t,e){if(this.radius<=0)return!1;const r=this.radius*this.radius;let i=this.x-t,s=this.y-e;return i*=i,s*=s,i+s<=r}strokeContains(t,e,r,i=.5){if(0===this.radius)return!1;const s=this.x-t,n=this.y-e,a=this.radius,o=(1-i)*r,h=Math.sqrt(s*s+n*n);return h<=a+o&&h>a-(r-o)}getBounds(t){return t||(t=new f.M),t.x=this.x-this.radius,t.y=this.y-this.radius,t.width=2*this.radius,t.height=2*this.radius,t}copyFrom(t){return this.x=t.x,this.y=t.y,this.radius=t.radius,this}copyTo(t){return t.copyFrom(this),t}toString(){return`[pixi.js/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`}}class g{constructor(t=0,e=0,r=0,i=0){this.type="ellipse",this.x=t,this.y=e,this.halfWidth=r,this.halfHeight=i}clone(){return new g(this.x,this.y,this.halfWidth,this.halfHeight)}contains(t,e){if(this.halfWidth<=0||this.halfHeight<=0)return!1;let r=(t-this.x)/this.halfWidth,i=(e-this.y)/this.halfHeight;return r*=r,i*=i,r+i<=1}strokeContains(t,e,r,i=.5){const{halfWidth:s,halfHeight:n}=this;if(s<=0||n<=0)return!1;const a=r*(1-i),o=r-a,h=s-o,l=n-o,u=s+a,c=n+a,d=t-this.x,f=e-this.y;return d*d/(h*h)+f*f/(l*l)>1&&d*d/(u*u)+f*f/(c*c)<=1}getBounds(t){return t||(t=new f.M),t.x=this.x-this.halfWidth,t.y=this.y-this.halfHeight,t.width=2*this.halfWidth,t.height=2*this.halfHeight,t}copyFrom(t){return this.x=t.x,this.y=t.y,this.halfWidth=t.halfWidth,this.halfHeight=t.halfHeight,this}copyTo(t){return t.copyFrom(this),t}toString(){return`[pixi.js/math:Ellipse x=${this.x} y=${this.y} halfWidth=${this.halfWidth} halfHeight=${this.halfHeight}]`}}function m(t,e,r,i,s,n){const a=s-r,o=n-i,h=a*a+o*o;let l,u,c=-1;0!==h&&(c=((t-r)*a+(e-i)*o)/h),c<0?(l=r,u=i):c>1?(l=s,u=n):(l=r+c*a,u=i+c*o);const d=t-l,f=e-u;return d*d+f*f}class x{constructor(...t){this.type="polygon";let e=Array.isArray(t[0])?t[0]:t;if("number"!=typeof e[0]){const t=[];for(let r=0,i=e.length;r<i;r++)t.push(e[r].x,e[r].y);e=t}this.points=e,this.closePath=!0}isClockwise(){let t=0;const e=this.points,r=e.length;for(let i=0;i<r;i+=2){const s=e[i],n=e[i+1];t+=(e[(i+2)%r]-s)*(e[(i+3)%r]+n)}return t<0}containsPolygon(t){const e=this.getBounds(void 0),r=t.getBounds(void 0);if(!e.containsRect(r))return!1;const i=t.points;for(let t=0;t<i.length;t+=2){const e=i[t],r=i[t+1];if(!this.contains(e,r))return!1}return!0}clone(){const t=this.points.slice(),e=new x(t);return e.closePath=this.closePath,e}contains(t,e){let r=!1;const i=this.points.length/2;for(let s=0,n=i-1;s<i;n=s++){const i=this.points[2*s],a=this.points[2*s+1],o=this.points[2*n],h=this.points[2*n+1];a>e!=h>e&&t<(e-a)/(h-a)*(o-i)+i&&(r=!r)}return r}strokeContains(t,e,r,i=.5){const s=r*r,n=s*(1-i),a=s-n,{points:o}=this,h=o.length-(this.closePath?0:2);for(let r=0;r<h;r+=2){const i=o[r],s=o[r+1],h=o[(r+2)%o.length],l=o[(r+3)%o.length];if(m(t,e,i,s,h,l)<=(Math.sign((h-i)*(e-s)-(l-s)*(t-i))<0?a:n))return!0}return!1}getBounds(t){t||(t=new f.M);const e=this.points;let r=1/0,i=-1/0,s=1/0,n=-1/0;for(let t=0,a=e.length;t<a;t+=2){const a=e[t],o=e[t+1];r=a<r?a:r,i=a>i?a:i,s=o<s?o:s,n=o>n?o:n}return t.x=r,t.width=i-r,t.y=s,t.height=n-s,t}copyFrom(t){return this.points=t.points.slice(),this.closePath=t.closePath,this}copyTo(t){return t.copyFrom(this),t}toString(){return`[pixi.js/math:PolygoncloseStroke=${this.closePath}points=${this.points.reduce(((t,e)=>`${t}, ${e}`),"")}]`}get lastX(){return this.points[this.points.length-2]}get lastY(){return this.points[this.points.length-1]}get x(){return this.points[this.points.length-2]}get y(){return this.points[this.points.length-1]}}const _=(t,e,r,i,s,n,a)=>{const o=t-r,h=e-i,l=Math.sqrt(o*o+h*h);return l>=s-n&&l<=s+a};class y{constructor(t=0,e=0,r=0,i=0,s=20){this.type="roundedRectangle",this.x=t,this.y=e,this.width=r,this.height=i,this.radius=s}getBounds(t){return t||(t=new f.M),t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}clone(){return new y(this.x,this.y,this.width,this.height,this.radius)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.copyFrom(this),t}contains(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){const r=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(e>=this.y+r&&e<=this.y+this.height-r||t>=this.x+r&&t<=this.x+this.width-r)return!0;let i=t-(this.x+r),s=e-(this.y+r);const n=r*r;if(i*i+s*s<=n)return!0;if(i=t-(this.x+this.width-r),i*i+s*s<=n)return!0;if(s=e-(this.y+this.height-r),i*i+s*s<=n)return!0;if(i=t-(this.x+r),i*i+s*s<=n)return!0}return!1}strokeContains(t,e,r,i=.5){const{x:s,y:n,width:a,height:o,radius:h}=this,l=r*(1-i),u=r-l,c=s+h,d=n+h,f=s+a,p=n+o;return(t>=s-l&&t<=s+u||t>=f-u&&t<=f+l)&&e>=d&&e<=d+(o-2*h)||(e>=n-l&&e<=n+u||e>=p-u&&e<=p+l)&&t>=c&&t<=c+(a-2*h)||t<c&&e<d&&_(t,e,c,d,h,u,l)||t>f-h&&e<d&&_(t,e,f-h,d,h,u,l)||t>f-h&&e>p-h&&_(t,e,f-h,p-h,h,u,l)||t<c&&e>p-h&&_(t,e,c,p-h,h,u,l)}toString(){return`[pixi.js/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`}}var b=r(3228);const v=1.1920929e-7;function S(t,e,r,i,s,n,a,o,h,l){let u=(1-Math.min(.99,Math.max(0,l??b.GH.defaultOptions.bezierSmoothness)))/1;return u*=u,function(t,e,r,i,s,n,a,o,h,l){w(t,e,r,i,s,n,a,o,h,l,0),h.push(a,o)}(e,r,i,s,n,a,o,h,t,u),t}function w(t,e,r,i,s,n,a,o,h,l,u){if(u>8)return;Math.PI;const c=(t+r)/2,d=(e+i)/2,f=(r+s)/2,p=(i+n)/2,g=(s+a)/2,m=(n+o)/2,x=(c+f)/2,_=(d+p)/2,y=(f+g)/2,b=(p+m)/2,S=(x+y)/2,T=(_+b)/2;if(u>0){let u=a-t,c=o-e;const d=Math.abs((r-a)*c-(i-o)*u),f=Math.abs((s-a)*c-(n-o)*u);if(d>v&&f>v){if((d+f)*(d+f)<=l*(u*u+c*c))return void h.push(S,T)}else if(d>v){if(d*d<=l*(u*u+c*c))return void h.push(S,T)}else if(f>v){if(f*f<=l*(u*u+c*c))return void h.push(S,T)}else if(u=S-(t+a)/2,c=T-(e+o)/2,u*u+c*c<=l)return void h.push(S,T)}w(t,e,c,d,x,_,S,T,h,l,u+1),w(S,T,y,b,g,m,a,o,h,l,u+1)}function T(t,e,r,i,s,n,a,o){let h=(1-Math.min(.99,Math.max(0,o??b.GH.defaultOptions.bezierSmoothness)))/1;return h*=h,function(t,e,r,i,s,n,a,o){M(a,t,e,r,i,s,n,o,0),a.push(s,n)}(e,r,i,s,n,a,t,h),t}function M(t,e,r,i,s,n,a,o,h){if(h>8)return;Math.PI;const l=(e+i)/2,u=(r+s)/2,c=(i+n)/2,d=(s+a)/2,f=(l+c)/2,p=(u+d)/2;let g=n-e,m=a-r;const x=Math.abs((i-n)*m-(s-a)*g);if(x>1.1920929e-7){if(x*x<=o*(g*g+m*m))return void t.push(f,p)}else if(g=f-(e+n)/2,m=p-(r+a)/2,g*g+m*m<=o)return void t.push(f,p);M(t,e,r,l,u,f,p,o,h+1),M(t,f,p,c,d,n,a,o,h+1)}function C(t,e,r,i,s,n,a,o){let h=Math.abs(s-n);(!a&&s>n||a&&n>s)&&(h=2*Math.PI-h),o||(o=Math.max(6,Math.floor(6*Math.pow(i,1/3)*(h/Math.PI))));let l=h/(o=Math.max(o,3)),u=s;l*=a?-1:1;for(let s=0;s<o+1;s++){const s=e+Math.cos(u)*i,n=r+Math.sin(u)*i;t.push(s,n),u+=l}}const P=2*Math.PI,k={centerX:0,centerY:0,ang1:0,ang2:0},B=({x:t,y:e},r,i,s,n,a,o,h)=>{const l=s*(t*=r)-n*(e*=i),u=n*t+s*e;return h.x=l+a,h.y=u+o,h};function R(t,e){const r=-1.5707963267948966===e?-.551915024494:4/3*Math.tan(e/4),i=1.5707963267948966===e?.551915024494:r,s=Math.cos(t),n=Math.sin(t),a=Math.cos(t+e),o=Math.sin(t+e);return[{x:s-n*i,y:n+s*i},{x:a+o*i,y:o-a*i},{x:a,y:o}]}const A=(t,e,r,i)=>{let s=t*r+e*i;return s>1&&(s=1),s<-1&&(s=-1),(t*i-e*r<0?-1:1)*Math.acos(s)};const z=new f.M;class F{constructor(t){this.shapePrimitives=[],this._currentPoly=null,this._bounds=new u.c,this._graphicsPath2D=t,this.signed=t.checkForHoles}moveTo(t,e){return this.startPoly(t,e),this}lineTo(t,e){this._ensurePoly();const r=this._currentPoly.points,i=r[r.length-2],s=r[r.length-1];return i===t&&s===e||r.push(t,e),this}arc(t,e,r,i,s,n){return this._ensurePoly(!1),C(this._currentPoly.points,t,e,r,i,s,n),this}arcTo(t,e,r,i,s){return this._ensurePoly(),function(t,e,r,i,s,n){const a=t[t.length-2],o=t[t.length-1]-r,h=a-e,l=s-r,u=i-e,c=Math.abs(o*u-h*l);if(c<1e-8||0===n)return void(t[t.length-2]===e&&t[t.length-1]===r||t.push(e,r));const d=o*o+h*h,f=l*l+u*u,p=o*l+h*u,g=n*Math.sqrt(d)/c,m=n*Math.sqrt(f)/c,x=g*p/d,_=m*p/f,y=g*u+m*h,b=g*l+m*o,v=h*(m+x),S=o*(m+x),w=u*(g+_),T=l*(g+_);C(t,y+e,b+r,n,Math.atan2(S-b,v-y),Math.atan2(T-b,w-y),h*l>u*o)}(this._currentPoly.points,t,e,r,i,s),this}arcToSvg(t,e,r,i,s,n,a){return function(t,e,r,i,s,n,a,o=0,h=0,l=0){if(0===n||0===a)return;const u=Math.sin(o*P/360),c=Math.cos(o*P/360),d=c*(e-i)/2+u*(r-s)/2,f=-u*(e-i)/2+c*(r-s)/2;if(0===d&&0===f)return;n=Math.abs(n),a=Math.abs(a);const p=Math.pow(d,2)/Math.pow(n,2)+Math.pow(f,2)/Math.pow(a,2);p>1&&(n*=Math.sqrt(p),a*=Math.sqrt(p)),((t,e,r,i,s,n,a,o,h,l,u,c,d)=>{const f=Math.pow(s,2),p=Math.pow(n,2),g=Math.pow(u,2),m=Math.pow(c,2);let x=f*p-f*m-p*g;x<0&&(x=0),x/=f*m+p*g,x=Math.sqrt(x)*(a===o?-1:1);const _=x*s/n*c,y=x*-n/s*u,b=l*_-h*y+(t+r)/2,v=h*_+l*y+(e+i)/2,S=(u-_)/s,w=(c-y)/n,T=(-u-_)/s,M=(-c-y)/n,C=A(1,0,S,w);let k=A(S,w,T,M);0===o&&k>0&&(k-=P),1===o&&k<0&&(k+=P),d.centerX=b,d.centerY=v,d.ang1=C,d.ang2=k})(e,r,i,s,n,a,h,l,u,c,d,f,k);let{ang1:g,ang2:m}=k;const{centerX:x,centerY:_}=k;let y=Math.abs(m)/(P/4);Math.abs(1-y)<1e-7&&(y=1);const b=Math.max(Math.ceil(y),1);m/=b;let v=t[t.length-2],w=t[t.length-1];const T={x:0,y:0};for(let e=0;e<b;e++){const e=R(g,m),{x:r,y:i}=B(e[0],n,a,c,u,x,_,T),{x:s,y:o}=B(e[1],n,a,c,u,x,_,T),{x:h,y:l}=B(e[2],n,a,c,u,x,_,T);S(t,v,w,r,i,s,o,h,l),v=h,w=l,g+=m}}(this._currentPoly.points,this._currentPoly.lastX,this._currentPoly.lastY,n,a,t,e,r,i,s),this}bezierCurveTo(t,e,r,i,s,n,a){this._ensurePoly();const o=this._currentPoly;return S(this._currentPoly.points,o.lastX,o.lastY,t,e,r,i,s,n,a),this}quadraticCurveTo(t,e,r,i,s){this._ensurePoly();const n=this._currentPoly;return T(this._currentPoly.points,n.lastX,n.lastY,t,e,r,i,s),this}closePath(){return this.endPoly(!0),this}addPath(t,e){this.endPoly(),e&&!e.isIdentity()&&(t=t.clone(!0)).transform(e);const r=this.shapePrimitives,i=r.length;for(let e=0;e<t.instructions.length;e++){const r=t.instructions[e];this[r.action](...r.data)}if(t.checkForHoles&&r.length-i>1){let t=null;for(let e=i;e<r.length;e++){const i=r[e];if("polygon"===i.shape.type){const s=i.shape,n=t?.shape;n&&n.containsPolygon(s)?(t.holes||(t.holes=[]),t.holes.push(i),r.copyWithin(e,e+1),r.length--,e--):t=i}}}return this}finish(t=!1){this.endPoly(t)}rect(t,e,r,i,s){return this.drawShape(new f.M(t,e,r,i),s),this}circle(t,e,r,i){return this.drawShape(new p(t,e,r),i),this}poly(t,e,r){const i=new x(t);return i.closePath=e,this.drawShape(i,r),this}regularPoly(t,e,r,i,s=0,n){i=Math.max(0|i,3);const a=-1*Math.PI/2+s,o=2*Math.PI/i,h=[];for(let s=0;s<i;s++){const i=a-s*o;h.push(t+r*Math.cos(i),e+r*Math.sin(i))}return this.poly(h,!0,n),this}roundPoly(t,e,r,i,s,n=0,a){if(i=Math.max(0|i,3),s<=0)return this.regularPoly(t,e,r,i,n);const o=r*Math.sin(Math.PI/i)-.001;s=Math.min(s,o);const h=-1*Math.PI/2+n,l=2*Math.PI/i,u=(i-2)*Math.PI/i/2;for(let n=0;n<i;n++){const i=n*l+h,o=t+r*Math.cos(i),c=e+r*Math.sin(i),d=i+Math.PI+u,f=i-Math.PI-u,p=o+s*Math.cos(d),g=c+s*Math.sin(d),m=o+s*Math.cos(f),x=c+s*Math.sin(f);0===n?this.moveTo(p,g):this.lineTo(p,g),this.quadraticCurveTo(o,c,m,x,a)}return this.closePath()}roundShape(t,e,r=!1,i){return t.length<3?this:(r?function(t,e,r,i){const s=(t,e)=>Math.sqrt((t.x-e.x)**2+(t.y-e.y)**2),n=(t,e,r)=>({x:t.x+(e.x-t.x)*r,y:t.y+(e.y-t.y)*r}),a=e.length;for(let o=0;o<a;o++){const h=e[(o+1)%a],l=h.radius??r;if(l<=0){0===o?t.moveTo(h.x,h.y):t.lineTo(h.x,h.y);continue}const u=e[o],c=e[(o+2)%a],d=s(u,h);let f;f=d<1e-4?h:n(h,u,Math.min(d/2,l)/d);const p=s(c,h);let g;g=p<1e-4?h:n(h,c,Math.min(p/2,l)/p),0===o?t.moveTo(f.x,f.y):t.lineTo(f.x,f.y),t.quadraticCurveTo(h.x,h.y,g.x,g.y,i)}}(this,t,e,i):function(t,e,r){const i=(t,e)=>{const r=e.x-t.x,i=e.y-t.y,s=Math.sqrt(r*r+i*i);return{len:s,nx:r/s,ny:i/s}},s=(e,r)=>{0===e?t.moveTo(r.x,r.y):t.lineTo(r.x,r.y)};let n=e[e.length-1];for(let a=0;a<e.length;a++){const o=e[a%e.length],h=o.radius??r;if(h<=0){s(a,o),n=o;continue}const l=e[(a+1)%e.length],u=i(o,n),c=i(o,l);if(u.len<1e-4||c.len<1e-4){s(a,o),n=o;continue}let d=Math.asin(u.nx*c.ny-u.ny*c.nx),f=1,p=!1;u.nx*c.nx-u.ny*-c.ny<0?d<0?d=Math.PI+d:(d=Math.PI-d,f=-1,p=!0):d>0&&(f=-1,p=!0);const g=d/2;let m,x=Math.abs(Math.cos(g)*h/Math.sin(g));x>Math.min(u.len/2,c.len/2)?(x=Math.min(u.len/2,c.len/2),m=Math.abs(x*Math.sin(g)/Math.cos(g))):m=h;const _=o.x+c.nx*x+-c.ny*m*f,y=o.y+c.ny*x+c.nx*m*f,b=Math.atan2(u.ny,u.nx)+Math.PI/2*f,v=Math.atan2(c.ny,c.nx)-Math.PI/2*f;0===a&&t.moveTo(_+Math.cos(b)*m,y+Math.sin(b)*m),t.arc(_,y,m,b,v,p),n=o}}(this,t,e),this.closePath())}filletRect(t,e,r,i,s){if(0===s)return this.rect(t,e,r,i);const n=Math.min(r,i)/2,a=Math.min(n,Math.max(-n,s)),o=t+r,h=e+i,l=a<0?-a:0,u=Math.abs(a);return this.moveTo(t,e+u).arcTo(t+l,e+l,t+u,e,u).lineTo(o-u,e).arcTo(o-l,e+l,o,e+u,u).lineTo(o,h-u).arcTo(o-l,h-l,t+r-u,h,u).lineTo(t+u,h).arcTo(t+l,h-l,t,h-u,u).closePath()}chamferRect(t,e,r,i,s,n){if(s<=0)return this.rect(t,e,r,i);const a=Math.min(s,Math.min(r,i)/2),o=t+r,h=e+i,l=[t+a,e,o-a,e,o,e+a,o,h-a,o-a,h,t+a,h,t,h-a,t,e+a];for(let t=l.length-1;t>=2;t-=2)l[t]===l[t-2]&&l[t-1]===l[t-3]&&l.splice(t-1,2);return this.poly(l,!0,n)}ellipse(t,e,r,i,s){return this.drawShape(new g(t,e,r,i),s),this}roundRect(t,e,r,i,s,n){return this.drawShape(new y(t,e,r,i,s),n),this}drawShape(t,e){return this.endPoly(),this.shapePrimitives.push({shape:t,transform:e}),this}startPoly(t,e){let r=this._currentPoly;return r&&this.endPoly(),r=new x,r.points.push(t,e),this._currentPoly=r,this}endPoly(t=!1){const e=this._currentPoly;return e&&e.points.length>2&&(e.closePath=t,this.shapePrimitives.push({shape:e})),this._currentPoly=null,this}_ensurePoly(t=!0){if(!this._currentPoly&&(this._currentPoly=new x,t)){const t=this.shapePrimitives[this.shapePrimitives.length-1];if(t){let e=t.shape.x,r=t.shape.y;if(t.transform&&!t.transform.isIdentity()){const i=t.transform,s=e;e=i.a*e+i.c*r+i.tx,r=i.b*s+i.d*r+i.ty}this._currentPoly.points.push(e,r)}else this._currentPoly.points.push(0,0)}}buildPath(){const t=this._graphicsPath2D;this.shapePrimitives.length=0,this._currentPoly=null;for(let e=0;e<t.instructions.length;e++){const r=t.instructions[e];this[r.action](...r.data)}this.finish()}get bounds(){const t=this._bounds;t.clear();const e=this.shapePrimitives;for(let r=0;r<e.length;r++){const i=e[r],s=i.shape.getBounds(z);i.transform?t.addRect(s,i.transform):t.addRect(s)}return t}}class U{constructor(t,e=!1){this.instructions=[],this.uid=(0,h.L)("graphicsPath"),this._dirty=!0,this.checkForHoles=e,"string"==typeof t?function(t,e){const r=d(t),i=[];let s=null,n=0,a=0;for(let t=0;t<r.length;t++){const o=r[t],h=o[0],l=o;switch(h){case"M":n=l[1],a=l[2],e.moveTo(n,a);break;case"m":n+=l[1],a+=l[2],e.moveTo(n,a);break;case"H":n=l[1],e.lineTo(n,a);break;case"h":n+=l[1],e.lineTo(n,a);break;case"V":a=l[1],e.lineTo(n,a);break;case"v":a+=l[1],e.lineTo(n,a);break;case"L":n=l[1],a=l[2],e.lineTo(n,a);break;case"l":n+=l[1],a+=l[2],e.lineTo(n,a);break;case"C":n=l[5],a=l[6],e.bezierCurveTo(l[1],l[2],l[3],l[4],n,a);break;case"c":e.bezierCurveTo(n+l[1],a+l[2],n+l[3],a+l[4],n+l[5],a+l[6]),n+=l[5],a+=l[6];break;case"S":n=l[3],a=l[4],e.bezierCurveToShort(l[1],l[2],n,a);break;case"s":e.bezierCurveToShort(n+l[1],a+l[2],n+l[3],a+l[4]),n+=l[3],a+=l[4];break;case"Q":n=l[3],a=l[4],e.quadraticCurveTo(l[1],l[2],n,a);break;case"q":e.quadraticCurveTo(n+l[1],a+l[2],n+l[3],a+l[4]),n+=l[3],a+=l[4];break;case"T":n=l[1],a=l[2],e.quadraticCurveToShort(n,a);break;case"t":n+=l[1],a+=l[2],e.quadraticCurveToShort(n,a);break;case"A":n=l[6],a=l[7],e.arcToSvg(l[1],l[2],l[3],l[4],l[5],n,a);break;case"a":n+=l[6],a+=l[7],e.arcToSvg(l[1],l[2],l[3],l[4],l[5],n,a);break;case"Z":case"z":e.closePath(),i.length>0&&(s=i.pop(),s?(n=s.startX,a=s.startY):(n=0,a=0)),s=null;break;default:(0,c.R)(`Unknown SVG path command: ${h}`)}"Z"!==h&&"z"!==h&&null===s&&(s={startX:n,startY:a},i.push(s))}}(t,this):this.instructions=t?.slice()??[]}get shapePath(){return this._shapePath||(this._shapePath=new F(this)),this._dirty&&(this._dirty=!1,this._shapePath.buildPath()),this._shapePath}addPath(t,e){return t=t.clone(),this.instructions.push({action:"addPath",data:[t,e]}),this._dirty=!0,this}arc(...t){return this.instructions.push({action:"arc",data:t}),this._dirty=!0,this}arcTo(...t){return this.instructions.push({action:"arcTo",data:t}),this._dirty=!0,this}arcToSvg(...t){return this.instructions.push({action:"arcToSvg",data:t}),this._dirty=!0,this}bezierCurveTo(...t){return this.instructions.push({action:"bezierCurveTo",data:t}),this._dirty=!0,this}bezierCurveToShort(t,e,r,i,s){const n=this.instructions[this.instructions.length-1],o=this.getLastPoint(a.b.shared);let h=0,l=0;if(n&&"bezierCurveTo"===n.action){h=n.data[2],l=n.data[3];const t=o.x,e=o.y;h=t+(t-h),l=e+(e-l)}else h=o.x,l=o.y;return this.instructions.push({action:"bezierCurveTo",data:[h,l,t,e,r,i,s]}),this._dirty=!0,this}closePath(){return this.instructions.push({action:"closePath",data:[]}),this._dirty=!0,this}ellipse(...t){return this.instructions.push({action:"ellipse",data:t}),this._dirty=!0,this}lineTo(...t){return this.instructions.push({action:"lineTo",data:t}),this._dirty=!0,this}moveTo(...t){return this.instructions.push({action:"moveTo",data:t}),this}quadraticCurveTo(...t){return this.instructions.push({action:"quadraticCurveTo",data:t}),this._dirty=!0,this}quadraticCurveToShort(t,e,r){const i=this.instructions[this.instructions.length-1],s=this.getLastPoint(a.b.shared);let n=0,o=0;if(i&&"quadraticCurveTo"===i.action){n=i.data[0],o=i.data[1];const t=s.x,e=s.y;n=t+(t-n),o=e+(e-o)}else n=s.x,o=s.y;return this.instructions.push({action:"quadraticCurveTo",data:[n,o,t,e,r]}),this._dirty=!0,this}rect(t,e,r,i,s){return this.instructions.push({action:"rect",data:[t,e,r,i,s]}),this._dirty=!0,this}circle(t,e,r,i){return this.instructions.push({action:"circle",data:[t,e,r,i]}),this._dirty=!0,this}roundRect(...t){return this.instructions.push({action:"roundRect",data:t}),this._dirty=!0,this}poly(...t){return this.instructions.push({action:"poly",data:t}),this._dirty=!0,this}regularPoly(...t){return this.instructions.push({action:"regularPoly",data:t}),this._dirty=!0,this}roundPoly(...t){return this.instructions.push({action:"roundPoly",data:t}),this._dirty=!0,this}roundShape(...t){return this.instructions.push({action:"roundShape",data:t}),this._dirty=!0,this}filletRect(...t){return this.instructions.push({action:"filletRect",data:t}),this._dirty=!0,this}chamferRect(...t){return this.instructions.push({action:"chamferRect",data:t}),this._dirty=!0,this}star(t,e,r,i,s,n,a){s||(s=i/2);const o=-1*Math.PI/2+n,h=2*r,l=2*Math.PI/h,u=[];for(let r=0;r<h;r++){const n=r%2?s:i,a=r*l+o;u.push(t+n*Math.cos(a),e+n*Math.sin(a))}return this.poly(u,!0,a),this}clone(t=!1){const e=new U;if(e.checkForHoles=this.checkForHoles,t)for(let t=0;t<this.instructions.length;t++){const r=this.instructions[t];e.instructions.push({action:r.action,data:r.data.slice()})}else e.instructions=this.instructions.slice();return e}clear(){return this.instructions.length=0,this._dirty=!0,this}transform(t){if(t.isIdentity())return this;const e=t.a,r=t.b,i=t.c,s=t.d,n=t.tx,a=t.ty;let o=0,h=0,l=0,u=0,d=0,f=0,p=0,g=0;for(let m=0;m<this.instructions.length;m++){const x=this.instructions[m],_=x.data;switch(x.action){case"moveTo":case"lineTo":o=_[0],h=_[1],_[0]=e*o+i*h+n,_[1]=r*o+s*h+a;break;case"bezierCurveTo":l=_[0],u=_[1],d=_[2],f=_[3],o=_[4],h=_[5],_[0]=e*l+i*u+n,_[1]=r*l+s*u+a,_[2]=e*d+i*f+n,_[3]=r*d+s*f+a,_[4]=e*o+i*h+n,_[5]=r*o+s*h+a;break;case"quadraticCurveTo":l=_[0],u=_[1],o=_[2],h=_[3],_[0]=e*l+i*u+n,_[1]=r*l+s*u+a,_[2]=e*o+i*h+n,_[3]=r*o+s*h+a;break;case"arcToSvg":o=_[5],h=_[6],p=_[0],g=_[1],_[0]=e*p+i*g,_[1]=r*p+s*g,_[5]=e*o+i*h+n,_[6]=r*o+s*h+a;break;case"circle":_[4]=I(_[3],t);break;case"rect":_[4]=I(_[4],t);break;case"ellipse":_[8]=I(_[8],t);break;case"roundRect":_[5]=I(_[5],t);break;case"addPath":_[0].transform(t);break;case"poly":_[2]=I(_[2],t);break;default:(0,c.R)("unknown transform action",x.action)}}return this._dirty=!0,this}get bounds(){return this.shapePath.bounds}getLastPoint(t){let e=this.instructions.length-1,r=this.instructions[e];if(!r)return t.x=0,t.y=0,t;for(;"closePath"===r.action;){if(e--,e<0)return t.x=0,t.y=0,t;r=this.instructions[e]}switch(r.action){case"moveTo":case"lineTo":t.x=r.data[0],t.y=r.data[1];break;case"quadraticCurveTo":t.x=r.data[2],t.y=r.data[3];break;case"bezierCurveTo":t.x=r.data[4],t.y=r.data[5];break;case"arc":case"arcToSvg":t.x=r.data[5],t.y=r.data[6];break;case"addPath":r.data[0].getLastPoint(t)}return t}}function I(t,e){return t?t.prepend(e):e.clone()}var E=r(7276);function G(t,e,r){const i=t.getAttribute(e);return i?Number(i):r}function W(t){const e=G(t,"x1",0),r=G(t,"y1",0),i=G(t,"x2",1),n=G(t,"y2",0),a=t.getAttribute("gradientUnits")||"objectBoundingBox",o=new E._(e,r,i,n,"objectBoundingBox"===a?"local":"global");for(let e=0;e<t.children.length;e++){const r=t.children[e],i=G(r,"offset",0),n=s.Q.shared.setValue(r.getAttribute("stop-color")).toNumber();o.addColorStop(i,n)}return o}function V(t){const e=t.match(/url\s*\(\s*['"]?\s*#([^'"\s)]+)\s*['"]?\s*\)/i);return e?e[1]:""}const O={fill:{type:"paint",default:0},"fill-opacity":{type:"number",default:1},stroke:{type:"paint",default:0},"stroke-width":{type:"number",default:1},"stroke-opacity":{type:"number",default:1},"stroke-linecap":{type:"string",default:"butt"},"stroke-linejoin":{type:"string",default:"miter"},"stroke-miterlimit":{type:"number",default:10},"stroke-dasharray":{type:"string",default:"none"},"stroke-dashoffset":{type:"number",default:0},opacity:{type:"number",default:1}};function D(t,e){const r=t.getAttribute("style"),i={},s={},n={strokeStyle:i,fillStyle:s,useFill:!1,useStroke:!1};for(const r in O){const i=t.getAttribute(r);i&&L(e,n,r,i.trim())}if(r){const t=r.split(";");for(let r=0;r<t.length;r++){const i=t[r].trim(),[s,a]=i.split(":");O[s]&&L(e,n,s,a.trim())}}return{strokeStyle:n.useStroke?i:null,fillStyle:n.useFill?s:null,useFill:n.useFill,useStroke:n.useStroke}}function L(t,e,r,i){switch(r){case"stroke":if("none"!==i){if(i.startsWith("url(")){const r=V(i);e.strokeStyle.fill=t.defs[r]}else e.strokeStyle.color=s.Q.shared.setValue(i).toNumber();e.useStroke=!0}break;case"stroke-width":e.strokeStyle.width=Number(i);break;case"fill":if("none"!==i){if(i.startsWith("url(")){const r=V(i);e.fillStyle.fill=t.defs[r]}else e.fillStyle.color=s.Q.shared.setValue(i).toNumber();e.useFill=!0}break;case"fill-opacity":e.fillStyle.alpha=Number(i);break;case"stroke-opacity":e.strokeStyle.alpha=Number(i);break;case"opacity":e.fillStyle.alpha=Number(i),e.strokeStyle.alpha=Number(i)}}function H(t,e,r,i){const s=t.children,{fillStyle:n,strokeStyle:a}=D(t,e);n&&r?r={...r,...n}:n&&(r=n),a&&i?i={...i,...a}:a&&(i=a);const o=!r&&!i;let h,l,u,d,f,p,g,m,x,_,y,b,v,S,w,T,M;switch(o&&(r={color:0}),t.nodeName.toLowerCase()){case"path":S=t.getAttribute("d"),"evenodd"===t.getAttribute("fill-rule")&&(0,c.R)("SVG Evenodd fill rule not supported, your svg may render incorrectly"),w=new U(S,!0),e.context.path(w),r&&e.context.fill(r),i&&e.context.stroke(i);break;case"circle":g=G(t,"cx",0),m=G(t,"cy",0),x=G(t,"r",0),e.context.ellipse(g,m,x,x),r&&e.context.fill(r),i&&e.context.stroke(i);break;case"rect":h=G(t,"x",0),l=G(t,"y",0),T=G(t,"width",0),M=G(t,"height",0),_=G(t,"rx",0),y=G(t,"ry",0),_||y?e.context.roundRect(h,l,T,M,_||y):e.context.rect(h,l,T,M),r&&e.context.fill(r),i&&e.context.stroke(i);break;case"ellipse":g=G(t,"cx",0),m=G(t,"cy",0),_=G(t,"rx",0),y=G(t,"ry",0),e.context.beginPath(),e.context.ellipse(g,m,_,y),r&&e.context.fill(r),i&&e.context.stroke(i);break;case"line":u=G(t,"x1",0),d=G(t,"y1",0),f=G(t,"x2",0),p=G(t,"y2",0),e.context.beginPath(),e.context.moveTo(u,d),e.context.lineTo(f,p),i&&e.context.stroke(i);break;case"polygon":v=t.getAttribute("points"),b=v.match(/\d+/g).map((t=>parseInt(t,10))),e.context.poly(b,!0),r&&e.context.fill(r),i&&e.context.stroke(i);break;case"polyline":v=t.getAttribute("points"),b=v.match(/\d+/g).map((t=>parseInt(t,10))),e.context.poly(b,!1),i&&e.context.stroke(i);break;case"g":case"svg":break;default:(0,c.R)(`[SVG parser] <${t.nodeName}> elements unsupported`)}o&&(r=null);for(let t=0;t<s.length;t++)H(s[t],e,r,i)}var $=r(990);const j=new a.b,X=new n.u,N=class t extends i.A{constructor(){super(...arguments),this.uid=(0,h.L)("graphicsContext"),this.dirty=!0,this.batchMode="auto",this.instructions=[],this._activePath=new U,this._transform=new n.u,this._fillStyle={...t.defaultFillStyle},this._strokeStyle={...t.defaultStrokeStyle},this._stateStack=[],this._tick=0,this._bounds=new u.c,this._boundsDirty=!0}clone(){const e=new t;return e.batchMode=this.batchMode,e.instructions=this.instructions.slice(),e._activePath=this._activePath.clone(),e._transform=this._transform.clone(),e._fillStyle={...this._fillStyle},e._strokeStyle={...this._strokeStyle},e._stateStack=this._stateStack.slice(),e._bounds=this._bounds.clone(),e._boundsDirty=!0,e}get fillStyle(){return this._fillStyle}set fillStyle(e){this._fillStyle=(0,$.w)(e,t.defaultFillStyle)}get strokeStyle(){return this._strokeStyle}set strokeStyle(e){this._strokeStyle=(0,$.T)(e,t.defaultStrokeStyle)}setFillStyle(e){return this._fillStyle=(0,$.w)(e,t.defaultFillStyle),this}setStrokeStyle(e){return this._strokeStyle=(0,$.w)(e,t.defaultStrokeStyle),this}texture(t,e,r,i,n,a){return this.instructions.push({action:"texture",data:{image:t,dx:r||0,dy:i||0,dw:n||t.frame.width,dh:a||t.frame.height,transform:this._transform.clone(),alpha:this._fillStyle.alpha,style:e?s.Q.shared.setValue(e).toNumber():16777215}}),this.onUpdate(),this}beginPath(){return this._activePath=new U,this}fill(e,r){let i;const s=this.instructions[this.instructions.length-1];return i=0===this._tick&&s&&"stroke"===s.action?s.data.path:this._activePath.clone(),i?(null!=e&&(void 0!==r&&"number"==typeof e&&((0,l.t6)(l.lj,"GraphicsContext.fill(color, alpha) is deprecated, use GraphicsContext.fill({ color, alpha }) instead"),e={color:e,alpha:r}),this._fillStyle=(0,$.w)(e,t.defaultFillStyle)),this.instructions.push({action:"fill",data:{style:this.fillStyle,path:i}}),this.onUpdate(),this._initNextPathLocation(),this._tick=0,this):this}_initNextPathLocation(){const{x:t,y:e}=this._activePath.getLastPoint(a.b.shared);this._activePath.clear(),this._activePath.moveTo(t,e)}stroke(e){let r;const i=this.instructions[this.instructions.length-1];return r=0===this._tick&&i&&"fill"===i.action?i.data.path:this._activePath.clone(),r?(null!=e&&(this._strokeStyle=(0,$.T)(e,t.defaultStrokeStyle)),this.instructions.push({action:"stroke",data:{style:this.strokeStyle,path:r}}),this.onUpdate(),this._initNextPathLocation(),this._tick=0,this):this}cut(){for(let t=0;t<2;t++){const e=this.instructions[this.instructions.length-1-t],r=this._activePath.clone();if(e&&("stroke"===e.action||"fill"===e.action)){if(!e.data.hole){e.data.hole=r;break}e.data.hole.addPath(r)}}return this._initNextPathLocation(),this}arc(t,e,r,i,s,n){this._tick++;const a=this._transform;return this._activePath.arc(a.a*t+a.c*e+a.tx,a.b*t+a.d*e+a.ty,r,i,s,n),this}arcTo(t,e,r,i,s){this._tick++;const n=this._transform;return this._activePath.arcTo(n.a*t+n.c*e+n.tx,n.b*t+n.d*e+n.ty,n.a*r+n.c*i+n.tx,n.b*r+n.d*i+n.ty,s),this}arcToSvg(t,e,r,i,s,n,a){this._tick++;const o=this._transform;return this._activePath.arcToSvg(t,e,r,i,s,o.a*n+o.c*a+o.tx,o.b*n+o.d*a+o.ty),this}bezierCurveTo(t,e,r,i,s,n,a){this._tick++;const o=this._transform;return this._activePath.bezierCurveTo(o.a*t+o.c*e+o.tx,o.b*t+o.d*e+o.ty,o.a*r+o.c*i+o.tx,o.b*r+o.d*i+o.ty,o.a*s+o.c*n+o.tx,o.b*s+o.d*n+o.ty,a),this}closePath(){return this._tick++,this._activePath?.closePath(),this}ellipse(t,e,r,i){return this._tick++,this._activePath.ellipse(t,e,r,i,this._transform.clone()),this}circle(t,e,r){return this._tick++,this._activePath.circle(t,e,r,this._transform.clone()),this}path(t){return this._tick++,this._activePath.addPath(t,this._transform.clone()),this}lineTo(t,e){this._tick++;const r=this._transform;return this._activePath.lineTo(r.a*t+r.c*e+r.tx,r.b*t+r.d*e+r.ty),this}moveTo(t,e){this._tick++;const r=this._transform,i=this._activePath.instructions,s=r.a*t+r.c*e+r.tx,n=r.b*t+r.d*e+r.ty;return 1===i.length&&"moveTo"===i[0].action?(i[0].data[0]=s,i[0].data[1]=n,this):(this._activePath.moveTo(s,n),this)}quadraticCurveTo(t,e,r,i,s){this._tick++;const n=this._transform;return this._activePath.quadraticCurveTo(n.a*t+n.c*e+n.tx,n.b*t+n.d*e+n.ty,n.a*r+n.c*i+n.tx,n.b*r+n.d*i+n.ty,s),this}rect(t,e,r,i){return this._tick++,this._activePath.rect(t,e,r,i,this._transform.clone()),this}roundRect(t,e,r,i,s){return this._tick++,this._activePath.roundRect(t,e,r,i,s,this._transform.clone()),this}poly(t,e){return this._tick++,this._activePath.poly(t,e,this._transform.clone()),this}regularPoly(t,e,r,i,s=0,n){return this._tick++,this._activePath.regularPoly(t,e,r,i,s,n),this}roundPoly(t,e,r,i,s,n){return this._tick++,this._activePath.roundPoly(t,e,r,i,s,n),this}roundShape(t,e,r,i){return this._tick++,this._activePath.roundShape(t,e,r,i),this}filletRect(t,e,r,i,s){return this._tick++,this._activePath.filletRect(t,e,r,i,s),this}chamferRect(t,e,r,i,s,n){return this._tick++,this._activePath.chamferRect(t,e,r,i,s,n),this}star(t,e,r,i,s=0,n=0){return this._tick++,this._activePath.star(t,e,r,i,s,n,this._transform.clone()),this}svg(t){return this._tick++,function(t,e){if("string"==typeof t){const e=document.createElement("div");e.innerHTML=t.trim(),t=e.querySelector("svg")}const r={context:e,defs:{},path:new U};!function(t,e){const r=t.querySelectorAll("defs");for(let t=0;t<r.length;t++){const i=r[t];for(let t=0;t<i.children.length;t++){const r=i.children[t];switch(r.nodeName.toLowerCase()){case"lineargradient":e.defs[r.id]=W(r);break;case"radialgradient":e.defs[r.id]=((0,c.R)("[SVG Parser] Radial gradients are not yet supported"),new E._(0,0,1,0))}}}}(t,r);const i=t.children,{fillStyle:s,strokeStyle:n}=D(t,r);for(let t=0;t<i.length;t++){const e=i[t];"defs"!==e.nodeName.toLowerCase()&&H(e,r,s,n)}}(t,this),this}restore(){const t=this._stateStack.pop();return t&&(this._transform=t.transform,this._fillStyle=t.fillStyle,this._strokeStyle=t.strokeStyle),this}save(){return this._stateStack.push({transform:this._transform.clone(),fillStyle:{...this._fillStyle},strokeStyle:{...this._strokeStyle}}),this}getTransform(){return this._transform}resetTransform(){return this._transform.identity(),this}rotate(t){return this._transform.rotate(t),this}scale(t,e=t){return this._transform.scale(t,e),this}setTransform(t,e,r,i,s,a){return t instanceof n.u?(this._transform.set(t.a,t.b,t.c,t.d,t.tx,t.ty),this):(this._transform.set(t,e,r,i,s,a),this)}transform(t,e,r,i,s,a){return t instanceof n.u?(this._transform.append(t),this):(X.set(t,e,r,i,s,a),this._transform.append(X),this)}translate(t,e=t){return this._transform.translate(t,e),this}clear(){return this._activePath.clear(),this.instructions.length=0,this.resetTransform(),this.onUpdate(),this}onUpdate(){this.dirty||(this.emit("update",this,16),this.dirty=!0,this._boundsDirty=!0)}get bounds(){if(!this._boundsDirty)return this._bounds;const t=this._bounds;t.clear();for(let e=0;e<this.instructions.length;e++){const r=this.instructions[e],i=r.action;if("fill"===i){const e=r.data;t.addBounds(e.path.bounds)}else if("texture"===i){const e=r.data;t.addFrame(e.dx,e.dy,e.dx+e.dw,e.dy+e.dh,e.transform)}if("stroke"===i){const e=r.data,i=e.style.alignment,s=e.style.width*(1-i),n=e.path.bounds;t.addFrame(n.minX-s,n.minY-s,n.maxX+s,n.maxY+s)}}return t}containsPoint(t){if(!this.bounds.containsPoint(t.x,t.y))return!1;const e=this.instructions;let r=!1;for(let i=0;i<e.length;i++){const s=e[i],n=s.data,a=n.path;if(!s.action||!a)continue;const o=n.style,h=a.shapePath.shapePrimitives;for(let e=0;e<h.length;e++){const i=h[e].shape;if(!o||!i)continue;const a=h[e].transform,l=a?a.applyInverse(t,j):t;if("fill"===s.action)r=i.contains(l.x,l.y);else{const t=o;r=i.strokeContains(l.x,l.y,t.width,t.alignment)}const u=n.hole;if(u){const t=u.shapePath?.shapePrimitives;if(t)for(let e=0;e<t.length;e++)t[e].shape.contains(l.x,l.y)&&(r=!1)}if(r)return!0}}return r}destroy(t=!1){if(this._stateStack.length=0,this._transform=null,this.emit("destroy",this),this.removeAllListeners(),"boolean"==typeof t?t:t?.texture){const e="boolean"==typeof t?t:t?.textureSource;this._fillStyle.texture&&this._fillStyle.texture.destroy(e),this._strokeStyle.texture&&this._strokeStyle.texture.destroy(e)}this._fillStyle=null,this._strokeStyle=null,this.instructions=null,this._activePath=null,this._bounds=null,this._stateStack=null,this.customShader=null,this._transform=null}};N.defaultFillStyle={color:16777215,alpha:1,texture:o.g.WHITE,matrix:null,fill:null,textureSpace:"local"},N.defaultStrokeStyle={width:1,color:16777215,alpha:1,alignment:.5,miterLimit:10,cap:"butt",join:"miter",texture:o.g.WHITE,matrix:null,fill:null,textureSpace:"local",pixelLine:!1};let Y=N},6011:(t,e,r)=>{"use strict";r.d(e,{V:()=>l});var i=r(8875),s=r(9636),n=r(133),a=r(949),o=r(1132);function h(t,e){if(!(t instanceof a.h)){let r=e?o.S.INDEX:o.S.VERTEX;t instanceof Array&&(e?(t=new Uint32Array(t),r=o.S.INDEX|o.S.COPY_DST):(t=new Float32Array(t),r=o.S.VERTEX|o.S.COPY_DST)),t=new a.h({data:t,label:e?"index-mesh-buffer":"vertex-mesh-buffer",usage:r})}return t}class l extends i.A{constructor(t={}){super(),this.uid=(0,n.L)("geometry"),this._layoutKey=0,this.instanceCount=1,this._bounds=new s.c,this._boundsDirty=!0;const{attributes:e,indexBuffer:r,topology:i}=t;if(this.buffers=[],this.attributes={},e)for(const t in e)this.addAttribute(t,e[t]);this.instanceCount=t.instanceCount??1,r&&this.addIndex(r),this.topology=i||"triangle-list"}onBufferUpdate(){this._boundsDirty=!0,this.emit("update",this)}getAttribute(t){return this.attributes[t]}getIndex(){return this.indexBuffer}getBuffer(t){return this.getAttribute(t).buffer}getSize(){for(const t in this.attributes){const e=this.attributes[t];return e.buffer.data.length/(e.stride/4||e.size)}return 0}addAttribute(t,e){const r=function(t){return(t instanceof a.h||Array.isArray(t)||t.BYTES_PER_ELEMENT)&&(t={buffer:t}),t.buffer=h(t.buffer,!1),t}(e);-1===this.buffers.indexOf(r.buffer)&&(this.buffers.push(r.buffer),r.buffer.on("update",this.onBufferUpdate,this),r.buffer.on("change",this.onBufferUpdate,this)),this.attributes[t]=r}addIndex(t){this.indexBuffer=h(t,!0),this.buffers.push(this.indexBuffer)}get bounds(){return this._boundsDirty?(this._boundsDirty=!1,function(t,e,r){const i=t.getAttribute("aPosition");if(!i)return r.minX=0,r.minY=0,r.maxX=0,r.maxY=0,r;const s=i.buffer.data;let n=1/0,a=1/0,o=-1/0,h=-1/0;const l=s.BYTES_PER_ELEMENT,u=(i.offset||0)/l,c=(i.stride||8)/l;for(let t=u;t<s.length;t+=c){const e=s[t],r=s[t+1];e>o&&(o=e),r>h&&(h=r),e<n&&(n=e),r<a&&(a=r)}return r.minX=n,r.minY=a,r.maxX=o,r.maxY=h,r}(this,0,this._bounds)):this._bounds}destroy(t=!1){this.emit("destroy",this),this.removeAllListeners(),t&&this.buffers.forEach((t=>t.destroy())),this.attributes=null,this.buffers=null,this.indexBuffer=null,this._bounds=null}}},6040:(t,e,r)=>{"use strict";r.d(e,{n:()=>n});var i=r(5811);const s={};function n(t){let e=s[t];if(e)return e;const r=new Int32Array(t);for(let e=0;e<t;e++)r[e]=e;return e=s[t]=new i.k({uTextures:{value:r,type:"i32",size:t}},{isStatic:!0}),e}},6563:(t,e,r)=>{"use strict";r.d(e,{a:()=>o});var i=r(3804);const s=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join("\n");function n(t){let e="";for(let r=0;r<t;++r)r>0&&(e+="\nelse "),r<t-1&&(e+=`if(test == ${r}.0){}`);return e}let a=null;function o(){if(a)return a;const t=(0,i.W)();return a=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),a=function(t,e){if(0===t)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const r=e.createShader(e.FRAGMENT_SHADER);try{for(;;){const i=s.replace(/%forloop%/gi,n(t));if(e.shaderSource(r,i),e.compileShader(r),e.getShaderParameter(r,e.COMPILE_STATUS))break;t=t/2|0}}finally{e.deleteShader(r)}return t}(a,t),t.getExtension("WEBGL_lose_context")?.loseContext(),a}},6607:(t,e,r)=>{"use strict";var i=r(8507),s=r(1979),n=r(8218),a=r(4670),o=r(4985),h=r(5997);class l extends o.l{constructor(t){t instanceof h.T&&(t={context:t});const{context:e,roundPixels:r,...i}=t||{};super({label:"Graphics",...i}),this.renderPipeId="graphics",this._context=e||(this._ownedContext=new h.T),this._context.on("update",this.onViewUpdate,this),this.allowChildren=!1,this.roundPixels=r??!1}set context(t){t!==this._context&&(this._context.off("update",this.onViewUpdate,this),this._context=t,this._context.on("update",this.onViewUpdate,this),this.onViewUpdate())}get context(){return this._context}get bounds(){return this._context.bounds}updateBounds(){}containsPoint(t){return this._context.containsPoint(t)}destroy(t){this._ownedContext&&!t?this._ownedContext.destroy(t):!0!==t&&!0!==t?.context||this._context.destroy(t),this._ownedContext=null,this._context=null,super.destroy(t)}_callContextMethod(t,e){return this.context[t](...e),this}setFillStyle(...t){return this._callContextMethod("setFillStyle",t)}setStrokeStyle(...t){return this._callContextMethod("setStrokeStyle",t)}fill(...t){return this._callContextMethod("fill",t)}stroke(...t){return this._callContextMethod("stroke",t)}texture(...t){return this._callContextMethod("texture",t)}beginPath(){return this._callContextMethod("beginPath",[])}cut(){return this._callContextMethod("cut",[])}arc(...t){return this._callContextMethod("arc",t)}arcTo(...t){return this._callContextMethod("arcTo",t)}arcToSvg(...t){return this._callContextMethod("arcToSvg",t)}bezierCurveTo(...t){return this._callContextMethod("bezierCurveTo",t)}closePath(){return this._callContextMethod("closePath",[])}ellipse(...t){return this._callContextMethod("ellipse",t)}circle(...t){return this._callContextMethod("circle",t)}path(...t){return this._callContextMethod("path",t)}lineTo(...t){return this._callContextMethod("lineTo",t)}moveTo(...t){return this._callContextMethod("moveTo",t)}quadraticCurveTo(...t){return this._callContextMethod("quadraticCurveTo",t)}rect(...t){return this._callContextMethod("rect",t)}roundRect(...t){return this._callContextMethod("roundRect",t)}poly(...t){return this._callContextMethod("poly",t)}regularPoly(...t){return this._callContextMethod("regularPoly",t)}roundPoly(...t){return this._callContextMethod("roundPoly",t)}roundShape(...t){return this._callContextMethod("roundShape",t)}filletRect(...t){return this._callContextMethod("filletRect",t)}chamferRect(...t){return this._callContextMethod("chamferRect",t)}star(...t){return this._callContextMethod("star",t)}svg(...t){return this._callContextMethod("svg",t)}restore(...t){return this._callContextMethod("restore",t)}save(){return this._callContextMethod("save",[])}getTransform(){return this.context.getTransform()}resetTransform(){return this._callContextMethod("resetTransform",[])}rotateTransform(...t){return this._callContextMethod("rotate",t)}scaleTransform(...t){return this._callContextMethod("scale",t)}setTransform(...t){return this._callContextMethod("setTransform",t)}transform(...t){return this._callContextMethod("transform",t)}translateTransform(...t){return this._callContextMethod("translate",t)}clear(){return this._callContextMethod("clear",[])}get fillStyle(){return this._context.fillStyle}set fillStyle(t){this._context.fillStyle=t}get strokeStyle(){return this._context.strokeStyle}set strokeStyle(t){this._context.strokeStyle=t}clone(t=!1){return t?new l(this._context.clone()):(this._ownedContext=null,new l(this._context))}lineStyle(t,e,r){(0,a.t6)(a.lj,"Graphics#lineStyle is no longer needed. Use Graphics#setStrokeStyle to set the stroke style.");const i={};return t&&(i.width=t),e&&(i.color=e),r&&(i.alpha=r),this.context.strokeStyle=i,this}beginFill(t,e){(0,a.t6)(a.lj,"Graphics#beginFill is no longer needed. Use Graphics#fill to fill the shape with the desired style.");const r={};return void 0!==t&&(r.color=t),void 0!==e&&(r.alpha=e),this.context.fillStyle=r,this}endFill(){(0,a.t6)(a.lj,"Graphics#endFill is no longer needed. Use Graphics#fill to fill the shape with the desired style."),this.context.fill();const t=this.context.strokeStyle;return t.width===h.T.defaultStrokeStyle.width&&t.color===h.T.defaultStrokeStyle.color&&t.alpha===h.T.defaultStrokeStyle.alpha||this.context.stroke(),this}drawCircle(...t){return(0,a.t6)(a.lj,"Graphics#drawCircle has been renamed to Graphics#circle"),this._callContextMethod("circle",t)}drawEllipse(...t){return(0,a.t6)(a.lj,"Graphics#drawEllipse has been renamed to Graphics#ellipse"),this._callContextMethod("ellipse",t)}drawPolygon(...t){return(0,a.t6)(a.lj,"Graphics#drawPolygon has been renamed to Graphics#poly"),this._callContextMethod("poly",t)}drawRect(...t){return(0,a.t6)(a.lj,"Graphics#drawRect has been renamed to Graphics#rect"),this._callContextMethod("rect",t)}drawRoundedRect(...t){return(0,a.t6)(a.lj,"Graphics#drawRoundedRect has been renamed to Graphics#roundRect"),this._callContextMethod("roundRect",t)}drawStar(...t){return(0,a.t6)(a.lj,"Graphics#drawStar has been renamed to Graphics#star"),this._callContextMethod("star",t)}}var u=r(9313),c=r(6563),d=r(5611),f=r(4459),p=r(4e3),g=r(6665),m=r(6040),x=r(8475),_=r(5811);const y={name:"local-uniform-msdf-bit",vertex:{header:"\n            struct LocalUniforms {\n                uColor:vec4<f32>,\n                uTransformMatrix:mat3x3<f32>,\n                uDistance: f32,\n                uRound:f32,\n            }\n\n            @group(2) @binding(0) var<uniform> localUniforms : LocalUniforms;\n        ",main:"\n            vColor *= localUniforms.uColor;\n            modelMatrix *= localUniforms.uTransformMatrix;\n        ",end:"\n            if(localUniforms.uRound == 1)\n            {\n                vPosition = vec4(roundPixels(vPosition.xy, globalUniforms.uResolution), vPosition.zw);\n            }\n        "},fragment:{header:"\n            struct LocalUniforms {\n                uColor:vec4<f32>,\n                uTransformMatrix:mat3x3<f32>,\n                uDistance: f32\n            }\n\n            @group(2) @binding(0) var<uniform> localUniforms : LocalUniforms;\n         ",main:" \n            outColor = vec4<f32>(calculateMSDFAlpha(outColor, localUniforms.uColor, localUniforms.uDistance));\n        "}},b={name:"local-uniform-msdf-bit",vertex:{header:"\n            uniform mat3 uTransformMatrix;\n            uniform vec4 uColor;\n            uniform float uRound;\n        ",main:"\n            vColor *= uColor;\n            modelMatrix *= uTransformMatrix;\n        ",end:"\n            if(uRound == 1.)\n            {\n                gl_Position.xy = roundPixels(gl_Position.xy, uResolution);\n            }\n        "},fragment:{header:"\n            uniform float uDistance;\n         ",main:" \n            outColor = vec4(calculateMSDFAlpha(outColor, vColor, uDistance));\n        "}},v={name:"msdf-bit",fragment:{header:"\n            fn calculateMSDFAlpha(msdfColor:vec4<f32>, shapeColor:vec4<f32>, distance:f32) -> f32 {\n                \n                // MSDF\n                var median = msdfColor.r + msdfColor.g + msdfColor.b -\n                    min(msdfColor.r, min(msdfColor.g, msdfColor.b)) -\n                    max(msdfColor.r, max(msdfColor.g, msdfColor.b));\n            \n                // SDF\n                median = min(median, msdfColor.a);\n\n                var screenPxDistance = distance * (median - 0.5);\n                var alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\n                if (median < 0.01) {\n                    alpha = 0.0;\n                } else if (median > 0.99) {\n                    alpha = 1.0;\n                }\n\n                // Gamma correction for coverage-like alpha\n                var luma: f32 = dot(shapeColor.rgb, vec3<f32>(0.299, 0.587, 0.114));\n                var gamma: f32 = mix(1.0, 1.0 / 2.2, luma);\n                var coverage: f32 = pow(shapeColor.a * alpha, gamma);\n\n                return coverage;\n             \n            }\n        "}},S={name:"msdf-bit",fragment:{header:"\n            float calculateMSDFAlpha(vec4 msdfColor, vec4 shapeColor, float distance) {\n                \n                // MSDF\n                float median = msdfColor.r + msdfColor.g + msdfColor.b -\n                                min(msdfColor.r, min(msdfColor.g, msdfColor.b)) -\n                                max(msdfColor.r, max(msdfColor.g, msdfColor.b));\n               \n                // SDF\n                median = min(median, msdfColor.a);\n            \n                float screenPxDistance = distance * (median - 0.5);\n                float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\n           \n                if (median < 0.01) {\n                    alpha = 0.0;\n                } else if (median > 0.99) {\n                    alpha = 1.0;\n                }\n\n                // Gamma correction for coverage-like alpha\n                float luma = dot(shapeColor.rgb, vec3(0.299, 0.587, 0.114));\n                float gamma = mix(1.0, 1.0 / 2.2, luma);\n                float coverage = pow(shapeColor.a * alpha, gamma);  \n              \n                return coverage;\n            }\n        "}};let w,T;class M extends x.M{constructor(){const t=new _.k({uColor:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},uTransformMatrix:{value:new u.u,type:"mat3x3<f32>"},uDistance:{value:4,type:"f32"},uRound:{value:0,type:"f32"}}),e=(0,c.a)();w??(w=(0,d.v)({name:"sdf-shader",bits:[f.F,(0,p._)(e),y,v,g.b]})),T??(T=(0,d.I)({name:"sdf-shader",bits:[f.a,(0,p.P)(e),b,S,g.m]})),super({glProgram:T,gpuProgram:w,resources:{localUniforms:t,batchSamplers:(0,m.n)(e)}})}}var C=r(268),P=r(8291),k=r(2577),B=r(9252),R=r(7608),A=r(8293),z=r(7174),F=r(4016),U=r(1242),I=r(3548),E=r(8875);class G extends E.A{constructor(){super(...arguments),this.chars=Object.create(null),this.lineHeight=0,this.fontFamily="",this.fontMetrics={fontSize:0,ascent:0,descent:0},this.baseLineOffset=0,this.distanceField={type:"none",range:0},this.pages=[],this.applyFillAsTint=!0,this.baseMeasurementFontSize=100,this.baseRenderedFontSize=100}get font(){return(0,a.t6)(a.lj,"BitmapFont.font is deprecated, please use BitmapFont.fontFamily instead."),this.fontFamily}get pageTextures(){return(0,a.t6)(a.lj,"BitmapFont.pageTextures is deprecated, please use BitmapFont.pages instead."),this.pages}get size(){return(0,a.t6)(a.lj,"BitmapFont.size is deprecated, please use BitmapFont.fontMetrics.fontSize instead."),this.fontMetrics.fontSize}get distanceFieldRange(){return(0,a.t6)(a.lj,"BitmapFont.distanceFieldRange is deprecated, please use BitmapFont.distanceField.range instead."),this.distanceField.range}get distanceFieldType(){return(0,a.t6)(a.lj,"BitmapFont.distanceFieldType is deprecated, please use BitmapFont.distanceField.type instead."),this.distanceField.type}destroy(t=!1){this.emit("destroy",this),this.removeAllListeners();for(const t in this.chars)this.chars[t].texture?.destroy();this.chars=null,t&&(this.pages.forEach((t=>t.texture.destroy(!0))),this.pages=null)}}function W(t){if(""===t)return[];"string"==typeof t&&(t=[t]);const e=[];for(let r=0,i=t.length;r<i;r++){const i=t[r];if(Array.isArray(i)){if(2!==i.length)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${i.length}.`);if(0===i[0].length||0===i[1].length)throw new Error("[BitmapFont]: Invalid character delimiter.");const t=i[0].charCodeAt(0),r=i[1].charCodeAt(0);if(r<t)throw new Error("[BitmapFont]: Invalid character range.");for(let i=t,s=r;i<=s;i++)e.push(String.fromCharCode(i))}else e.push(...Array.from(i))}if(0===e.length)throw new Error("[BitmapFont]: Empty set when resolving characters.");return e}const V=class t extends G{constructor(e){super(),this.resolution=1,this.pages=[],this._padding=0,this._measureCache=Object.create(null),this._currentChars=[],this._currentX=0,this._currentY=0,this._currentPageIndex=-1,this._skipKerning=!1;const r={...t.defaultOptions,...e};this._textureSize=r.textureSize,this._mipmap=r.mipmap;const i=r.style.clone();r.overrideFill&&(i._fill.color=16777215,i._fill.alpha=1,i._fill.texture=z.g.WHITE,i._fill.fill=null),this.applyFillAsTint=r.overrideFill;const s=i.fontSize;i.fontSize=this.baseMeasurementFontSize;const n=(0,U.Z)(i);r.overrideSize?i._stroke&&(i._stroke.width*=this.baseRenderedFontSize/s):i.fontSize=this.baseRenderedFontSize=s,this._style=i,this._skipKerning=r.skipKerning??!1,this.resolution=r.resolution??1,this._padding=r.padding??4,this.fontMetrics=F.P.measureFont(n),this.lineHeight=i.lineHeight||this.fontMetrics.fontSize||i.fontSize}ensureCharacters(t){const e=W(t).filter((t=>!this._currentChars.includes(t))).filter(((t,e,r)=>r.indexOf(t)===e));if(!e.length)return;let r;this._currentChars=[...this._currentChars,...e],r=-1===this._currentPageIndex?this._nextPage():this.pages[this._currentPageIndex];let{canvas:i,context:s}=r.canvasAndContext,n=r.texture.source;const a=this._style;let o=this._currentX,h=this._currentY;const l=this.baseRenderedFontSize/this.baseMeasurementFontSize,u=this._padding*l;let c=0,d=!1;const f=i.width/this.resolution,p=i.height/this.resolution;for(let t=0;t<e.length;t++){const r=e[t],g=F.P.measureText(r,a,i,!1);g.lineHeight=g.height;const m=g.width*l,x=Math.ceil(("italic"===a.fontStyle?2:1)*m)+2*u,_=g.height*l+2*u;if(d=!1,"\n"!==r&&"\r"!==r&&"\t"!==r&&" "!==r&&(d=!0,c=Math.ceil(Math.max(_,c))),o+x>f&&(h+=c,c=_,o=0,h+c>p)){n.update();const t=this._nextPage();i=t.canvasAndContext.canvas,s=t.canvasAndContext.context,n=t.texture.source,h=0}const y=m/l-(a.dropShadow?.distance??0)-(a._stroke?.width??0);if(this.chars[r]={id:r.codePointAt(0),xOffset:-this._padding,yOffset:-this._padding,xAdvance:y,kerning:{}},d){this._drawGlyph(s,g,o+u,h+u,l,a);const t=n.width*l,e=n.height*l,i=new B.M(o/t*n.width,h/e*n.height,x/t*n.width,_/e*n.height);this.chars[r].texture=new z.g({source:n,frame:i}),o+=Math.ceil(x)}}n.update(),this._currentX=o,this._currentY=h,this._skipKerning&&this._applyKerning(e,s)}get pageTextures(){return(0,a.t6)(a.lj,"BitmapFont.pageTextures is deprecated, please use BitmapFont.pages instead."),this.pages}_applyKerning(t,e){const r=this._measureCache;for(let i=0;i<t.length;i++){const s=t[i];for(let t=0;t<this._currentChars.length;t++){const i=this._currentChars[t];let n=r[s];n||(n=r[s]=e.measureText(s).width);let a=r[i];a||(a=r[i]=e.measureText(i).width);let o=e.measureText(s+i).width,h=o-(n+a);h&&(this.chars[s].kerning[i]=h),o=e.measureText(s+i).width,h=o-(n+a),h&&(this.chars[i].kerning[s]=h)}}}_nextPage(){this._currentPageIndex++;const t=this.resolution,e=R.N.getOptimalCanvasAndContext(this._textureSize,this._textureSize,t);this._setupContext(e.context,this._style,t);const r=t*(this.baseRenderedFontSize/this.baseMeasurementFontSize),i={canvasAndContext:e,texture:new z.g({source:new A.b({resource:e.canvas,resolution:r,alphaMode:"premultiply-alpha-on-upload",autoGenerateMipmaps:this._mipmap})})};return this.pages[this._currentPageIndex]=i,i}_setupContext(t,e,r){e.fontSize=this.baseRenderedFontSize,t.scale(r,r),t.font=(0,U.Z)(e),e.fontSize=this.baseMeasurementFontSize,t.textBaseline=e.textBaseline;const i=e._stroke,s=i?.width??0;if(i&&(t.lineWidth=s,t.lineJoin=i.join,t.miterLimit=i.miterLimit,t.strokeStyle=(0,I.r)(i,t)),e._fill&&(t.fillStyle=(0,I.r)(e._fill,t)),e.dropShadow){const i=e.dropShadow,s=k.Q.shared.setValue(i.color).toArray(),n=i.blur*r,a=i.distance*r;t.shadowColor=`rgba(${255*s[0]},${255*s[1]},${255*s[2]},${i.alpha})`,t.shadowBlur=n,t.shadowOffsetX=Math.cos(i.angle)*a,t.shadowOffsetY=Math.sin(i.angle)*a}else t.shadowColor="black",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0}_drawGlyph(t,e,r,i,s,n){const a=e.text,o=e.fontProperties,h=n._stroke,l=(h?.width??0)*s,u=r+l/2,c=i-l/2,d=o.descent*s,f=e.lineHeight*s;n.stroke&&l&&t.strokeText(a,u,c+f-d),n._fill&&t.fillText(a,u,c+f-d)}destroy(){super.destroy();for(let t=0;t<this.pages.length;t++){const{canvasAndContext:e,texture:r}=this.pages[t];R.N.returnCanvasAndContext(e),r.destroy(!0)}this.pages=null}};V.defaultOptions={textureSize:512,style:new P.x,mipmap:!0};let O=V;function D(t,e,r,i){const s={width:0,height:0,offsetY:0,scale:e.fontSize/r.baseMeasurementFontSize,lines:[{width:0,charPositions:[],spaceWidth:0,spacesIndex:[],chars:[]}]};s.offsetY=r.baseLineOffset;let n=s.lines[0],a=null,o=!0;const h={spaceWord:!1,width:0,start:0,index:0,positions:[],chars:[]},l=t=>{const e=n.width;for(let r=0;r<h.index;r++){const i=t.positions[r];n.chars.push(t.chars[r]),n.charPositions.push(i+e)}n.width+=t.width,o=!1,h.width=0,h.index=0,h.chars.length=0},u=()=>{let t=n.chars.length-1;if(i){let e=n.chars[t];for(;" "===e;)n.width-=r.chars[e].xAdvance,e=n.chars[--t]}s.width=Math.max(s.width,n.width),n={width:0,charPositions:[],chars:[],spaceWidth:0,spacesIndex:[]},o=!0,s.lines.push(n),s.height+=r.lineHeight},c=r.baseMeasurementFontSize/e.fontSize,d=e.letterSpacing*c,f=e.wordWrapWidth*c;for(let i=0;i<t.length+1;i++){let s;const c=i===t.length;c||(s=t[i]);const p=r.chars[s]||r.chars[" "];if(/(?:\s)/.test(s)||"\r"===s||"\n"===s||c){if(!o&&e.wordWrap&&n.width+h.width-d>f?(u(),l(h),c||n.charPositions.push(0)):(h.start=n.width,l(h),c||n.charPositions.push(0)),"\r"===s||"\n"===s)0!==n.width&&u();else if(!c){const t=p.xAdvance+(p.kerning[a]||0)+d;n.width+=t,n.spaceWidth=t,n.spacesIndex.push(n.charPositions.length),n.chars.push(s)}}else{const t=p.kerning[a]||0,e=p.xAdvance+t+d;h.positions[h.index++]=h.width+t,h.chars.push(s),h.width+=e}a=s}return u(),"center"===e.align?function(t){for(let e=0;e<t.lines.length;e++){const r=t.lines[e],i=t.width/2-r.width/2;for(let t=0;t<r.charPositions.length;t++)r.charPositions[t]+=i}}(s):"right"===e.align?function(t){for(let e=0;e<t.lines.length;e++){const r=t.lines[e],i=t.width-r.width;for(let t=0;t<r.charPositions.length;t++)r.charPositions[t]+=i}}(s):"justify"===e.align&&function(t){const e=t.width;for(let r=0;r<t.lines.length;r++){const i=t.lines[r];let s=0,n=i.spacesIndex[s++],a=0;const o=i.spacesIndex.length,h=(e-i.width)/o;for(let t=0;t<i.charPositions.length;t++)t===n&&(n=i.spacesIndex[s++],a+=h),i.charPositions[t]+=a}}(s),s}let L=0;const H=new class{constructor(){this.ALPHA=[["a","z"],["A","Z"]," "],this.NUMERIC=[["0","9"]],this.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],this.ASCII=[[" ","~"]],this.defaultOptions={chars:this.ALPHANUMERIC,resolution:1,padding:4,skipKerning:!1}}getFont(t,e){let r=`${e.fontFamily}-bitmap`,i=!0;if(e._fill.fill&&!e._stroke)r+=e._fill.fill.styleKey,i=!1;else if(e._stroke||e.dropShadow){let t=e.styleKey;t=t.substring(0,t.lastIndexOf("-")),r=`${t}-bitmap`,i=!1}if(!s.l.has(r)){const t=new O({style:e,overrideFill:i,overrideSize:!0,...this.defaultOptions});L++,L>50&&(0,C.R)("BitmapText",`You have dynamically created ${L} bitmap fonts, this can be inefficient. Try pre installing your font styles using \`BitmapFont.install({name:"style1", style})\``),t.once("destroy",(()=>{L--,s.l.remove(r)})),s.l.set(r,t)}const n=s.l.get(r);return n.ensureCharacters?.(t),n}getLayout(t,e,r=!0){const i=this.getFont(t,e);return D([...t],e,i,r)}measureText(t,e,r=!0){return this.getLayout(t,e,r)}install(...t){let e=t[0];"string"==typeof e&&(e={name:e,style:t[1],chars:t[2]?.chars,resolution:t[2]?.resolution,padding:t[2]?.padding,skipKerning:t[2]?.skipKerning},(0,a.t6)(a.lj,"BitmapFontManager.install(name, style, options) is deprecated, use BitmapFontManager.install({name, style, ...options})"));const r=e?.name;if(!r)throw new Error("[BitmapFontManager] Property `name` is required.");e={...this.defaultOptions,...e};const i=e.style,n=i instanceof P.x?i:new P.x(i),o=null!==n._fill.fill&&void 0!==n._fill.fill,h=new O({style:n,overrideFill:o,skipKerning:e.skipKerning,padding:e.padding,resolution:e.resolution,overrideSize:!1}),l=W(e.chars);return h.ensureCharacters(l.join("")),s.l.set(`${r}-bitmap`,h),h.once("destroy",(()=>s.l.remove(`${r}-bitmap`))),h}uninstall(t){const e=`${t}-bitmap`,r=s.l.get(e);r&&r.destroy()}};class ${constructor(t){this._gpuBitmapText={},this._destroyRenderableBound=this.destroyRenderable.bind(this),this._renderer=t,this._renderer.renderableGC.addManagedHash(this,"_gpuBitmapText")}validateRenderable(t){const e=this._getGpuBitmapText(t);return t._didTextUpdate&&(t._didTextUpdate=!1,this._updateContext(t,e)),this._renderer.renderPipes.graphics.validateRenderable(e)}addRenderable(t,e){const r=this._getGpuBitmapText(t);j(t,r),t._didTextUpdate&&(t._didTextUpdate=!1,this._updateContext(t,r)),this._renderer.renderPipes.graphics.addRenderable(r,e),r.context.customShader&&this._updateDistanceField(t)}destroyRenderable(t){t.off("destroyed",this._destroyRenderableBound),this._destroyRenderableByUid(t.uid)}_destroyRenderableByUid(t){const e=this._gpuBitmapText[t].context;e.customShader&&(n.Z.return(e.customShader),e.customShader=null),n.Z.return(this._gpuBitmapText[t]),this._gpuBitmapText[t]=null}updateRenderable(t){const e=this._getGpuBitmapText(t);j(t,e),this._renderer.renderPipes.graphics.updateRenderable(e),e.context.customShader&&this._updateDistanceField(t)}_updateContext(t,e){const{context:r}=e,i=H.getFont(t.text,t._style);r.clear(),"none"!==i.distanceField.type&&(r.customShader||(r.customShader=n.Z.get(M)));const s=Array.from(t.text),a=t._style;let o=i.baseLineOffset;const h=D(s,a,i,!0);let l=0;const u=a.padding,c=h.scale;let d=h.width,f=h.height+h.offsetY;a._stroke&&(d+=a._stroke.width/c,f+=a._stroke.width/c),r.translate(-t._anchor._x*d-u,-t._anchor._y*f-u).scale(c,c);const p=i.applyFillAsTint?a._fill.color:16777215;for(let t=0;t<h.lines.length;t++){const e=h.lines[t];for(let t=0;t<e.charPositions.length;t++){const n=s[l++],a=i.chars[n];a?.texture&&r.texture(a.texture,p||"black",Math.round(e.charPositions[t]+a.xOffset),Math.round(o+a.yOffset))}o+=i.lineHeight}}_getGpuBitmapText(t){return this._gpuBitmapText[t.uid]||this.initGpuText(t)}initGpuText(t){const e=n.Z.get(l);return this._gpuBitmapText[t.uid]=e,this._updateContext(t,e),t.on("destroyed",this._destroyRenderableBound),this._gpuBitmapText[t.uid]}_updateDistanceField(t){const e=this._getGpuBitmapText(t).context,r=t._style.fontFamily,i=s.l.get(`${r}-bitmap`),{a:n,b:a,c:o,d:h}=t.groupTransform,l=Math.sqrt(n*n+a*a),u=Math.sqrt(o*o+h*h),c=(Math.abs(l)+Math.abs(u))/2,d=i.baseRenderedFontSize/t._style.fontSize,f=c*i.distanceField.range*(1/d);e.customShader.resources.localUniforms.uniforms.uDistance=f}destroy(){for(const t in this._gpuBitmapText)this._destroyRenderableByUid(t);this._gpuBitmapText=null,this._renderer=null}}function j(t,e){e.groupTransform=t.groupTransform,e.groupColorAlpha=t.groupColorAlpha,e.groupColor=t.groupColor,e.groupBlendMode=t.groupBlendMode,e.globalDisplayStatus=t.globalDisplayStatus,e.groupTransform=t.groupTransform,e.localDisplayStatus=t.localDisplayStatus,e.groupAlpha=t.groupAlpha,e._roundPixels=t._roundPixels}$.extension={type:[i.Ag.WebGLPipes,i.Ag.WebGPUPipes,i.Ag.CanvasPipes],name:"bitmapText"},i.XO.add($)},6665:(t,e,r)=>{"use strict";r.d(e,{b:()=>i,m:()=>s});const i={name:"round-pixels-bit",vertex:{header:"\n            fn roundPixels(position: vec2<f32>, targetSize: vec2<f32>) -> vec2<f32> \n            {\n                return (floor(((position * 0.5 + 0.5) * targetSize) + 0.5) / targetSize) * 2.0 - 1.0;\n            }\n        "}},s={name:"round-pixels-bit",vertex:{header:"   \n            vec2 roundPixels(vec2 position, vec2 targetSize)\n            {       \n                return (floor(((position * 0.5 + 0.5) * targetSize) + 0.5) / targetSize) * 2.0 - 1.0;\n            }\n        "}}},6954:(t,e,r)=>{"use strict";r.d(e,{G:()=>a});var i=r(9313),s=r(4676);const n=new i.u;class a{constructor(){this.packAsQuad=!1,this.batcherName="default",this.topology="triangle-list",this.applyTransform=!0,this.roundPixels=0,this._batcher=null,this._batch=null}get uvs(){return this.geometryData.uvs}get positions(){return this.geometryData.vertices}get indices(){return this.geometryData.indices}get blendMode(){return this.applyTransform?this.renderable.groupBlendMode:"normal"}get color(){const t=this.baseColor,e=t>>16|65280&t|(255&t)<<16,r=this.renderable;return r?(0,s.u)(e,r.groupColor)+(this.alpha*r.groupAlpha*255<<24):e+(255*this.alpha<<24)}get transform(){return this.renderable?.groupTransform||n}copyTo(t){t.indexOffset=this.indexOffset,t.indexSize=this.indexSize,t.attributeOffset=this.attributeOffset,t.attributeSize=this.attributeSize,t.baseColor=this.baseColor,t.alpha=this.alpha,t.texture=this.texture,t.geometryData=this.geometryData,t.topology=this.topology}reset(){this.applyTransform=!0,this.renderable=null,this.topology="triangle-list"}}},7252:(t,e,r)=>{"use strict";var i=r(8507),s=r(8218),n=r(8734),a=r(4670),o=r(5060);const h=class t extends o.u{constructor(...t){super({});let e=t[0]??{};"number"==typeof e&&((0,a.t6)(a.lj,"PlaneGeometry constructor changed please use { width, height, verticesX, verticesY } instead"),e={width:e,height:t[1],verticesX:t[2],verticesY:t[3]}),this.build(e)}build(e){e={...t.defaultOptions,...e},this.verticesX=this.verticesX??e.verticesX,this.verticesY=this.verticesY??e.verticesY,this.width=this.width??e.width,this.height=this.height??e.height;const r=this.verticesX*this.verticesY,i=[],s=[],n=[],a=this.verticesX-1,o=this.verticesY-1,h=this.width/a,l=this.height/o;for(let t=0;t<r;t++){const e=t%this.verticesX,r=t/this.verticesX|0;i.push(e*h,r*l),s.push(e/a,r/o)}const u=a*o;for(let t=0;t<u;t++){const e=t%a,r=t/a|0,i=r*this.verticesX+e,s=r*this.verticesX+e+1,o=(r+1)*this.verticesX+e,h=(r+1)*this.verticesX+e+1;n.push(i,s,o,s,h,o)}this.buffers[0].data=new Float32Array(i),this.buffers[1].data=new Float32Array(s),this.indexBuffer.data=new Uint32Array(n),this.buffers[0].update(),this.buffers[1].update(),this.indexBuffer.update()}};h.defaultOptions={width:100,height:100,verticesX:10,verticesY:10};let l=h;const u=class t extends l{constructor(e={}){super({width:(e={...t.defaultOptions,...e}).width,height:e.height,verticesX:4,verticesY:4}),this.update(e)}update(t){this.width=t.width??this.width,this.height=t.height??this.height,this._originalWidth=t.originalWidth??this._originalWidth,this._originalHeight=t.originalHeight??this._originalHeight,this._leftWidth=t.leftWidth??this._leftWidth,this._rightWidth=t.rightWidth??this._rightWidth,this._topHeight=t.topHeight??this._topHeight,this._bottomHeight=t.bottomHeight??this._bottomHeight,this._anchorX=t.anchor?.x,this._anchorY=t.anchor?.y,this.updateUvs(),this.updatePositions()}updatePositions(){const t=this.positions,{width:e,height:r,_leftWidth:i,_rightWidth:s,_topHeight:n,_bottomHeight:a,_anchorX:o,_anchorY:h}=this,l=i+s,u=e>l?1:e/l,c=n+a,d=r>c?1:r/c,f=Math.min(u,d),p=o*e,g=h*r;t[0]=t[8]=t[16]=t[24]=-p,t[2]=t[10]=t[18]=t[26]=i*f-p,t[4]=t[12]=t[20]=t[28]=e-s*f-p,t[6]=t[14]=t[22]=t[30]=e-p,t[1]=t[3]=t[5]=t[7]=-g,t[9]=t[11]=t[13]=t[15]=n*f-g,t[17]=t[19]=t[21]=t[23]=r-a*f-g,t[25]=t[27]=t[29]=t[31]=r-g,this.getBuffer("aPosition").update()}updateUvs(){const t=this.uvs;t[0]=t[8]=t[16]=t[24]=0,t[1]=t[3]=t[5]=t[7]=0,t[6]=t[14]=t[22]=t[30]=1,t[25]=t[27]=t[29]=t[31]=1;const e=1/this._originalWidth,r=1/this._originalHeight;t[2]=t[10]=t[18]=t[26]=e*this._leftWidth,t[9]=t[11]=t[13]=t[15]=r*this._topHeight,t[4]=t[12]=t[20]=t[28]=1-e*this._rightWidth,t[17]=t[19]=t[21]=t[23]=1-r*this._bottomHeight,this.getBuffer("aUV").update()}};u.defaultOptions={width:100,height:100,leftWidth:10,topHeight:10,rightWidth:10,bottomHeight:10,originalWidth:100,originalHeight:100};let c=u;class d{constructor(t){this._gpuSpriteHash=Object.create(null),this._destroyRenderableBound=this.destroyRenderable.bind(this),this._renderer=t,this._renderer.renderableGC.addManagedHash(this,"_gpuSpriteHash")}addRenderable(t,e){const r=this._getGpuSprite(t);t.didViewUpdate&&this._updateBatchableSprite(t,r),this._renderer.renderPipes.batch.addToBatch(r,e)}updateRenderable(t){const e=this._gpuSpriteHash[t.uid];t.didViewUpdate&&this._updateBatchableSprite(t,e),e._batcher.updateElement(e)}validateRenderable(t){const e=this._getGpuSprite(t);return!e._batcher.checkAndUpdateTexture(e,t._texture)}destroyRenderable(t){const e=this._gpuSpriteHash[t.uid];s.Z.return(e.geometry),s.Z.return(e),this._gpuSpriteHash[t.uid]=null,t.off("destroyed",this._destroyRenderableBound)}_updateBatchableSprite(t,e){e.geometry.update(t),e.setTexture(t._texture)}_getGpuSprite(t){return this._gpuSpriteHash[t.uid]||this._initGPUSprite(t)}_initGPUSprite(t){const e=s.Z.get(n.U);return e.geometry=s.Z.get(c),e.renderable=t,e.transform=t.groupTransform,e.texture=t._texture,e.roundPixels=this._renderer._roundPixels|t._roundPixels,this._gpuSpriteHash[t.uid]=e,t.didViewUpdate||this._updateBatchableSprite(t,e),t.on("destroyed",this._destroyRenderableBound),e}destroy(){for(const t in this._gpuSpriteHash)this._gpuSpriteHash[t].geometry.destroy();this._gpuSpriteHash=null,this._renderer=null}}d.extension={type:[i.Ag.WebGLPipes,i.Ag.WebGPUPipes,i.Ag.CanvasPipes],name:"nineSliceSprite"},i.XO.add(d)},7276:(t,e,r)=>{"use strict";r.d(e,{_:()=>f});var i=r(2577),s=r(1761),n=r(9313),a=r(8293),o=r(7174),h=r(133),l=r(4670),u=r(2698);const c=[{offset:0,color:"white"},{offset:1,color:"black"}],d=class t{constructor(...e){this.uid=(0,h.L)("fillGradient"),this.type="linear",this.colorStops=[];let r=function(t){let e=t[0]??{};return("number"==typeof e||t[1])&&((0,l.t6)("8.5.2","use options object instead"),e={type:"linear",start:{x:t[0],y:t[1]},end:{x:t[2],y:t[3]},textureSpace:t[4],textureSize:t[5]??f.defaultLinearOptions.textureSize}),e}(e);r={..."radial"===r.type?t.defaultRadialOptions:t.defaultLinearOptions,...(0,u.S)(r)},this._textureSize=r.textureSize,this._wrapMode=r.wrapMode,"radial"===r.type?(this.center=r.center,this.outerCenter=r.outerCenter??this.center,this.innerRadius=r.innerRadius,this.outerRadius=r.outerRadius,this.scale=r.scale,this.rotation=r.rotation):(this.start=r.start,this.end=r.end),this.textureSpace=r.textureSpace,this.type=r.type,r.colorStops.forEach((t=>{this.addColorStop(t.offset,t.color)}))}addColorStop(t,e){return this.colorStops.push({offset:t,color:i.Q.shared.setValue(e).toHexa()}),this}buildLinearGradient(){if(this.texture)return;let{x:t,y:e}=this.start,{x:r,y:i}=this.end,s=r-t,h=i-e;const l=s<0||h<0;if("clamp-to-edge"===this._wrapMode){if(s<0){const e=t;t=r,r=e,s*=-1}if(h<0){const t=e;e=i,i=t,h*=-1}}const u=this.colorStops.length?this.colorStops:c,d=this._textureSize,{canvas:f,context:m}=g(d,1),x=l?m.createLinearGradient(this._textureSize,0,0,0):m.createLinearGradient(0,0,this._textureSize,0);p(x,u),m.fillStyle=x,m.fillRect(0,0,d,1),this.texture=new o.g({source:new a.b({resource:f,addressMode:this._wrapMode})});const _=Math.sqrt(s*s+h*h),y=Math.atan2(h,s),b=new n.u;b.scale(_/d,1),b.rotate(y),b.translate(t,e),"local"===this.textureSpace&&b.scale(d,d),this.transform=b}buildGradient(){"linear"===this.type?this.buildLinearGradient():this.buildRadialGradient()}buildRadialGradient(){if(this.texture)return;const t=this.colorStops.length?this.colorStops:c,e=this._textureSize,{canvas:r,context:i}=g(e,e),{x:s,y:h}=this.center,{x:l,y:u}=this.outerCenter,d=this.innerRadius,f=this.outerRadius,m=l-f,x=u-f,_=e/(2*f),y=(s-m)*_,b=(h-x)*_,v=i.createRadialGradient(y,b,d*_,(l-m)*_,(u-x)*_,f*_);p(v,t),i.fillStyle=t[t.length-1].color,i.fillRect(0,0,e,e),i.fillStyle=v,i.translate(y,b),i.rotate(this.rotation),i.scale(1,this.scale),i.translate(-y,-b),i.fillRect(0,0,e,e),this.texture=new o.g({source:new a.b({resource:r,addressMode:this._wrapMode})});const S=new n.u;S.scale(1/_,1/_),S.translate(m,x),"local"===this.textureSpace&&S.scale(e,e),this.transform=S}get styleKey(){return this.uid}destroy(){this.texture?.destroy(!0),this.texture=null}};d.defaultLinearOptions={start:{x:0,y:0},end:{x:0,y:1},colorStops:[],textureSpace:"local",type:"linear",textureSize:256,wrapMode:"clamp-to-edge"},d.defaultRadialOptions={center:{x:.5,y:.5},innerRadius:0,outerRadius:.5,colorStops:[],scale:1,textureSpace:"local",type:"radial",textureSize:256,wrapMode:"clamp-to-edge"};let f=d;function p(t,e){for(let r=0;r<e.length;r++){const i=e[r];t.addColorStop(i.offset,i.color)}}function g(t,e){const r=s.e.get().createCanvas(t,e),i=r.getContext("2d");return{canvas:r,context:i}}},7547:(t,e,r)=>{"use strict";r.d(e,{U:()=>n});const i={normal:0,add:1,multiply:2,screen:3,overlay:4,erase:5,"normal-npm":6,"add-npm":7,"screen-npm":8,min:9,max:10},s=class t{constructor(){this.data=0,this.blendMode="normal",this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(1&this.data)}set blend(t){!!(1&this.data)!==t&&(this.data^=1)}get offsets(){return!!(2&this.data)}set offsets(t){!!(2&this.data)!==t&&(this.data^=2)}set cullMode(t){"none"!==t?(this.culling=!0,this.clockwiseFrontFace="front"===t):this.culling=!1}get cullMode(){return this.culling?this.clockwiseFrontFace?"front":"back":"none"}get culling(){return!!(4&this.data)}set culling(t){!!(4&this.data)!==t&&(this.data^=4)}get depthTest(){return!!(8&this.data)}set depthTest(t){!!(8&this.data)!==t&&(this.data^=8)}get depthMask(){return!!(32&this.data)}set depthMask(t){!!(32&this.data)!==t&&(this.data^=32)}get clockwiseFrontFace(){return!!(16&this.data)}set clockwiseFrontFace(t){!!(16&this.data)!==t&&(this.data^=16)}get blendMode(){return this._blendMode}set blendMode(t){this.blend="none"!==t,this._blendMode=t,this._blendModeId=i[t]||0}get polygonOffset(){return this._polygonOffset}set polygonOffset(t){this.offsets=!!t,this._polygonOffset=t}toString(){return`[pixi.js/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`}static for2d(){const e=new t;return e.depthTest=!1,e.blend=!0,e}};s.default2d=s.for2d();let n=s},7608:(t,e,r)=>{"use strict";r.d(e,{N:()=>n});var i=r(1761),s=r(9939);const n=new class{constructor(t){this._canvasPool=Object.create(null),this.canvasOptions=t||{},this.enableFullScreen=!1}_createCanvasAndContext(t,e){const r=i.e.get().createCanvas();r.width=t,r.height=e;const s=r.getContext("2d");return{canvas:r,context:s}}getOptimalCanvasAndContext(t,e,r=1){t=Math.ceil(t*r-1e-6),e=Math.ceil(e*r-1e-6);const i=((t=(0,s.U5)(t))<<17)+((e=(0,s.U5)(e))<<1);this._canvasPool[i]||(this._canvasPool[i]=[]);let n=this._canvasPool[i].pop();return n||(n=this._createCanvasAndContext(t,e)),n}returnCanvasAndContext(t){const e=t.canvas,{width:r,height:i}=e,s=(r<<17)+(i<<1);t.context.clearRect(0,0,r,i),this._canvasPool[s].push(t)}clear(){this._canvasPool={}}}},7952:(t,e,r)=>{"use strict";r.d(e,{X:()=>n});const i=Object.create(null),s=Object.create(null);function n(t,e){let r=s[t];return void 0===r&&(void 0===i[e]&&(i[e]=1),s[t]=r=i[e]++),r}},8011:(t,e,r)=>{"use strict";r.d(e,{V:()=>n});var i=r(2577);const s=["align","breakWords","cssOverrides","fontVariant","fontWeight","leading","letterSpacing","lineHeight","padding","textBaseline","trim","whiteSpace","wordWrap","wordWrapWidth","fontFamily","fontStyle","fontSize"];function n(t){const e=[];let r=0;for(let i=0;i<s.length;i++){const n=`_${s[i]}`;e[r++]=t[n]}return r=a(t._fill,e,r),r=function(t,e,r){return t?(r=a(t,e,r),e[r++]=t.width,e[r++]=t.alignment,e[r++]=t.cap,e[r++]=t.join,e[r++]=t.miterLimit,r):r}(t._stroke,e,r),r=function(t,e,r){return t?(e[r++]=t.alpha,e[r++]=t.angle,e[r++]=t.blur,e[r++]=t.distance,e[r++]=i.Q.shared.setValue(t.color).toNumber(),r):r}(t.dropShadow,e,r),e.join("-")}function a(t,e,r){return t?(e[r++]=t.color,e[r++]=t.alpha,e[r++]=t.fill?.styleKey,r):r}},8133:t=>{t.exports=function(t){var s=[];return t.replace(r,(function(t,r,n){var a=r.toLowerCase();for(n=function(t){var e=t.match(i);return e?e.map(Number):[]}(n),"m"==a&&n.length>2&&(s.push([r].concat(n.splice(0,2))),a="l",r="m"==r?"l":"L");;){if(n.length==e[a])return n.unshift(r),s.push(n);if(n.length<e[a])throw new Error("malformed path data");s.push([r].concat(n.splice(0,e[a])))}})),s};var e={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},r=/([astvzqmhlc])([^astvzqmhlc]*)/gi,i=/-?[0-9]*\.?[0-9]+(?:e[-+]?\d+)?/gi},8291:(t,e,r)=>{"use strict";r.d(e,{x:()=>d});var i=r(8875),s=r(2577),n=r(4670),a=r(7276),o=r(2806),h=r(5997),l=r(990),u=r(8011);const c=class t extends i.A{constructor(e={}){super(),function(t){const e=t;if("boolean"==typeof e.dropShadow&&e.dropShadow){const r=d.defaultDropShadow;t.dropShadow={alpha:e.dropShadowAlpha??r.alpha,angle:e.dropShadowAngle??r.angle,blur:e.dropShadowBlur??r.blur,color:e.dropShadowColor??r.color,distance:e.dropShadowDistance??r.distance}}if(void 0!==e.strokeThickness){(0,n.t6)(n.lj,"strokeThickness is now a part of stroke");const r=e.stroke;let i={};if(s.Q.isColorLike(r))i.color=r;else if(r instanceof a._||r instanceof o.m)i.fill=r;else{if(!Object.hasOwnProperty.call(r,"color")&&!Object.hasOwnProperty.call(r,"fill"))throw new Error("Invalid stroke value.");i=r}t.stroke={...i,width:e.strokeThickness}}if(Array.isArray(e.fillGradientStops)){let r;(0,n.t6)(n.lj,"gradient fill is now a fill pattern: `new FillGradient(...)`"),null==t.fontSize?t.fontSize=d.defaultTextStyle.fontSize:r="string"==typeof t.fontSize?parseInt(t.fontSize,10):t.fontSize;const i=new a._({start:{x:0,y:0},end:{x:0,y:1.7*(r||0)}}),o=e.fillGradientStops.map((t=>s.Q.shared.setValue(t).toNumber()));o.forEach(((t,e)=>{const r=e/(o.length-1);i.addColorStop(r,t)})),t.fill={fill:i}}}(e);const r={...t.defaultTextStyle,...e};for(const t in r)this[t]=r[t];this.update()}get align(){return this._align}set align(t){this._align=t,this.update()}get breakWords(){return this._breakWords}set breakWords(t){this._breakWords=t,this.update()}get dropShadow(){return this._dropShadow}set dropShadow(e){this._dropShadow=null!==e&&"object"==typeof e?this._createProxy({...t.defaultDropShadow,...e}):e?this._createProxy({...t.defaultDropShadow}):null,this.update()}get fontFamily(){return this._fontFamily}set fontFamily(t){this._fontFamily=t,this.update()}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize="string"==typeof t?parseInt(t,10):t,this.update()}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle=t.toLowerCase(),this.update()}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant=t,this.update()}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight=t,this.update()}get leading(){return this._leading}set leading(t){this._leading=t,this.update()}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing=t,this.update()}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight=t,this.update()}get padding(){return this._padding}set padding(t){this._padding=t,this.update()}get trim(){return this._trim}set trim(t){this._trim=t,this.update()}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline=t,this.update()}get whiteSpace(){return this._whiteSpace}set whiteSpace(t){this._whiteSpace=t,this.update()}get wordWrap(){return this._wordWrap}set wordWrap(t){this._wordWrap=t,this.update()}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(t){this._wordWrapWidth=t,this.update()}get fill(){return this._originalFill}set fill(t){t!==this._originalFill&&(this._originalFill=t,this._isFillStyle(t)&&(this._originalFill=this._createProxy({...h.T.defaultFillStyle,...t},(()=>{this._fill=(0,l.w)({...this._originalFill},h.T.defaultFillStyle)}))),this._fill=(0,l.w)(0===t?"black":t,h.T.defaultFillStyle),this.update())}get stroke(){return this._originalStroke}set stroke(t){t!==this._originalStroke&&(this._originalStroke=t,this._isFillStyle(t)&&(this._originalStroke=this._createProxy({...h.T.defaultStrokeStyle,...t},(()=>{this._stroke=(0,l.T)({...this._originalStroke},h.T.defaultStrokeStyle)}))),this._stroke=(0,l.T)(t,h.T.defaultStrokeStyle),this.update())}_generateKey(){return this._styleKey=(0,u.V)(this),this._styleKey}update(){this._styleKey=null,this.emit("update",this)}reset(){const e=t.defaultTextStyle;for(const t in e)this[t]=e[t]}get styleKey(){return this._styleKey||this._generateKey()}clone(){return new t({align:this.align,breakWords:this.breakWords,dropShadow:this._dropShadow?{...this._dropShadow}:null,fill:this._fill,fontFamily:this.fontFamily,fontSize:this.fontSize,fontStyle:this.fontStyle,fontVariant:this.fontVariant,fontWeight:this.fontWeight,leading:this.leading,letterSpacing:this.letterSpacing,lineHeight:this.lineHeight,padding:this.padding,stroke:this._stroke,textBaseline:this.textBaseline,whiteSpace:this.whiteSpace,wordWrap:this.wordWrap,wordWrapWidth:this.wordWrapWidth})}destroy(t=!1){if(this.removeAllListeners(),"boolean"==typeof t?t:t?.texture){const e="boolean"==typeof t?t:t?.textureSource;this._fill?.texture&&this._fill.texture.destroy(e),this._originalFill?.texture&&this._originalFill.texture.destroy(e),this._stroke?.texture&&this._stroke.texture.destroy(e),this._originalStroke?.texture&&this._originalStroke.texture.destroy(e)}this._fill=null,this._stroke=null,this.dropShadow=null,this._originalStroke=null,this._originalFill=null}_createProxy(t,e){return new Proxy(t,{set:(t,r,i)=>(t[r]=i,e?.(r,i),this.update(),!0)})}_isFillStyle(t){return null!==(t??null)&&!(s.Q.isColorLike(t)||t instanceof a._||t instanceof o.m)}};c.defaultDropShadow={alpha:1,angle:Math.PI/6,blur:0,color:"black",distance:5},c.defaultTextStyle={align:"left",breakWords:!1,dropShadow:null,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,padding:0,stroke:null,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};let d=c},8306:(t,e,r)=>{"use strict";r.d(e,{m:()=>s});const i={uint8x2:{size:2,stride:2,normalised:!1},uint8x4:{size:4,stride:4,normalised:!1},sint8x2:{size:2,stride:2,normalised:!1},sint8x4:{size:4,stride:4,normalised:!1},unorm8x2:{size:2,stride:2,normalised:!0},unorm8x4:{size:4,stride:4,normalised:!0},snorm8x2:{size:2,stride:2,normalised:!0},snorm8x4:{size:4,stride:4,normalised:!0},uint16x2:{size:2,stride:4,normalised:!1},uint16x4:{size:4,stride:8,normalised:!1},sint16x2:{size:2,stride:4,normalised:!1},sint16x4:{size:4,stride:8,normalised:!1},unorm16x2:{size:2,stride:4,normalised:!0},unorm16x4:{size:4,stride:8,normalised:!0},snorm16x2:{size:2,stride:4,normalised:!0},snorm16x4:{size:4,stride:8,normalised:!0},float16x2:{size:2,stride:4,normalised:!1},float16x4:{size:4,stride:8,normalised:!1},float32:{size:1,stride:4,normalised:!1},float32x2:{size:2,stride:8,normalised:!1},float32x3:{size:3,stride:12,normalised:!1},float32x4:{size:4,stride:16,normalised:!1},uint32:{size:1,stride:4,normalised:!1},uint32x2:{size:2,stride:8,normalised:!1},uint32x3:{size:3,stride:12,normalised:!1},uint32x4:{size:4,stride:16,normalised:!1},sint32:{size:1,stride:4,normalised:!1},sint32x2:{size:2,stride:8,normalised:!1},sint32x3:{size:3,stride:12,normalised:!1},sint32x4:{size:4,stride:16,normalised:!1}};function s(t){return i[t]??i.float32}},8422:(t,e,r)=>{"use strict";r.d(e,{K:()=>i});class i{constructor(){this.batcherName="default",this.topology="triangle-list",this.attributeSize=4,this.indexSize=6,this.packAsQuad=!0,this.roundPixels=0,this._attributeStart=0,this._batcher=null,this._batch=null}get blendMode(){return this.renderable.groupBlendMode}get color(){return this.renderable.groupColorAlpha}reset(){this.renderable=null,this.texture=null,this._batcher=null,this._batch=null,this.bounds=null}}},8475:(t,e,r)=>{"use strict";r.d(e,{M:()=>u});var i=r(8875),s=r(133),n=r(9113),a=r(3513),o=r(3012),h=r(5099),l=r(5811);class u extends i.A{constructor(t){super(),this.uid=(0,s.L)("shader"),this._uniformBindMap=Object.create(null),this._ownedBindGroups=[];let{gpuProgram:e,glProgram:r,groups:i,resources:n,compatibleRenderers:o,groupMap:u}=t;this.gpuProgram=e,this.glProgram=r,void 0===o&&(o=0,e&&(o|=h.W.WEBGPU),r&&(o|=h.W.WEBGL)),this.compatibleRenderers=o;const c={};if(n||i||(n={}),n&&i)throw new Error("[Shader] Cannot have both resources and groups");if(!e&&i&&!u)throw new Error("[Shader] No group map or WebGPU shader provided - consider using resources instead.");if(!e&&i&&u)for(const t in u)for(const e in u[t]){const r=u[t][e];c[r]={group:t,binding:e,name:r}}else if(e&&i&&!u){const t=e.structsAndGroups.groups;u={},t.forEach((t=>{u[t.group]=u[t.group]||{},u[t.group][t.binding]=t.name,c[t.name]=t}))}else if(n){i={},u={},e&&e.structsAndGroups.groups.forEach((t=>{u[t.group]=u[t.group]||{},u[t.group][t.binding]=t.name,c[t.name]=t}));let t=0;for(const e in n)c[e]||(i[99]||(i[99]=new a.T,this._ownedBindGroups.push(i[99])),c[e]={group:99,binding:t,name:e},u[99]=u[99]||{},u[99][t]=e,t++);for(const t in n){const e=t;let r=n[t];r.source||r._resourceType||(r=new l.k(r));const s=c[e];s&&(i[s.group]||(i[s.group]=new a.T,this._ownedBindGroups.push(i[s.group])),i[s.group].setResource(r,s.binding))}}this.groups=i,this._uniformBindMap=u,this.resources=this._buildResourceAccessor(i,c)}addResource(t,e,r){var i,s;(i=this._uniformBindMap)[e]||(i[e]={}),(s=this._uniformBindMap[e])[r]||(s[r]=t),this.groups[e]||(this.groups[e]=new a.T,this._ownedBindGroups.push(this.groups[e]))}_buildResourceAccessor(t,e){const r={};for(const i in e){const s=e[i];Object.defineProperty(r,s.name,{get:()=>t[s.group].getResource(s.binding),set(e){t[s.group].setResource(e,s.binding)}})}return r}destroy(t=!1){this.emit("destroy",this),t&&(this.gpuProgram?.destroy(),this.glProgram?.destroy()),this.gpuProgram=null,this.glProgram=null,this.removeAllListeners(),this._uniformBindMap=null,this._ownedBindGroups.forEach((t=>{t.destroy()})),this._ownedBindGroups=null,this.resources=null,this.groups=null}static from(t){const{gpu:e,gl:r,...i}=t;let s,a;return e&&(s=o.B.from(e)),r&&(a=n.M.from(r)),new u({gpuProgram:s,glProgram:a,...i})}}},8734:(t,e,r)=>{"use strict";r.d(e,{U:()=>i});class i{constructor(){this.batcherName="default",this.packAsQuad=!1,this.indexOffset=0,this.attributeOffset=0,this.roundPixels=0,this._batcher=null,this._batch=null,this._textureMatrixUpdateId=-1,this._uvUpdateId=-1}get blendMode(){return this.renderable.groupBlendMode}get topology(){return this._topology||this.geometry.topology}set topology(t){this._topology=t}reset(){this.renderable=null,this.texture=null,this._batcher=null,this._batch=null,this.geometry=null,this._uvUpdateId=-1,this._textureMatrixUpdateId=-1}setTexture(t){this.texture!==t&&(this.texture=t,this._textureMatrixUpdateId=-1)}get uvs(){const t=this.geometry.getBuffer("aUV"),e=t.data;let r=e;const i=this.texture.textureMatrix;return i.isSimple||(r=this._transformedUvs,this._textureMatrixUpdateId===i._updateID&&this._uvUpdateId===t._updateID||((!r||r.length<e.length)&&(r=this._transformedUvs=new Float32Array(e.length)),this._textureMatrixUpdateId=i._updateID,this._uvUpdateId=t._updateID,i.multiplyUvs(e,r))),r}get positions(){return this.geometry.positions}get indices(){return this.geometry.indices}get color(){return this.renderable.groupColorAlpha}get groupTransform(){return this.renderable.groupTransform}get attributeSize(){return this.geometry.positions.length/2}get indexSize(){return this.geometry.indices.length}}},8928:(t,e,r)=>{"use strict";var i=r(8507),s=r(3228),n=r(7547),a=r(8218),o=r(2760),h=r(6954);class l{constructor(t,e){this.state=n.U.for2d(),this._graphicsBatchesHash=Object.create(null),this._destroyRenderableBound=this.destroyRenderable.bind(this),this.renderer=t,this._adaptor=e,this._adaptor.init(),this.renderer.renderableGC.addManagedHash(this,"_graphicsBatchesHash")}validateRenderable(t){const e=t.context,r=!!this._graphicsBatchesHash[t.uid],i=this.renderer.graphicsContext.updateGpuContext(e);return!(!i.isBatchable&&r===i.isBatchable)}addRenderable(t,e){const r=this.renderer.graphicsContext.updateGpuContext(t.context);t.didViewUpdate&&this._rebuild(t),r.isBatchable?this._addToBatcher(t,e):(this.renderer.renderPipes.batch.break(e),e.add(t))}updateRenderable(t){const e=this._graphicsBatchesHash[t.uid];if(e)for(let t=0;t<e.length;t++){const r=e[t];r._batcher.updateElement(r)}}destroyRenderable(t){this._graphicsBatchesHash[t.uid]&&this._removeBatchForRenderable(t.uid),t.off("destroyed",this._destroyRenderableBound)}execute(t){if(!t.isRenderable)return;const e=this.renderer,r=t.context;if(!e.graphicsContext.getGpuContext(r).batches.length)return;const i=r.customShader||this._adaptor.shader;this.state.blendMode=t.groupBlendMode;const s=i.resources.localUniforms.uniforms;s.uTransformMatrix=t.groupTransform,s.uRound=e._roundPixels|t._roundPixels,(0,o.V)(t.groupColorAlpha,s.uColor,0),this._adaptor.execute(this,t)}_rebuild(t){const e=!!this._graphicsBatchesHash[t.uid],r=this.renderer.graphicsContext.updateGpuContext(t.context);e&&this._removeBatchForRenderable(t.uid),r.isBatchable&&this._initBatchesForRenderable(t),t.batched=r.isBatchable}_addToBatcher(t,e){const r=this.renderer.renderPipes.batch,i=this._getBatchesForRenderable(t);for(let t=0;t<i.length;t++){const s=i[t];r.addToBatch(s,e)}}_getBatchesForRenderable(t){return this._graphicsBatchesHash[t.uid]||this._initBatchesForRenderable(t)}_initBatchesForRenderable(t){const e=t.context,r=this.renderer.graphicsContext.getGpuContext(e),i=this.renderer._roundPixels|t._roundPixels,s=r.batches.map((e=>{const r=a.Z.get(h.G);return e.copyTo(r),r.renderable=t,r.roundPixels=i,r}));return void 0===this._graphicsBatchesHash[t.uid]&&t.on("destroyed",this._destroyRenderableBound),this._graphicsBatchesHash[t.uid]=s,s}_removeBatchForRenderable(t){this._graphicsBatchesHash[t].forEach((t=>{a.Z.return(t)})),this._graphicsBatchesHash[t]=null}destroy(){this.renderer=null,this._adaptor.destroy(),this._adaptor=null,this.state=null;for(const t in this._graphicsBatchesHash)this._removeBatchForRenderable(t);this._graphicsBatchesHash=null}}l.extension={type:[i.Ag.WebGLPipes,i.Ag.WebGPUPipes,i.Ag.CanvasPipes],name:"graphics"},i.XO.add(l),i.XO.add(s.GH)},9113:(t,e,r)=>{"use strict";r.d(e,{M:()=>d});var i=r(7952),s=r(3804);let n;function a(){if(!n){n="mediump";const t=(0,s.W)();if(t&&t.getShaderPrecisionFormat){const e=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT);n=e.precision?"highp":"mediump"}}return n}const o={},h={},l={stripVersion:function(t,e){return e?t.replace("#version 300 es",""):t},ensurePrecision:function(t,e,r){const i=r?e.maxSupportedFragmentPrecision:e.maxSupportedVertexPrecision;if("precision"!==t.substring(0,9)){let s=r?e.requestedFragmentPrecision:e.requestedVertexPrecision;return"highp"===s&&"highp"!==i&&(s="mediump"),`precision ${s} float;\n${t}`}return"highp"!==i&&"precision highp"===t.substring(0,15)?t.replace("precision highp","precision mediump"):t},addProgramDefines:function(t,e,r){return e?t:r?`\n        \n        #ifdef GL_ES // This checks if it is WebGL1\n        #define in varying\n        #define finalColor gl_FragColor\n        #define texture texture2D\n        #endif\n        ${t=t.replace("out vec4 finalColor;","")}\n        `:`\n        \n        #ifdef GL_ES // This checks if it is WebGL1\n        #define in attribute\n        #define out varying\n        #endif\n        ${t}\n        `},setProgramName:function(t,{name:e="pixi-program"},r=!0){e=e.replace(/\s+/g,"-");const i=r?o:h;return i[e+=r?"-fragment":"-vertex"]?(i[e]++,e+=`-${i[e]}`):i[e]=1,-1!==t.indexOf("#define SHADER_NAME")?t:`#define SHADER_NAME ${e}\n${t}`},insertVersion:function(t,e){return e?`#version 300 es\n${t}`:t}},u=Object.create(null),c=class t{constructor(e){const r=-1!==(e={...t.defaultOptions,...e}).fragment.indexOf("#version 300 es"),s={stripVersion:r,ensurePrecision:{requestedFragmentPrecision:e.preferredFragmentPrecision,requestedVertexPrecision:e.preferredVertexPrecision,maxSupportedVertexPrecision:"highp",maxSupportedFragmentPrecision:a()},setProgramName:{name:e.name},addProgramDefines:r,insertVersion:r};let n=e.fragment,o=e.vertex;Object.keys(l).forEach((t=>{const e=s[t];n=l[t](n,e,!0),o=l[t](o,e,!1)})),this.fragment=n,this.vertex=o,this.transformFeedbackVaryings=e.transformFeedbackVaryings,this._key=(0,i.X)(`${this.vertex}:${this.fragment}`,"gl-program")}destroy(){this.fragment=null,this.vertex=null,this._attributeData=null,this._uniformData=null,this._uniformBlockData=null,this.transformFeedbackVaryings=null}static from(e){const r=`${e.vertex}:${e.fragment}`;return u[r]||(u[r]=new t(e)),u[r]}};c.defaultOptions={preferredVertexPrecision:"highp",preferredFragmentPrecision:"mediump"};let d=c},9147:(t,e,r)=>{"use strict";var i=r(8507),s=r(7174),n=r(8218),a=r(8422),o=r(2289);class h{constructor(t){this._gpuText=Object.create(null),this._destroyRenderableBound=this.destroyRenderable.bind(this),this._renderer=t,this._renderer.runners.resolutionChange.add(this),this._renderer.renderableGC.addManagedHash(this,"_gpuText")}resolutionChange(){for(const t in this._gpuText){const e=this._gpuText[t];if(!e)continue;const r=e.batchableSprite.renderable;r._autoResolution&&(r._resolution=this._renderer.resolution,r.onViewUpdate())}}validateRenderable(t){const e=this._getGpuText(t),r=t._getKey();return e.textureNeedsUploading?(e.textureNeedsUploading=!1,!0):e.currentKey!==r}addRenderable(t,e){const r=this._getGpuText(t).batchableSprite;t._didTextUpdate&&this._updateText(t),this._renderer.renderPipes.batch.addToBatch(r,e)}updateRenderable(t){const e=this._getGpuText(t).batchableSprite;t._didTextUpdate&&this._updateText(t),e._batcher.updateElement(e)}destroyRenderable(t){t.off("destroyed",this._destroyRenderableBound),this._destroyRenderableById(t.uid)}_destroyRenderableById(t){const e=this._gpuText[t];this._renderer.htmlText.decreaseReferenceCount(e.currentKey),n.Z.return(e.batchableSprite),this._gpuText[t]=null}_updateText(t){const e=t._getKey(),r=this._getGpuText(t),i=r.batchableSprite;r.currentKey!==e&&this._updateGpuText(t).catch((t=>{console.error(t)})),t._didTextUpdate=!1,(0,o.s)(i,t)}async _updateGpuText(t){t._didTextUpdate=!1;const e=this._getGpuText(t);if(e.generatingTexture)return;const r=t._getKey();this._renderer.htmlText.decreaseReferenceCount(e.currentKey),e.generatingTexture=!0,e.currentKey=r;const i=t.resolution??this._renderer.resolution,s=await this._renderer.htmlText.getManagedTexture(t.text,i,t._style,t._getKey()),n=e.batchableSprite;n.texture=e.texture=s,e.generatingTexture=!1,e.textureNeedsUploading=!0,t.onViewUpdate(),(0,o.s)(n,t)}_getGpuText(t){return this._gpuText[t.uid]||this.initGpuText(t)}initGpuText(t){const e={texture:s.g.EMPTY,currentKey:"--",batchableSprite:n.Z.get(a.K),textureNeedsUploading:!1,generatingTexture:!1},r=e.batchableSprite;return r.renderable=t,r.transform=t.groupTransform,r.texture=s.g.EMPTY,r.bounds={minX:0,maxX:1,minY:0,maxY:0},r.roundPixels=this._renderer._roundPixels|t._roundPixels,t._resolution=t._autoResolution?this._renderer.resolution:t.resolution,this._gpuText[t.uid]=e,t.on("destroyed",this._destroyRenderableBound),e}destroy(){for(const t in this._gpuText)this._destroyRenderableById(t);this._gpuText=null,this._renderer=null}}h.extension={type:[i.Ag.WebGLPipes,i.Ag.WebGPUPipes,i.Ag.CanvasPipes],name:"htmlText"};var l=r(7608),u=r(2437),c=r(5099),d=r(1761),f=r(268),p=r(2558);const g="http://www.w3.org/2000/svg",m="http://www.w3.org/1999/xhtml";class x{constructor(){this.svgRoot=document.createElementNS(g,"svg"),this.foreignObject=document.createElementNS(g,"foreignObject"),this.domElement=document.createElementNS(m,"div"),this.styleElement=document.createElementNS(m,"style"),this.image=new Image;const{foreignObject:t,svgRoot:e,styleElement:r,domElement:i}=this;t.setAttribute("width","10000"),t.setAttribute("height","10000"),t.style.overflow="hidden",e.appendChild(t),t.appendChild(r),t.appendChild(i)}}var _=r(8291),y=r(8011),b=r(2577);function v(t){const e=b.Q.shared.setValue(t.color).setAlpha(t.alpha).toHexa(),r=`${Math.round(Math.cos(t.angle)*t.distance)}px ${Math.round(Math.sin(t.angle)*t.distance)}px`;return t.blur>0?`text-shadow: ${r} ${t.blur}px ${e}`:`text-shadow: ${r} ${e}`}function S(t){return[`-webkit-text-stroke-width: ${t.width}px`,`-webkit-text-stroke-color: ${b.Q.shared.setValue(t.color).toHex()}`,`text-stroke-width: ${t.width}px`,`text-stroke-color: ${b.Q.shared.setValue(t.color).toHex()}`,"paint-order: stroke"].join(";")}const w={fontSize:"font-size: {{VALUE}}px",fontFamily:"font-family: {{VALUE}}",fontWeight:"font-weight: {{VALUE}}",fontStyle:"font-style: {{VALUE}}",fontVariant:"font-variant: {{VALUE}}",letterSpacing:"letter-spacing: {{VALUE}}px",align:"text-align: {{VALUE}}",padding:"padding: {{VALUE}}px",whiteSpace:"white-space: {{VALUE}}",lineHeight:"line-height: {{VALUE}}px",wordWrapWidth:"max-width: {{VALUE}}px"},T={fill:t=>`color: ${b.Q.shared.setValue(t).toHex()}`,breakWords:t=>"word-wrap: "+(t?"break-all":"break-word"),stroke:S,dropShadow:v};class M extends _.x{constructor(t={}){super(t),this._cssOverrides=[],this.cssOverrides??(this.cssOverrides=t.cssOverrides),this.tagStyles=t.tagStyles??{}}set cssOverrides(t){this._cssOverrides=t instanceof Array?t:[t],this.update()}get cssOverrides(){return this._cssOverrides}_generateKey(){return this._styleKey=(0,y.V)(this)+this._cssOverrides.join("-"),this._styleKey}update(){this._cssStyle=null,super.update()}clone(){return new M({align:this.align,breakWords:this.breakWords,dropShadow:this.dropShadow?{...this.dropShadow}:null,fill:this._fill,fontFamily:this.fontFamily,fontSize:this.fontSize,fontStyle:this.fontStyle,fontVariant:this.fontVariant,fontWeight:this.fontWeight,letterSpacing:this.letterSpacing,lineHeight:this.lineHeight,padding:this.padding,stroke:this._stroke,whiteSpace:this.whiteSpace,wordWrap:this.wordWrap,wordWrapWidth:this.wordWrapWidth,cssOverrides:this.cssOverrides})}get cssStyle(){return this._cssStyle||(this._cssStyle=function(t){const e=t._stroke,r=t._fill,i=[`div { ${[`color: ${b.Q.shared.setValue(r.color).toHex()}`,`font-size: ${t.fontSize}px`,`font-family: ${t.fontFamily}`,`font-weight: ${t.fontWeight}`,`font-style: ${t.fontStyle}`,`font-variant: ${t.fontVariant}`,`letter-spacing: ${t.letterSpacing}px`,`text-align: ${t.align}`,`padding: ${t.padding}px`,`white-space: ${"pre"===t.whiteSpace&&t.wordWrap?"pre-wrap":t.whiteSpace}`,...t.lineHeight?[`line-height: ${t.lineHeight}px`]:[],...t.wordWrap?["word-wrap: "+(t.breakWords?"break-all":"break-word"),`max-width: ${t.wordWrapWidth}px`]:[],...e?[S(e)]:[],...t.dropShadow?[v(t.dropShadow)]:[],...t.cssOverrides].join(";")} }`];return function(t,e){for(const r in t){const i=t[r],s=[];for(const t in i)T[t]?s.push(T[t](i[t])):w[t]&&s.push(w[t].replace("{{VALUE}}",i[t]));e.push(`${r} { ${s.join(";")} }`)}}(t.tagStyles,i),i.join(" ")}(this)),this._cssStyle}addOverride(...t){const e=t.filter((t=>!this.cssOverrides.includes(t)));e.length>0&&(this.cssOverrides.push(...e),this.update())}removeOverride(...t){const e=t.filter((t=>this.cssOverrides.includes(t)));e.length>0&&(this.cssOverrides=this.cssOverrides.filter((t=>!e.includes(t))),this.update())}set fill(t){"string"!=typeof t&&"number"!=typeof t&&(0,f.R)("[HTMLTextStyle] only color fill is not supported by HTMLText"),super.fill=t}set stroke(t){t&&"string"!=typeof t&&"number"!=typeof t&&(0,f.R)("[HTMLTextStyle] only color stroke is not supported by HTMLText"),super.stroke=t}}var C=r(1979);async function P(t,e){const r=await async function(t){const e=await d.e.get().fetch(t),r=await e.blob(),i=new FileReader;return await new Promise(((t,e)=>{i.onloadend=()=>t(i.result),i.onerror=e,i.readAsDataURL(r)}))}(e);return`@font-face {\n        font-family: "${t.fontFamily}";\n        src: url('${r}');\n        font-weight: ${t.fontWeight};\n        font-style: ${t.fontStyle};\n    }`}const k=new Map;let B;class R{constructor(t){this._activeTextures={},this._renderer=t,this._createCanvas=t.type===c.W.WEBGPU}getTexture(t){return this._buildTexturePromise(t.text,t.resolution,t.style)}getManagedTexture(t,e,r,i){if(this._activeTextures[i])return this._increaseReferenceCount(i),this._activeTextures[i].promise;const s=this._buildTexturePromise(t,e,r).then((t=>(this._activeTextures[i].texture=t,t)));return this._activeTextures[i]={texture:null,promise:s,usageCount:1},s}async _buildTexturePromise(t,e,r){const i=n.Z.get(x),s=function(t,e){const r=e.fontFamily,i=[],s={},n=t.match(/font-family:([^;"\s]+)/g);function a(t){s[t]||(i.push(t),s[t]=!0)}if(Array.isArray(r))for(let t=0;t<r.length;t++)a(r[t]);else a(r);n&&n.forEach((t=>{a(t.split(":")[1].trim())}));for(const t in e.tagStyles)a(e.tagStyles[t].fontFamily);return i}(t,r),a=await async function(t,e,r){const i=t.filter((t=>C.l.has(`${t}-and-url`))).map(((t,i)=>{if(!k.has(t)){const{url:s}=C.l.get(`${t}-and-url`);0===i?k.set(t,P({fontWeight:e.fontWeight,fontStyle:e.fontStyle,fontFamily:t},s)):k.set(t,P({fontWeight:r.fontWeight,fontStyle:r.fontStyle,fontFamily:t},s))}return k.get(t)}));return(await Promise.all(i)).join("\n")}(s,r,M.defaultTextStyle),o=function(t,e,r,i){i||(i=B||(B=new x));const{domElement:s,styleElement:n,svgRoot:a}=i;s.innerHTML=`<style>${e.cssStyle};</style><div style='padding:0'>${t}</div>`,s.setAttribute("style","transform-origin: top left; display: inline-block"),r&&(n.textContent=r),document.body.appendChild(a);const o=s.getBoundingClientRect();a.remove();const h=2*e.padding;return{width:o.width-h,height:o.height-h}}(t,r,a,i),h=Math.ceil(Math.ceil(Math.max(1,o.width)+2*r.padding)*e),u=Math.ceil(Math.ceil(Math.max(1,o.height)+2*r.padding)*e),c=i.image;c.width=2+(0|h),c.height=2+(0|u);const f=function(t,e,r,i,s){const{domElement:n,styleElement:a,svgRoot:o}=s;n.innerHTML=`<style>${e.cssStyle}</style><div style='padding:0;'>${t}</div>`,n.setAttribute("style",`transform: scale(${r});transform-origin: top left; display: inline-block`),a.textContent=i;const{width:h,height:l}=s.image;return o.setAttribute("width",h.toString()),o.setAttribute("height",l.toString()),(new XMLSerializer).serializeToString(o)}(t,r,e,a,i);await function(t,e,r){return new Promise((async i=>{r&&await new Promise((t=>setTimeout(t,100))),t.onload=()=>{i()},t.src=`data:image/svg+xml;charset=utf8,${encodeURIComponent(e)}`,t.crossOrigin="anonymous"}))}(c,f,function(){const{userAgent:t}=d.e.get().getNavigator();return/^((?!chrome|android).)*safari/i.test(t)}()&&s.length>0);const g=c;let m;this._createCanvas&&(m=function(t,e){const r=l.N.getOptimalCanvasAndContext(t.width,t.height,e),{context:i}=r;return i.clearRect(0,0,t.width,t.height),i.drawImage(t,0,0),r}(c,e));const _=(0,p.M)(m?m.canvas:g,c.width-2,c.height-2,e);return this._createCanvas&&(this._renderer.texture.initSource(_.source),l.N.returnCanvasAndContext(m)),n.Z.return(i),_}_increaseReferenceCount(t){this._activeTextures[t].usageCount++}decreaseReferenceCount(t){const e=this._activeTextures[t];e&&(e.usageCount--,0===e.usageCount&&(e.texture?this._cleanUp(e):e.promise.then((t=>{e.texture=t,this._cleanUp(e)})).catch((()=>{(0,f.R)("HTMLTextSystem: Failed to clean texture")})),this._activeTextures[t]=null))}_cleanUp(t){u.W.returnTexture(t.texture),t.texture.source.resource=null,t.texture.source.uploadMethodId="unknown"}getReferenceCount(t){return this._activeTextures[t].usageCount}destroy(){this._activeTextures=null}}R.extension={type:[i.Ag.WebGLSystem,i.Ag.WebGPUSystem,i.Ag.CanvasSystem],name:"htmlText"},R.defaultFontOptions={fontFamily:"Arial",fontStyle:"normal",fontWeight:"normal"},i.XO.add(R),i.XO.add(h)},9305:(t,e,r)=>{"use strict";var i=r(8507);class s{execute(t,e){const r=t.state,i=t.renderer,s=e.shader||t.defaultShader;s.resources.uTexture=e.texture._source,s.resources.uniforms=t.localUniforms;const n=i.gl,a=t.getBuffers(e);i.shader.bind(s),i.state.set(r),i.geometry.bind(a.geometry,s.glProgram);const o=2===a.geometry.indexBuffer.data.BYTES_PER_ELEMENT?n.UNSIGNED_SHORT:n.UNSIGNED_INT;n.drawElements(n.TRIANGLES,6*e.particleChildren.length,o,0)}}var n=r(9313),a=r(5811),o=r(2331),h=r(7547),l=r(2760),u=r(949),c=r(1132),d=r(6011),f=r(8306),p=r(1460);function g(t,e=null){const r=6*t;if(r>65535?e||(e=new Uint32Array(r)):e||(e=new Uint16Array(r)),e.length!==r)throw new Error(`Out buffer length is incorrect, got ${e.length} and expected ${r}`);for(let t=0,i=0;t<r;t+=6,i+=4)e[t+0]=i+0,e[t+1]=i+1,e[t+2]=i+2,e[t+3]=i+0,e[t+4]=i+2,e[t+5]=i+3;return e}function m(t,e){const r=[];r.push("\n      \n        var index = 0;\n\n        for (let i = 0; i < ps.length; ++i)\n        {\n            const p = ps[i];\n\n            ");let i=0;for(const s in t){const n=t[s];e===n.dynamic&&(r.push(`offset = index + ${i}`),r.push(n.code),i+=(0,f.m)(n.format).stride/4)}r.push("\n            index += stride * 4;\n        }\n    "),r.unshift(`\n        var stride = ${i};\n    `);const s=r.join("\n");return new Function("ps","f32v","u32v",s)}class x{constructor(t){this._size=0,this._generateParticleUpdateCache={};const e=this._size=t.size??1e3,r=t.properties;let i=0,s=0;for(const t in r){const e=r[t],n=(0,f.m)(e.format);e.dynamic?s+=n.stride:i+=n.stride}this._dynamicStride=s/4,this._staticStride=i/4,this.staticAttributeBuffer=new p.u(4*e*i),this.dynamicAttributeBuffer=new p.u(4*e*s),this.indexBuffer=g(e);const n=new d.V;let a=0,o=0;this._staticBuffer=new u.h({data:new Float32Array(1),label:"static-particle-buffer",shrinkToFit:!1,usage:c.S.VERTEX|c.S.COPY_DST}),this._dynamicBuffer=new u.h({data:new Float32Array(1),label:"dynamic-particle-buffer",shrinkToFit:!1,usage:c.S.VERTEX|c.S.COPY_DST});for(const t in r){const e=r[t],i=(0,f.m)(e.format);e.dynamic?(n.addAttribute(e.attributeName,{buffer:this._dynamicBuffer,stride:4*this._dynamicStride,offset:4*a,format:e.format}),a+=i.size):(n.addAttribute(e.attributeName,{buffer:this._staticBuffer,stride:4*this._staticStride,offset:4*o,format:e.format}),o+=i.size)}n.addIndex(this.indexBuffer);const h=this.getParticleUpdate(r);this._dynamicUpload=h.dynamicUpdate,this._staticUpload=h.staticUpdate,this.geometry=n}getParticleUpdate(t){const e=function(t){const e=[];for(const r in t){const i=t[r];e.push(r,i.code,i.dynamic?"d":"s")}return e.join("_")}(t);return this._generateParticleUpdateCache[e]||(this._generateParticleUpdateCache[e]=this.generateParticleUpdate(t)),this._generateParticleUpdateCache[e]}generateParticleUpdate(t){return function(t){return{dynamicUpdate:m(t,!0),staticUpdate:m(t,!1)}}(t)}update(t,e){t.length>this._size&&(e=!0,this._size=Math.max(t.length,1.5*this._size|0),this.staticAttributeBuffer=new p.u(this._size*this._staticStride*4*4),this.dynamicAttributeBuffer=new p.u(this._size*this._dynamicStride*4*4),this.indexBuffer=g(this._size),this.geometry.indexBuffer.setDataWithSize(this.indexBuffer,this.indexBuffer.byteLength,!0));const r=this.dynamicAttributeBuffer;if(this._dynamicUpload(t,r.float32View,r.uint32View),this._dynamicBuffer.setDataWithSize(this.dynamicAttributeBuffer.float32View,t.length*this._dynamicStride*4,!0),e){const e=this.staticAttributeBuffer;this._staticUpload(t,e.float32View,e.uint32View),this._staticBuffer.setDataWithSize(e.float32View,t.length*this._staticStride*4,!0)}}destroy(){this._staticBuffer.destroy(),this._dynamicBuffer.destroy(),this.geometry.destroy()}}var _=r(2577),y=r(9113),b=r(3012),v=r(8475),S=r(7174),w=r(218),T="\nstruct ParticleUniforms {\n  uProjectionMatrix:mat3x3<f32>,\n  uColor:vec4<f32>,\n  uResolution:vec2<f32>,\n  uRoundPixels:f32,\n};\n\n@group(0) @binding(0) var<uniform> uniforms: ParticleUniforms;\n\n@group(1) @binding(0) var uTexture: texture_2d<f32>;\n@group(1) @binding(1) var uSampler : sampler;\n\nstruct VSOutput {\n    @builtin(position) position: vec4<f32>,\n    @location(0) uv : vec2<f32>,\n    @location(1) color : vec4<f32>,\n  };\n@vertex\nfn mainVertex(\n  @location(0) aVertex: vec2<f32>,\n  @location(1) aPosition: vec2<f32>,\n  @location(2) aUV: vec2<f32>,\n  @location(3) aColor: vec4<f32>,\n  @location(4) aRotation: f32,\n) -> VSOutput {\n  \n   let v = vec2(\n       aVertex.x * cos(aRotation) - aVertex.y * sin(aRotation),\n       aVertex.x * sin(aRotation) + aVertex.y * cos(aRotation)\n   ) + aPosition;\n\n   let position = vec4((uniforms.uProjectionMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);\n\n    let vColor = vec4(aColor.rgb * aColor.a, aColor.a) * uniforms.uColor;\n\n  return VSOutput(\n   position,\n   aUV,\n   vColor,\n  );\n}\n\n@fragment\nfn mainFragment(\n  @location(0) uv: vec2<f32>,\n  @location(1) color: vec4<f32>,\n  @builtin(position) position: vec4<f32>,\n) -> @location(0) vec4<f32> {\n\n    var sample = textureSample(uTexture, uSampler, uv) * color;\n   \n    return sample;\n}";class M extends v.M{constructor(){super({glProgram:y.M.from({vertex:"attribute vec2 aVertex;\nattribute vec2 aUV;\nattribute vec4 aColor;\n\nattribute vec2 aPosition;\nattribute float aRotation;\n\nuniform mat3 uTranslationMatrix;\nuniform float uRound;\nuniform vec2 uResolution;\nuniform vec4 uColor;\n\nvarying vec2 vUV;\nvarying vec4 vColor;\n\nvec2 roundPixels(vec2 position, vec2 targetSize)\n{       \n    return (floor(((position * 0.5 + 0.5) * targetSize) + 0.5) / targetSize) * 2.0 - 1.0;\n}\n\nvoid main(void){\n    float cosRotation = cos(aRotation);\n    float sinRotation = sin(aRotation);\n    float x = aVertex.x * cosRotation - aVertex.y * sinRotation;\n    float y = aVertex.x * sinRotation + aVertex.y * cosRotation;\n\n    vec2 v = vec2(x, y);\n    v = v + aPosition;\n\n    gl_Position = vec4((uTranslationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);\n\n    if(uRound == 1.0)\n    {\n        gl_Position.xy = roundPixels(gl_Position.xy, uResolution);\n    }\n\n    vUV = aUV;\n    vColor = vec4(aColor.rgb * aColor.a, aColor.a) * uColor;\n}\n",fragment:"varying vec2 vUV;\nvarying vec4 vColor;\n\nuniform sampler2D uTexture;\n\nvoid main(void){\n    vec4 color = texture2D(uTexture, vUV) * vColor;\n    gl_FragColor = color;\n}"}),gpuProgram:b.B.from({fragment:{source:T,entryPoint:"mainFragment"},vertex:{source:T,entryPoint:"mainVertex"}}),resources:{uTexture:S.g.WHITE.source,uSampler:new w.n({}),uniforms:{uTranslationMatrix:{value:new n.u,type:"mat3x3<f32>"},uColor:{value:new _.Q(16777215),type:"vec4<f32>"},uRound:{value:1,type:"f32"},uResolution:{value:[0,0],type:"vec2<f32>"}}}})}}class C{constructor(t,e){this.state=h.U.for2d(),this._gpuBufferHash=Object.create(null),this._destroyRenderableBound=this.destroyRenderable.bind(this),this.localUniforms=new a.k({uTranslationMatrix:{value:new n.u,type:"mat3x3<f32>"},uColor:{value:new Float32Array(4),type:"vec4<f32>"},uRound:{value:1,type:"f32"},uResolution:{value:[0,0],type:"vec2<f32>"}}),this.renderer=t,this.adaptor=e,this.defaultShader=new M,this.state=h.U.for2d()}validateRenderable(t){return!1}addRenderable(t,e){this.renderer.renderPipes.batch.break(e),e.add(t)}getBuffers(t){return this._gpuBufferHash[t.uid]||this._initBuffer(t)}_initBuffer(t){return this._gpuBufferHash[t.uid]=new x({size:t.particleChildren.length,properties:t._properties}),t.on("destroyed",this._destroyRenderableBound),this._gpuBufferHash[t.uid]}updateRenderable(t){}destroyRenderable(t){this._gpuBufferHash[t.uid].destroy(),this._gpuBufferHash[t.uid]=null,t.off("destroyed",this._destroyRenderableBound)}execute(t){const e=t.particleChildren;if(0===e.length)return;const r=this.renderer,i=this.getBuffers(t);t.texture||(t.texture=e[0].texture);const s=this.state;i.update(e,t._childrenDirty),t._childrenDirty=!1,s.blendMode=(0,o.i)(t.blendMode,t.texture._source);const n=this.localUniforms.uniforms,a=n.uTranslationMatrix;t.worldTransform.copyTo(a),a.prepend(r.globalUniforms.globalUniformData.projectionMatrix),n.uResolution=r.globalUniforms.globalUniformData.resolution,n.uRound=r._roundPixels|t._roundPixels,(0,l.V)(t.groupColorAlpha,n.uColor,0),this.adaptor.execute(this,t)}destroy(){this.defaultShader&&(this.defaultShader.destroy(),this.defaultShader=null)}}class P extends C{constructor(t){super(t,new s)}}P.extension={type:[i.Ag.WebGLPipes],name:"particle"};class k{execute(t,e){const r=t.renderer,i=e.shader||t.defaultShader;i.groups[0]=r.renderPipes.uniformBatch.getUniformBindGroup(t.localUniforms,!0),i.groups[1]=r.texture.getTextureBindGroup(e.texture);const s=t.state,n=t.getBuffers(e);r.encoder.draw({geometry:n.geometry,shader:e.shader||t.defaultShader,state:s,size:6*e.particleChildren.length})}}class B extends C{constructor(t){super(t,new k)}}B.extension={type:[i.Ag.WebGPUPipes],name:"particle"},i.XO.add(P),i.XO.add(B)}}]);